import{l as B,j as e,r as i,H as P,B as n,T as t,aa as se,D as Ae,o as c,A as _,p as Q,x as De,I as J,n as S,i as ze,ab as ve,C as we,ac as Te,h as Ee,a0 as We,a1 as X,P as me,v as pe,L as Le,w as Me}from"./index-DnWmqzJF.js";import{v as ye}from"./validation-C2QFlzQX.js";import{C as A,a as W}from"./CardContent-BhQI87uj.js";import{C as ce}from"./Chip-CSuofl6d.js";import{G as m}from"./Grid-0tqG7FTE.js";import{D as Z,a as re,b as te,c as ae}from"./DialogTitle-DKxRfOzX.js";import{A as ie}from"./Add-C7DSqfba.js";import{E as je}from"./Error-B8gOibaO.js";import{C as Re}from"./CheckCircle-B5gS3fbx.js";import{f as fe}from"./format-DjXxzLAN.js";import{L as be}from"./Lock-DCccL4KJ.js";import{F as le}from"./Fingerprint-BskTfpZx.js";import{C as ge}from"./Cancel-zFl1_j2m.js";import{S as Ve}from"./Save-B20zNACZ.js";import{L as He,a as Ue}from"./ListItem-z0t0rr4D.js";import{C as Be}from"./Check-D73JkDWp.js";import{E as Ne}from"./Edit-v4qS8plG.js";import{D as Ye}from"./Delete-CC6nSGco.js";import{S as Ge}from"./Snackbar-BmHWVIFe.js";import{S as Ke}from"./Computer-BIKVQGFH.js";import"./listItemButtonClasses-Cwcgs-VK.js";const ne=B(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),oe=B(e.jsx("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty"),$e=B(e.jsx("path",{d:"M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2zM4 6h16v10H4z"}),"Laptop"),Oe=B(e.jsx("path",{d:"M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1m-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5-4H7V4h9z"}),"PhoneIphone"),qe=B(e.jsx("path",{d:"M3 11h8V3H3zm2-6h4v4H5zM3 21h8v-8H3zm2-6h4v4H5zm8-12v8h8V3zm6 6h-4V5h4zm0 10h2v2h-2zm-6-6h2v2h-2zm2 2h2v2h-2zm-2 2h2v2h-2zm2 2h2v2h-2zm2-2h2v2h-2zm0-4h2v2h-2zm2 2h2v2h-2z"}),"QrCode"),Qe=B(e.jsx("path",{d:"M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99M17 19H7V5h10z"}),"Smartphone"),Je=B(e.jsx("path",{d:"M21 4H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 1.99-.9 1.99-2L23 6c0-1.1-.9-2-2-2m-2 14H5V6h14z"}),"Tablet"),Xe=({onSetupComplete:x})=>{const[r,p]=i.useState(null),[l,D]=i.useState(null),[z,a]=i.useState(""),[T,v]=i.useState(""),[Y,b]=i.useState(!1),[E,F]=i.useState(!1),[w,j]=i.useState(!1),[k,N]=i.useState([]),[L,G]=i.useState(""),[I,C]=i.useState(!1),[M,d]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{g()},[]);const g=async()=>{try{const o=await P.getTwoFactorStatus();p(o)}catch(o){console.error("Failed to load 2FA status:",o),f("Failed to load 2FA status","error")}},u=async()=>{C(!0);try{const o=await P.setupTwoFactor();D(o),b(!0)}catch(o){console.error("Failed to setup 2FA:",o),f("Failed to setup 2FA","error")}finally{C(!1)}},R=async()=>{if(!z.trim()){f("Please enter verification code","error");return}C(!0);try{await P.enableTwoFactor(z),b(!1),a(""),D(null),await g(),f("2FA enabled successfully","success"),x==null||x()}catch(o){console.error("Failed to enable 2FA:",o),f(o.message||"Failed to enable 2FA","error")}finally{C(!1)}},V=async()=>{if(!T.trim()){f("Please enter your current 2FA code","error");return}C(!0);try{await P.disableTwoFactor(T),F(!1),v(""),await g(),f("2FA disabled successfully","success"),x==null||x()}catch(o){console.error("Failed to disable 2FA:",o),f(o.message||"Failed to disable 2FA","error")}finally{C(!1)}},K=async()=>{if(!L.trim()){f("Please enter your current 2FA code","error");return}C(!0);try{const o=await P.regenerateBackupCodes(L);N(o.backup_codes),j(!1),G(""),await g(),f("Backup codes regenerated successfully","success")}catch(o){console.error("Failed to regenerate backup codes:",o),f(o.message||"Failed to regenerate backup codes","error")}finally{C(!1)}},$=o=>{navigator.clipboard.writeText(o).then(()=>{f("Copied to clipboard","success")}).catch(()=>{f("Failed to copy to clipboard","error")})},f=(o,U)=>{d({open:!0,message:o,severity:U})},H=()=>{d({...M,open:!1})};return r?e.jsxs(n,{children:[e.jsx(A,{children:e.jsxs(W,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{children:[e.jsxs(t,{variant:"h6",sx:{fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{}),"Two-Factor Authentication"]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Add an extra layer of security to your account"})]}),e.jsx(ce,{label:r.enabled?"Enabled":"Disabled",color:r.enabled?"success":"default",variant:r.enabled?"filled":"outlined"})]}),e.jsx(Ae,{sx:{mb:3}}),r.enabled?e.jsxs(n,{children:[e.jsx(_,{severity:"success",sx:{mb:3},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"2FA is enabled!"})," Your account is now protected with two-factor authentication."]})}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsxs(Q,{sx:{p:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Backup Codes"}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[r.backup_codes_remaining," codes remaining"]}),e.jsx(c,{variant:"outlined",size:"small",startIcon:e.jsx(De,{}),onClick:()=>j(!0),children:"Generate New Codes"})]})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsxs(Q,{sx:{p:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Disable 2FA"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Disabling 2FA will make your account less secure"}),e.jsx(c,{variant:"outlined",size:"small",color:"error",onClick:()=>F(!0),children:"Disable 2FA"})]})})]})]}):e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(se,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Two-factor authentication is not enabled"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Protect your account with Google Authenticator, Authy, or any TOTP app"}),e.jsx(c,{variant:"contained",onClick:u,disabled:I,startIcon:e.jsx(qe,{}),children:I?"Setting up...":"Set Up 2FA"})]})]})}),e.jsxs(Z,{open:Y,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:"Set Up Two-Factor Authentication"}),e.jsx(te,{children:l&&e.jsxs(n,{sx:{mt:1},children:[e.jsx(t,{variant:"body1",sx:{mb:2},children:"1. Install Google Authenticator, Authy, or any TOTP app on your phone"}),e.jsx(t,{variant:"body1",sx:{mb:3},children:"2. Scan this QR code with your authenticator app:"}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",mb:3},children:e.jsx(n,{component:"img",src:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(l.qr_code_url)}`,alt:"QR Code",sx:{width:200,height:200,border:"1px solid",borderColor:"divider"}})}),e.jsx(t,{variant:"body1",sx:{mb:1},children:"Or manually enter this code:"}),e.jsx(Q,{sx:{p:2,bgcolor:"grey.100",mb:3},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(t,{variant:"body2",sx:{fontFamily:"monospace",flexGrow:1},children:l.secret}),e.jsx(J,{size:"small",onClick:()=>$(l.secret),children:e.jsx(ne,{fontSize:"small"})})]})}),e.jsx(t,{variant:"body1",sx:{mb:2},children:"3. Enter the 6-digit verification code from your authenticator app:"}),e.jsx(S,{fullWidth:!0,label:"Verification Code",value:z,onChange:o=>a(o.target.value.replace(/\D/g,"").slice(0,6)),inputProps:{maxLength:6},sx:{mb:3}}),e.jsxs(t,{variant:"body1",sx:{mb:2},children:["4. ",e.jsx("strong",{children:"Important:"})," Save these backup codes in a secure place. You can use them to access your account if you lose your device:"]}),e.jsxs(Q,{sx:{p:2,bgcolor:"warning.light",mb:2},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600,mb:1},children:"⚠️ Store these codes somewhere safe. Each code can only be used once."}),e.jsx(m,{container:!0,spacing:1,children:l.backup_codes.map((o,U)=>e.jsx(m,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",sx:{fontFamily:"monospace",fontWeight:500},children:o})},U))}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(c,{size:"small",startIcon:e.jsx(ne,{}),onClick:()=>$(l.backup_codes.join(`
`)),children:"Copy All Codes"})})]})]})}),e.jsxs(ae,{children:[e.jsx(c,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(c,{onClick:R,variant:"contained",disabled:z.length!==6||I,children:"Enable 2FA"})]})]}),e.jsxs(Z,{open:E,onClose:()=>F(!1),children:[e.jsx(re,{children:"Disable Two-Factor Authentication"}),e.jsxs(te,{children:[e.jsx(t,{sx:{mb:2},children:"Are you sure you want to disable 2FA? This will make your account less secure."}),e.jsx(S,{fullWidth:!0,label:"Enter your current 2FA code or backup code",value:T,onChange:o=>v(o.target.value),sx:{mb:1}}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"This action cannot be undone. Make sure you have access to your authenticator app or backup codes."})]}),e.jsxs(ae,{children:[e.jsx(c,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(c,{onClick:V,variant:"contained",color:"error",disabled:!T.trim()||I,children:"Disable 2FA"})]})]}),e.jsxs(Z,{open:w,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:"Regenerate Backup Codes"}),e.jsxs(te,{children:[e.jsx(t,{sx:{mb:2},children:"Generate new backup codes? Your old codes will no longer work."}),e.jsx(S,{fullWidth:!0,label:"Enter your current 2FA code",value:L,onChange:o=>G(o.target.value),sx:{mb:2}}),k.length>0&&e.jsxs(Q,{sx:{p:2,bgcolor:"success.light",mt:2},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600,mb:1},children:"✅ Your new backup codes:"}),e.jsx(m,{container:!0,spacing:1,children:k.map((o,U)=>e.jsx(m,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",sx:{fontFamily:"monospace",fontWeight:500},children:o})},U))}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(c,{size:"small",startIcon:e.jsx(ne,{}),onClick:()=>$(k.join(`
`)),children:"Copy All Codes"})})]})]}),e.jsxs(ae,{children:[e.jsx(c,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(c,{onClick:K,variant:"contained",disabled:!L.trim()||I,children:k.length>0?"Close":"Generate New Codes"})]})]}),e.jsx(Z,{open:M.open,onClose:H,PaperProps:{sx:{position:"fixed",bottom:16,left:16,right:"auto",m:0,minWidth:300}},children:e.jsx(_,{onClose:H,severity:M.severity,sx:{mb:0},children:M.message})})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(t,{children:"Loading 2FA status..."})})},Ze=()=>{const x=ze(),[r,p]=ve(),[l,D]=i.useState(null),[z,a]=i.useState(!0),[T,v]=i.useState(""),[Y,b]=i.useState(!1);i.useEffect(()=>{r.get("ekycSubmitted")==="true"&&(b(!0),r.delete("ekycSubmitted"),p(r,{replace:!0})),E()},[r,p]);const E=async()=>{try{a(!0);const j=await fetch("http://localhost:3030/ekyc/status",{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(!j.ok)throw new Error("Failed to fetch eKYC status");const k=await j.json();D(k)}catch(j){console.error("eKYC status error:",j),v(j.message)}finally{a(!1)}},F=j=>{switch(j){case"pending":return{color:"warning",icon:e.jsx(oe,{}),label:"Pending Review",message:"Your identity verification is pending review by our team."};case"under_review":return{color:"info",icon:e.jsx(oe,{}),label:"Under Review",message:"Our team is currently reviewing your identity verification."};case"approved":return{color:"success",icon:e.jsx(Re,{}),label:"Approved",message:"Your identity has been verified successfully!"};case"rejected":return{color:"error",icon:e.jsx(je,{}),label:"Rejected",message:"Your verification was rejected. Please submit again with correct documents."};case"expired":return{color:"warning",icon:e.jsx(je,{}),label:"Expired",message:"Your ID has expired. Please submit a new verification."};default:return{color:"info",icon:e.jsx(oe,{}),label:"Unknown",message:""}}};if(z)return e.jsx(A,{children:e.jsx(W,{children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(we,{})})})});if(T)return e.jsx(A,{children:e.jsx(W,{children:e.jsx(_,{severity:"warning",children:"Unable to load eKYC status. This feature may not be available yet."})})});if(!l)return e.jsx(A,{sx:{border:2,borderColor:"primary.main",borderStyle:"dashed"},children:e.jsxs(W,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Te,{sx:{fontSize:40,color:"primary.main",mr:2}}),e.jsxs(n,{children:[e.jsx(t,{variant:"h6",children:"Enable Self Check-in"}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Complete your identity verification"})]})]}),e.jsx(t,{variant:"body2",paragraph:!0,children:"Complete eKYC (electronic Know Your Customer) verification to enable self-check-in for your bookings. No more waiting at the front desk!"}),e.jsxs(_,{severity:"info",sx:{mb:2},children:[e.jsx(t,{variant:"body2",children:e.jsx("strong",{children:"Benefits:"})}),e.jsx(t,{variant:"caption",component:"div",children:"• Skip the front desk queue"}),e.jsx(t,{variant:"caption",component:"div",children:"• Instant room access upon arrival"})]}),e.jsx(c,{variant:"contained",fullWidth:!0,startIcon:e.jsx(ie,{}),onClick:()=>x("/ekyc"),children:"Start eKYC Verification"})]})});const w=F(l.status);return e.jsx(A,{children:e.jsxs(W,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(n,{sx:{color:`${w.color}.main`,mr:2},children:w.icon}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(t,{variant:"h6",children:"eKYC Verification"}),e.jsx(ce,{label:w.label,color:w.color,size:"small",sx:{mt:.5}})]})]}),Y&&(l.status==="pending"||l.status==="under_review")&&e.jsx(_,{severity:"success",sx:{mb:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Submission Received!"})," Your eKYC verification has been successfully submitted and is now under review. We'll notify you once it's been processed."]})}),e.jsx(_,{severity:w.color,sx:{mb:2},children:w.message}),l.self_checkin_enabled&&e.jsx(_,{severity:"success",sx:{mb:2},children:e.jsxs(t,{variant:"body2",children:[e.jsx("strong",{children:"Self check-in is enabled!"})," You can now check in to your bookings without visiting the front desk."]})}),e.jsxs(n,{sx:{mt:2},children:[e.jsxs(t,{variant:"caption",color:"text.secondary",display:"block",children:["Submitted: ",fe(new Date(l.submitted_at),"MMM dd, yyyy")]}),l.verified_at&&e.jsxs(t,{variant:"caption",color:"text.secondary",display:"block",children:["Verified: ",fe(new Date(l.verified_at),"MMM dd, yyyy")]}),l.verification_notes&&e.jsxs(t,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:[e.jsx("strong",{children:"Notes:"})," ",l.verification_notes]})]}),(l.status==="rejected"||l.status==="expired")&&e.jsx(c,{variant:"outlined",fullWidth:!0,sx:{mt:2},onClick:()=>x("/ekyc"),children:"Submit New Verification"})]})})};function ee(x){const{children:r,value:p,index:l,...D}=x;return e.jsx("div",{role:"tabpanel",hidden:p!==l,id:`profile-tabpanel-${l}`,"aria-labelledby":`profile-tab-${l}`,...D,children:p===l&&e.jsx(n,{sx:{pt:3},children:r})})}const ke=x=>{const r=x.toLowerCase();return r.includes("macbook")||r.includes("laptop")||r.includes("thinkpad")||r.includes("notebook")||r.includes("xps")||r.includes("surface laptop")||r.includes("chromebook")?{type:"laptop",icon:e.jsx($e,{}),color:"#1976d2",label:"Laptop",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}:r.includes("desktop")||r.includes("pc")||r.includes("imac")||r.includes("mac mini")||r.includes("mac studio")||r.includes("workstation")?{type:"desktop",icon:e.jsx(Ke,{}),color:"#2e7d32",label:"Desktop",gradient:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"}:r.includes("ipad")||r.includes("tablet")||r.includes("surface pro")||r.includes("galaxy tab")?{type:"tablet",icon:e.jsx(Je,{}),color:"#ed6c02",label:"Tablet",gradient:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}:r.includes("iphone")||r.includes("android")||r.includes("pixel")||r.includes("samsung")||r.includes("galaxy")||r.includes("mobile")||r.includes("phone")||r.includes("oneplus")||r.includes("xiaomi")?{type:"mobile",icon:r.includes("iphone")?e.jsx(Oe,{}):e.jsx(Qe,{}),color:"#9c27b0",label:r.includes("iphone")?"iPhone":"Mobile",gradient:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)"}:r.includes("yubikey")||r.includes("security key")||r.includes("fido")||r.includes("u2f")||r.includes("token")?{type:"security-key",icon:e.jsx(se,{}),color:"#d32f2f",label:"Security Key",gradient:"linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%)"}:{type:"unknown",icon:e.jsx(le,{}),color:"#757575",label:"Device",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},es=({deviceName:x,size:r=48})=>{const p=ke(x);return e.jsxs(n,{sx:{position:"relative",width:r+16,height:r+16,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(n,{sx:{position:"absolute",width:"100%",height:"100%",borderRadius:"50%",background:p.gradient,opacity:.2,animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%, 100%":{transform:"scale(0.95)",opacity:.2},"50%":{transform:"scale(1.05)",opacity:.3}}}}),e.jsx(n,{sx:{position:"relative",width:r,height:r,borderRadius:"50%",background:p.gradient,display:"flex",alignItems:"center",justifyContent:"center",color:"white",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transition:"transform 0.3s ease","&:hover":{transform:"scale(1.1) rotate(5deg)"},"& svg":{fontSize:r*.6,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"}},children:p.icon})]})},ws=()=>{var he,xe;const[x,r]=ve(),[p,l]=i.useState(0),[D,z]=i.useState(!0),[a,T]=i.useState(null),[v,Y]=i.useState([]),[b,E]=i.useState(!1),[F,w]=i.useState(null),[j,k]=i.useState(""),[N,L]=i.useState({open:!1,message:"",severity:"success"}),[G,I]=i.useState(""),[C,M]=i.useState(""),[d,g]=i.useState({full_name:"",email:"",phone:"",avatar_url:""}),[u,R]=i.useState({current_password:"",new_password:"",confirm_password:""}),[V,K]=i.useState(!1),{registerPasskey:$}=Ee();i.useEffect(()=>{f(),H(),x.get("edit")==="true"&&(E(!0),x.delete("edit"),r(x,{replace:!0}))},[]);const f=async()=>{try{const s=await P.getUserProfile();T(s),g({full_name:s.full_name||"",email:s.email||"",phone:s.phone||"",avatar_url:s.avatar_url||""})}catch(s){console.error("Failed to load profile:",s),h("Failed to load profile","error")}finally{z(!1)}},H=async()=>{try{const s=await P.listPasskeys();Y(s)}catch(s){console.error("Failed to load passkeys:",s)}},o=async()=>{const s=ye(d.email);if(s){I(s),h(s,"error");return}try{await P.updateUserProfile(d),E(!1),await f(),h("Profile updated successfully","success")}catch(y){console.error("Failed to update profile:",y),h("Failed to update profile","error")}},U=()=>{if(!u.current_password){h("Please enter your current password","error");return}if(u.current_password.length<3){h("Please enter a valid password","error");return}K(!0)},Ce=async()=>{if(!u.current_password||!u.new_password){h("Please fill in all password fields","error");return}if(u.new_password!==u.confirm_password){h("New passwords do not match","error");return}if(u.new_password.length<8){h("Password must be at least 8 characters long","error");return}try{await P.updatePassword({current_password:u.current_password,new_password:u.new_password}),R({current_password:"",new_password:"",confirm_password:""}),K(!1),h("Password updated successfully","success")}catch(s){console.error("Failed to update password:",s),h(s.message||"Failed to update password","error")}},Se=()=>{R({current_password:"",new_password:"",confirm_password:""}),K(!1)},Pe=async s=>{if(window.confirm("Are you sure you want to delete this passkey?"))try{await P.deletePasskey(s),await H(),h("Passkey deleted successfully","success")}catch(y){console.error("Failed to delete passkey:",y),h("Failed to delete passkey","error")}},de=async()=>{if(v.length>=10){h("Maximum of 10 passkeys allowed","error");return}if(a)try{await $(a.username),await H(),h("Passkey registered successfully","success")}catch(s){console.error("Failed to register passkey:",s),h(s.message||"Failed to register passkey","error")}},_e=(s,y)=>{w(s),k(y||"")},Fe=async s=>{if(!j.trim()){h("Passkey name cannot be empty","error");return}try{await P.updatePasskey(s,{device_name:j}),w(null),k(""),await H(),h("Passkey name updated successfully","success")}catch(y){console.error("Failed to update passkey:",y),h("Failed to update passkey name","error")}},Ie=()=>{w(null),k("")},h=(s,y)=>{L({open:!0,message:s,severity:y})},ue=()=>{L({...N,open:!1})};return D?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(we,{size:60})}):a?e.jsxs(n,{children:[e.jsx(t,{variant:"h4",gutterBottom:!0,sx:{fontWeight:700,mb:3,color:"primary.main"},children:"User Profile"}),e.jsx(A,{sx:{mb:3},children:e.jsxs(We,{value:p,onChange:(s,y)=>l(y),children:[e.jsx(X,{label:"Profile",icon:e.jsx(me,{}),iconPosition:"start"}),e.jsx(X,{label:"Security",icon:e.jsx(be,{}),iconPosition:"start"}),e.jsx(X,{label:"Passkeys",icon:e.jsx(le,{}),iconPosition:"start"}),e.jsx(X,{label:"2FA",icon:e.jsx(se,{}),iconPosition:"start"})]})}),e.jsxs(ee,{value:p,index:0,children:[e.jsx(n,{sx:{mb:3},children:e.jsx(Ze,{})}),e.jsx(A,{children:e.jsxs(W,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(pe,{src:d.avatar_url||(a==null?void 0:a.avatar_url),sx:{width:80,height:80,mr:3,bgcolor:"primary.main",fontSize:"2rem",fontWeight:600},children:!d.avatar_url&&!(a!=null&&a.avatar_url)&&(((he=a==null?void 0:a.full_name)==null?void 0:he.charAt(0))||((xe=a==null?void 0:a.username)==null?void 0:xe.charAt(0)))}),e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600},children:(a==null?void 0:a.full_name)||(a==null?void 0:a.username)}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["@",a==null?void 0:a.username]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Member since ",new Date(a==null?void 0:a.created_at).toLocaleDateString()]})]}),b?e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(c,{variant:"outlined",startIcon:e.jsx(ge,{}),onClick:()=>{E(!1),g({full_name:(a==null?void 0:a.full_name)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",avatar_url:(a==null?void 0:a.avatar_url)||""})},children:"Cancel"}),e.jsx(c,{variant:"contained",startIcon:e.jsx(Ve,{}),onClick:o,children:"Save"})]}):e.jsx(c,{variant:"contained",startIcon:e.jsx(me,{}),onClick:()=>E(!0),children:"Edit Profile"})]}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(S,{fullWidth:!0,label:"Full Name",value:d.full_name,onChange:s=>g({...d,full_name:s.target.value}),disabled:!b})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(S,{fullWidth:!0,label:"Email",type:"email",value:d.email,onChange:s=>{g({...d,email:s.target.value}),I("")},onBlur:()=>{b&&I(ye(d.email))},error:!!G,helperText:G,disabled:!b})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(S,{fullWidth:!0,label:"Phone",value:d.phone,onChange:s=>{g({...d,phone:s.target.value}),M("")},onBlur:()=>M(""),error:!!C,helperText:C,disabled:!b})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Avatar URL",value:d.avatar_url,onChange:s=>g({...d,avatar_url:s.target.value}),disabled:!b,helperText:"Enter a URL to your profile picture or upload an image below"})}),b&&e.jsxs(m,{item:!0,xs:12,children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(c,{variant:"outlined",component:"label",disabled:!b,children:["Upload Profile Picture",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:s=>{var O;const y=(O=s.target.files)==null?void 0:O[0];if(y){if(y.size>2*1024*1024){h("Image size must be less than 2MB","error");return}const q=new FileReader;q.onloadend=()=>{g({...d,avatar_url:q.result})},q.readAsDataURL(y)}}})]}),d.avatar_url&&e.jsx(c,{variant:"text",color:"error",onClick:()=>g({...d,avatar_url:""}),children:"Remove Picture"}),d.avatar_url&&e.jsx(pe,{src:d.avatar_url,sx:{width:40,height:40}})]}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Supported formats: JPG, PNG, GIF. Max size: 2MB"})]})]})]})})]}),e.jsx(ee,{value:p,index:1,children:e.jsx(A,{children:e.jsxs(W,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,mb:3},children:"Change Password"}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,type:"password",label:"Current Password",value:u.current_password,onChange:s=>R({...u,current_password:s.target.value}),disabled:V,helperText:V?"":"Enter your current password to continue"})}),!V&&e.jsx(m,{item:!0,xs:12,children:e.jsx(n,{sx:{display:"flex",gap:2},children:e.jsx(c,{variant:"contained",onClick:U,disabled:!u.current_password,children:"Continue"})})}),V&&e.jsxs(e.Fragment,{children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(S,{fullWidth:!0,type:"password",label:"New Password",value:u.new_password,onChange:s=>R({...u,new_password:s.target.value}),helperText:"Minimum 8 characters"})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(S,{fullWidth:!0,type:"password",label:"Confirm New Password",value:u.confirm_password,onChange:s=>R({...u,confirm_password:s.target.value})})})]})]}),V&&e.jsxs(n,{sx:{mt:3,display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(c,{variant:"outlined",onClick:Se,children:"Cancel"}),e.jsx(c,{variant:"contained",startIcon:e.jsx(be,{}),onClick:Ce,disabled:!u.new_password||!u.confirm_password,children:"Update Password"})]})]})})}),e.jsx(ee,{value:p,index:2,children:e.jsx(A,{children:e.jsxs(W,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{children:[e.jsxs(t,{variant:"h6",sx:{fontWeight:600},children:["Registered Passkeys (",v.length,"/10)"]}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Passkeys provide secure, passwordless authentication"})]}),e.jsx(c,{variant:"contained",startIcon:e.jsx(ie,{}),onClick:de,disabled:v.length>=10,children:"Add Passkey"})]}),v.length===0?e.jsxs(n,{sx:{textAlign:"center",py:6,backgroundColor:"background.default",borderRadius:2},children:[e.jsx(le,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No passkeys registered"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Add a passkey for secure, passwordless login"}),e.jsx(c,{variant:"outlined",startIcon:e.jsx(ie,{}),onClick:de,children:"Register Your First Passkey"})]}):e.jsx(Le,{children:v.map((s,y)=>{const O=ke(s.device_name||"");return e.jsxs(He,{divider:y<v.length-1,sx:{py:2.5,px:2,borderRadius:2,mb:1,transition:"all 0.3s ease","&:hover":{backgroundColor:"action.hover",transform:"translateX(4px)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}},children:[e.jsx(n,{sx:{mr:2},children:e.jsx(es,{deviceName:s.device_name||"",size:48})}),F===s.id?e.jsxs(n,{sx:{flexGrow:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{size:"small",value:j,onChange:q=>k(q.target.value),placeholder:"Device name (e.g., MacBook Pro, iPhone 15, YubiKey)",autoFocus:!0,sx:{flexGrow:1}}),e.jsx(J,{color:"primary",onClick:()=>Fe(s.id),title:"Save",children:e.jsx(Be,{})}),e.jsx(J,{onClick:Ie,title:"Cancel",children:e.jsx(ge,{})})]}):e.jsx(Me,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600},children:s.device_name||"Unnamed Device"}),e.jsx(ce,{label:O.label,size:"small",sx:{background:O.gradient,color:"white",fontWeight:500,fontSize:"0.7rem",height:20}})]}),secondary:e.jsxs(n,{sx:{mt:.5},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx("strong",{children:"Added:"})," ",new Date(s.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),s.last_used_at&&e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx("strong",{children:"Last used:"})," ",new Date(s.last_used_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})," at ",new Date(s.last_used_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]}),!s.last_used_at&&e.jsx(t,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"Never used"})]})}),e.jsx(Ue,{children:F!==s.id&&e.jsxs(e.Fragment,{children:[e.jsx(J,{edge:"end",onClick:()=>_e(s.id,s.device_name||""),title:"Edit passkey name",sx:{mr:1,"&:hover":{backgroundColor:"primary.light",color:"primary.contrastText"}},children:e.jsx(Ne,{})}),e.jsx(J,{edge:"end",color:"error",onClick:()=>Pe(s.id),title:"Delete passkey",sx:{"&:hover":{backgroundColor:"error.light",color:"error.contrastText"}},children:e.jsx(Ye,{})})]})})]},s.id)})}),v.length>=10&&e.jsx(_,{severity:"info",sx:{mt:2},children:"Maximum number of passkeys reached (10/10). Delete a passkey to add a new one."})]})})}),e.jsx(ee,{value:p,index:3,children:e.jsx(Xe,{})}),e.jsx(Ge,{open:N.open,autoHideDuration:6e3,onClose:ue,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(_,{onClose:ue,severity:N.severity,sx:{width:"100%"},children:N.message})})]}):e.jsx(_,{severity:"error",children:"Failed to load user profile. Please try again."})};export{ws as default};
