import{h as ue,r as o,H as j,j as e,A as S,B as D,C as I,T as a,f as xe,o as d,I as G,n as m,t as he}from"./index-DnWmqzJF.js";import{u as pe}from"./useCurrency-C4JSCWBJ.js";import{t as je}from"./currency-SgYezy9c.js";import{S as ge}from"./Snackbar-BmHWVIFe.js";import{A as fe}from"./Add-C7DSqfba.js";import{G as t}from"./Grid-0tqG7FTE.js";import{C as g,a as A}from"./CardContent-BhQI87uj.js";import{T as be,a as ye,b as _e,c as $,d as i,e as Ce}from"./TableRow-B78mTfEk.js";import{C as Y}from"./Chip-CSuofl6d.js";import{E as ve}from"./Edit-v4qS8plG.js";import{D as Re}from"./Delete-CC6nSGco.js";import{D as P,a as E,b as O,c as B}from"./DialogTitle-DKxRfOzX.js";import{F as Te}from"./FormControlLabel-Ddfix5uo.js";import{S as Se}from"./Switch-CZyKJHRo.js";import{C as J}from"./Cancel-zFl1_j2m.js";import{S as K}from"./Save-B20zNACZ.js";const qe=()=>{var U;const{hasRole:f,hasPermission:N}=ue(),{format:z,symbol:Q}=pe();f("admin");const k=f("admin")||f("receptionist")||f("manager")||N("rooms:read")||N("rooms:manage"),[b,V]=o.useState([]),[y,X]=o.useState([]),[Z,M]=o.useState(!0),[H,c]=o.useState(null),[ee,_]=o.useState(!1),[se,C]=o.useState(!1),[re,v]=o.useState(!1),[r,n]=o.useState({room_number:"",room_type_id:"",floor:"",building:"",custom_price:"",is_accessible:!1}),[u,L]=o.useState(null),[p,q]=o.useState(null),[x,h]=o.useState(!1),[te,R]=o.useState(!1),[oe,W]=o.useState("");o.useEffect(()=>{k&&T()},[k]);const T=async()=>{try{M(!0);const[s,l]=await Promise.all([j.getAllRooms(),j.getRoomTypes()]);V(s),X(l),c(null)}catch(s){c(s.message||"Failed to load data")}finally{M(!1)}},w=()=>{n({room_number:"",room_type_id:"",floor:"",building:"",custom_price:"",is_accessible:!1})},ae=()=>{w(),_(!0)},ie=s=>{L(s);const l=y.find(me=>me.name===s.room_type);n({room_number:s.room_number,room_type_id:(l==null?void 0:l.id)||"",floor:"",building:"",custom_price:typeof s.price_per_night=="string"?parseFloat(s.price_per_night):s.price_per_night,is_accessible:!1}),C(!0)},ne=s=>{q(s),v(!0)},le=async()=>{if(!r.room_number||!r.room_type_id||r.floor===""){c("Please fill in all required fields");return}const s=F(r.room_type_id);if(!s){c("Invalid room type selected");return}try{h(!0),await j.createRoom({room_number:r.room_number,room_type:s.name,room_type_id:r.room_type_id,price_per_night:r.custom_price?r.custom_price:Number(s.base_price),max_occupancy:s.max_occupancy,floor:r.floor,building:r.building||void 0,custom_price:r.custom_price?r.custom_price:void 0,is_accessible:r.is_accessible}),W("Room created successfully"),R(!0),_(!1),w(),await T()}catch(l){c(l.message||"Failed to create room")}finally{h(!1)}},ce=async()=>{if(u)try{h(!0),await j.updateRoom(u.id,{room_number:r.room_number,price_per_night:r.custom_price?r.custom_price:void 0,available:u.available}),W("Room updated successfully"),R(!0),C(!1),L(null),w(),await T()}catch(s){c(s.message||"Failed to update room")}finally{h(!1)}},de=async()=>{if(p)try{h(!0),await j.deleteRoom(Number(p.id)),W("Room deleted successfully"),R(!0),v(!1),q(null),await T()}catch(s){c(s.message||"Failed to delete room")}finally{h(!1)}},F=s=>y.find(l=>l.id===s);return k?Z?e.jsx(D,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(I,{})}):e.jsxs(D,{sx:{p:3},children:[e.jsx(ge,{open:te,autoHideDuration:6e3,onClose:()=>R(!1),message:oe}),e.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(D,{children:[e.jsxs(a,{variant:"h4",sx:{fontWeight:700,display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{sx:{fontSize:32}}),"Room Configuration"]}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Manage room inventory - Create, edit, and delete rooms"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(fe,{}),onClick:ae,sx:{borderRadius:2},children:"Add New Room"})]}),H&&e.jsx(S,{severity:"error",sx:{mb:2},onClose:()=>c(null),children:H}),e.jsxs(t,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{children:e.jsxs(A,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"primary.main"},children:b.length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Rooms"})]})})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{children:e.jsxs(A,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"success.main"},children:b.filter(s=>s.available).length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Available"})]})})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{children:e.jsxs(A,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"info.main"},children:y.length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Room Types"})]})})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(g,{children:e.jsxs(A,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"warning.main"},children:b.filter(s=>!s.available).length}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Unavailable"})]})})})]}),e.jsx(g,{children:e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(_e,{children:e.jsxs($,{children:[e.jsx(i,{children:"Room Number"}),e.jsx(i,{children:"Room Type"}),e.jsx(i,{children:"Price/Night"}),e.jsx(i,{children:"Max Occupancy"}),e.jsx(i,{children:"Status"}),e.jsx(i,{align:"right",children:"Actions"})]})}),e.jsx(Ce,{children:b.map(s=>e.jsxs($,{children:[e.jsx(i,{children:e.jsx(a,{variant:"body2",sx:{fontWeight:600},children:s.room_number})}),e.jsx(i,{children:e.jsx(Y,{label:s.room_type,size:"small",color:"primary",variant:"outlined"})}),e.jsx(i,{children:z(typeof s.price_per_night=="string"?parseFloat(s.price_per_night):s.price_per_night)}),e.jsxs(i,{children:[s.max_occupancy," guests"]}),e.jsx(i,{children:e.jsx(Y,{label:s.available?"Available":"Unavailable",size:"small",color:s.available?"success":"default"})}),e.jsxs(i,{align:"right",children:[e.jsx(G,{size:"small",onClick:()=>ie(s),color:"primary",children:e.jsx(ve,{})}),e.jsx(G,{size:"small",onClick:()=>ne(s),color:"error",children:e.jsx(Re,{})})]})]},s.id))})]})})}),e.jsxs(P,{open:ee,onClose:()=>_(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(E,{children:"Create New Room"}),e.jsx(O,{children:e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Room Number",value:r.room_number,onChange:s=>n({...r,room_number:s.target.value}),required:!0,helperText:"e.g., 101, 102, 201A"})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(m,{select:!0,fullWidth:!0,label:"Room Type",value:r.room_type_id,onChange:s=>n({...r,room_type_id:parseInt(s.target.value)}),required:!0,children:y.map(s=>e.jsxs(he,{value:s.id,children:[s.name," (",s.code,")"]},s.id))})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Floor",type:"number",value:r.floor,onChange:s=>n({...r,floor:parseInt(s.target.value)}),required:!0,inputProps:{min:0}})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Building",value:r.building,onChange:s=>n({...r,building:s.target.value}),helperText:"Optional, e.g., Main Building, Tower A"})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:`Custom Price (${Q})`,type:"number",value:r.custom_price,onChange:s=>n({...r,custom_price:parseFloat(s.target.value)}),inputProps:{step:"0.01",min:"0"},helperText:r.room_type_id&&F(r.room_type_id)?`Base price: ${z(je((U=F(r.room_type_id))==null?void 0:U.base_price))}`:"Leave empty to use room type base price"})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(Te,{control:e.jsx(Se,{checked:r.is_accessible,onChange:s=>n({...r,is_accessible:s.target.checked})}),label:"Wheelchair Accessible"})})]})}),e.jsxs(B,{children:[e.jsx(d,{onClick:()=>_(!1),startIcon:e.jsx(J,{}),children:"Cancel"}),e.jsx(d,{onClick:le,variant:"contained",startIcon:e.jsx(K,{}),disabled:x,children:x?e.jsx(I,{size:20}):"Create Room"})]})]}),e.jsxs(P,{open:se,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(E,{children:["Edit Room ",u==null?void 0:u.room_number]}),e.jsx(O,{children:e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Room Number",value:r.room_number,onChange:s=>n({...r,room_number:s.target.value})})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Custom Price (RM)",type:"number",value:r.custom_price,onChange:s=>n({...r,custom_price:parseFloat(s.target.value)}),inputProps:{step:"0.01",min:"0"},helperText:"Leave empty to use room type base price"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(S,{severity:"info",children:"Room type, floor, and building cannot be changed after creation. To change these, please delete and recreate the room."})})]})}),e.jsxs(B,{children:[e.jsx(d,{onClick:()=>C(!1),startIcon:e.jsx(J,{}),children:"Cancel"}),e.jsx(d,{onClick:ce,variant:"contained",startIcon:e.jsx(K,{}),disabled:x,children:x?e.jsx(I,{size:20}):"Save Changes"})]})]}),e.jsxs(P,{open:re,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(E,{children:"Delete Room"}),e.jsxs(O,{children:[e.jsxs(S,{severity:"warning",sx:{mb:2},children:["Are you sure you want to delete room ",e.jsx("strong",{children:p==null?void 0:p.room_number}),"?"]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"This action cannot be undone. The room can only be deleted if it has no existing bookings."})]}),e.jsxs(B,{children:[e.jsx(d,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(d,{onClick:de,variant:"contained",color:"error",disabled:x,children:x?e.jsx(I,{size:20}):"Delete Room"})]})]})]}):e.jsx(S,{severity:"warning",children:"You do not have permission to access this page. Contact your administrator for access."})};export{qe as default};
