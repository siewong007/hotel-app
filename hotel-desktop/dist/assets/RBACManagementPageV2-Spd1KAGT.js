import{r as l,a as ge,g as he,u as ae,ae as ds,af as H,c as q,s as G,j as e,b as ne,p as fe,m as Q,ag as Fe,T as $,ah as Te,ai as ps,aj as ms,ak as us,al as xs,am as de,an as gs,a9 as Be,ao as hs,ap as fs,d as z,l as We,H as B,aq as ys,B as y,D as je,L as bs,w as Le,C as L,q as ee,I as Y,V as Ge,Y as He,G as qe,aa as Ce,ac as Ye,ad as $e,W as Ue,N as Ke,f as Qe,n as O,o as _,A as X,t as J,P as Ze,ar as js,Z as vs,as as Cs,R as Ve,F as ws,y as Ss,S as Rs,at as Ps,x as Oe,a0 as ks,a1 as Re}from"./index-DnWmqzJF.js";import{E as Je,a as As}from"./ExpandMore-DENjYJ81.js";import{C as Z}from"./Chip-CSuofl6d.js";import{g as Is,l as ce}from"./listItemButtonClasses-Cwcgs-VK.js";import{A as we}from"./Add-C7DSqfba.js";import{S as se}from"./Stack-DcjgMJBo.js";import{P as Se,A as Ds}from"./VpnKey-Bov3f6WK.js";import{M as Xe}from"./Star-BduLiDpP.js";import{C as es}from"./Collapse-B4NV5VtR.js";import{L as Ns}from"./LinearProgress-ZsFGqIbl.js";import{I as ss}from"./InputAdornment-BrN3aL1-.js";import{S as Ms}from"./Search-CErNxQ4Y.js";import{D as pe,a as me,b as ue,c as xe}from"./DialogTitle-DKxRfOzX.js";import{N as Ts}from"./PersonOutline-CU-_kcHt.js";import{C as Ws,a as $s}from"./CardContent-BhQI87uj.js";import{C as Us,V as Es}from"./VisibilityOff-JntHt1L2.js";import{E as De}from"./Edit-v4qS8plG.js";import{D as Ne}from"./Delete-CC6nSGco.js";import{F as os}from"./FormControlLabel-Ddfix5uo.js";import{S as ts}from"./Switch-CZyKJHRo.js";import{C as zs}from"./Close-93h3i8eI.js";import{S as Bs}from"./Save-B20zNACZ.js";import{G as _e}from"./Grid-0tqG7FTE.js";import{P as Me}from"./PersonAdd-C6oEVzXr.js";import{T as Vs,a as Os,b as _s,c as Pe,d as V,e as Fs}from"./TableRow-B78mTfEk.js";import{V as Ls}from"./Visibility-DUc7LFax.js";import{C as Gs}from"./Checkbox-1RYp8RQ2.js";import{S as Hs}from"./Snackbar-BmHWVIFe.js";const rs=l.createContext({});function qs(s){return he("MuiAccordion",s)}const be=ge("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),Ys=s=>{const{classes:o,square:t,expanded:a,disabled:h,disableGutters:i}=s;return ne({root:["root",!t&&"rounded",a&&"expanded",h&&"disabled",!i&&"gutters"],heading:["heading"],region:["region"]},qs,o)},Ks=G(fe,{name:"MuiAccordion",slot:"Root",overridesResolver:(s,o)=>{const{ownerState:t}=s;return[{[`& .${be.region}`]:o.region},o.root,!t.square&&o.rounded,!t.disableGutters&&o.gutters]}})(Q(({theme:s})=>{const o={duration:s.transitions.duration.shortest};return{position:"relative",transition:s.transitions.create(["margin"],o),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(s.vars||s).palette.divider,transition:s.transitions.create(["opacity","background-color"],o)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${be.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${be.disabled}`]:{backgroundColor:(s.vars||s).palette.action.disabledBackground}}}),Q(({theme:s})=>({variants:[{props:o=>!o.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(s.vars||s).shape.borderRadius,borderTopRightRadius:(s.vars||s).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(s.vars||s).shape.borderRadius,borderBottomRightRadius:(s.vars||s).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:o=>!o.disableGutters,style:{[`&.${be.expanded}`]:{margin:"16px 0"}}}]}))),Qs=G("h3",{name:"MuiAccordion",slot:"Heading",overridesResolver:(s,o)=>o.heading})({all:"unset"}),Zs=l.forwardRef(function(o,t){const a=ae({props:o,name:"MuiAccordion"}),{children:h,className:i,defaultExpanded:n=!1,disabled:u=!1,disableGutters:m=!1,expanded:b,onChange:f,square:c=!1,slots:A={},slotProps:P={},TransitionComponent:S,TransitionProps:p,...v}=a,[N,g]=ds({controlled:b,default:n,name:"Accordion",state:"expanded"}),x=l.useCallback(F=>{g(!N),f&&f(F,!N)},[N,f,g]),[C,...T]=l.Children.toArray(h),w=l.useMemo(()=>({expanded:N,disabled:u,disableGutters:m,toggle:x}),[N,u,m,x]),M={...a,square:c,disabled:u,disableGutters:m,expanded:N},d=Ys(M),W={transition:S,...A},I={transition:p,...P},k={slots:W,slotProps:I},[E,j]=H("root",{elementType:Ks,externalForwardedProps:{...k,...v},className:q(d.root,i),shouldForwardComponentProp:!0,ownerState:M,ref:t,additionalProps:{square:c}}),[R,D]=H("heading",{elementType:Qs,externalForwardedProps:k,className:d.heading,ownerState:M}),[r,U]=H("transition",{elementType:es,externalForwardedProps:k,ownerState:M});return e.jsxs(E,{...j,children:[e.jsx(R,{...D,children:e.jsx(rs.Provider,{value:w,children:C})}),e.jsx(r,{in:N,timeout:"auto",...U,children:e.jsx("div",{"aria-labelledby":C.props.id,id:C.props["aria-controls"],role:"region",className:d.region,children:T})})]})});function Js(s){return he("MuiAccordionDetails",s)}ge("MuiAccordionDetails",["root"]);const Xs=s=>{const{classes:o}=s;return ne({root:["root"]},Js,o)},eo=G("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(s,o)=>o.root})(Q(({theme:s})=>({padding:s.spacing(1,2,2)}))),so=l.forwardRef(function(o,t){const a=ae({props:o,name:"MuiAccordionDetails"}),{className:h,...i}=a,n=a,u=Xs(n);return e.jsx(eo,{className:q(u.root,h),ref:t,ownerState:n,...i})});function oo(s){return he("MuiAccordionSummary",s)}const te=ge("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),to=s=>{const{classes:o,expanded:t,disabled:a,disableGutters:h}=s;return ne({root:["root",t&&"expanded",a&&"disabled",!h&&"gutters"],focusVisible:["focusVisible"],content:["content",t&&"expanded",!h&&"contentGutters"],expandIconWrapper:["expandIconWrapper",t&&"expanded"]},oo,o)},ro=G(Fe,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(s,o)=>o.root})(Q(({theme:s})=>{const o={duration:s.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:s.spacing(0,2),transition:s.transitions.create(["min-height","background-color"],o),[`&.${te.focusVisible}`]:{backgroundColor:(s.vars||s).palette.action.focus},[`&.${te.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity},[`&:hover:not(.${te.disabled})`]:{cursor:"pointer"},variants:[{props:t=>!t.disableGutters,style:{[`&.${te.expanded}`]:{minHeight:64}}}]}})),ao=G("span",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(s,o)=>o.content})(Q(({theme:s})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:o=>!o.disableGutters,style:{transition:s.transitions.create(["margin"],{duration:s.transitions.duration.shortest}),[`&.${te.expanded}`]:{margin:"20px 0"}}}]}))),no=G("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(s,o)=>o.expandIconWrapper})(Q(({theme:s})=>({display:"flex",color:(s.vars||s).palette.action.active,transform:"rotate(0deg)",transition:s.transitions.create("transform",{duration:s.transitions.duration.shortest}),[`&.${te.expanded}`]:{transform:"rotate(180deg)"}}))),io=l.forwardRef(function(o,t){const a=ae({props:o,name:"MuiAccordionSummary"}),{children:h,className:i,expandIcon:n,focusVisibleClassName:u,onClick:m,slots:b,slotProps:f,...c}=a,{disabled:A=!1,disableGutters:P,expanded:S,toggle:p}=l.useContext(rs),v=I=>{p&&p(I),m&&m(I)},N={...a,expanded:S,disabled:A,disableGutters:P},g=to(N),x={slots:b,slotProps:f},[C,T]=H("root",{ref:t,shouldForwardComponentProp:!0,className:q(g.root,i),elementType:ro,externalForwardedProps:{...x,...c},ownerState:N,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:A,"aria-expanded":S,focusVisibleClassName:q(g.focusVisible,u)},getSlotProps:I=>({...I,onClick:k=>{var E;(E=I.onClick)==null||E.call(I,k),v(k)}})}),[w,M]=H("content",{className:g.content,elementType:ao,externalForwardedProps:x,ownerState:N}),[d,W]=H("expandIconWrapper",{className:g.expandIconWrapper,elementType:no,externalForwardedProps:x,ownerState:N});return e.jsxs(C,{...T,children:[e.jsx(w,{...M,children:h}),n&&e.jsx(d,{...W,children:n})]})});function lo(s){return he("MuiDialogContentText",s)}ge("MuiDialogContentText",["root"]);const co=s=>{const{classes:o}=s,a=ne({root:["root"]},lo,o);return{...o,...a}},po=G($,{shouldForwardProp:s=>Te(s)||s==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(s,o)=>o.root})({}),mo=l.forwardRef(function(o,t){const a=ae({props:o,name:"MuiDialogContentText"}),{children:h,className:i,...n}=a,u=co(n);return e.jsx(po,{component:"p",variant:"body1",color:"textSecondary",ref:t,ownerState:n,className:q(u.root,i),...a,classes:u})});function uo(s){return he("MuiDrawer",s)}ge("MuiDrawer",["root","docked","paper","anchorLeft","anchorRight","anchorTop","anchorBottom","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const as=(s,o)=>{const{ownerState:t}=s;return[o.root,(t.variant==="permanent"||t.variant==="persistent")&&o.docked,o.modal]},xo=s=>{const{classes:o,anchor:t,variant:a}=s,h={root:["root",`anchor${de(t)}`],docked:[(a==="permanent"||a==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${de(t)}`,a!=="temporary"&&`paperAnchorDocked${de(t)}`]};return ne(h,uo,o)},go=G(gs,{name:"MuiDrawer",slot:"Root",overridesResolver:as})(Q(({theme:s})=>({zIndex:(s.vars||s).zIndex.drawer}))),ho=G("div",{shouldForwardProp:Te,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:as})({flex:"0 0 auto"}),fo=G(fe,{name:"MuiDrawer",slot:"Paper",overridesResolver:(s,o)=>{const{ownerState:t}=s;return[o.paper,o[`paperAnchor${de(t.anchor)}`],t.variant!=="temporary"&&o[`paperAnchorDocked${de(t.anchor)}`]]}})(Q(({theme:s})=>({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(s.vars||s).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0,variants:[{props:{anchor:"left"},style:{left:0}},{props:{anchor:"top"},style:{top:0,left:0,right:0,height:"auto",maxHeight:"100%"}},{props:{anchor:"right"},style:{right:0}},{props:{anchor:"bottom"},style:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"}},{props:({ownerState:o})=>o.anchor==="left"&&o.variant!=="temporary",style:{borderRight:`1px solid ${(s.vars||s).palette.divider}`}},{props:({ownerState:o})=>o.anchor==="top"&&o.variant!=="temporary",style:{borderBottom:`1px solid ${(s.vars||s).palette.divider}`}},{props:({ownerState:o})=>o.anchor==="right"&&o.variant!=="temporary",style:{borderLeft:`1px solid ${(s.vars||s).palette.divider}`}},{props:({ownerState:o})=>o.anchor==="bottom"&&o.variant!=="temporary",style:{borderTop:`1px solid ${(s.vars||s).palette.divider}`}}]}))),ns={left:"right",right:"left",top:"down",bottom:"up"};function yo(s){return["left","right"].includes(s)}function bo({direction:s},o){return s==="rtl"&&yo(o)?ns[o]:o}const jo=l.forwardRef(function(o,t){const a=ae({props:o,name:"MuiDrawer"}),h=ps(),i=ms(),n={enter:h.transitions.duration.enteringScreen,exit:h.transitions.duration.leavingScreen},{anchor:u="left",BackdropProps:m,children:b,className:f,elevation:c=16,hideBackdrop:A=!1,ModalProps:{BackdropProps:P,...S}={},onClose:p,open:v=!1,PaperProps:N={},SlideProps:g,TransitionComponent:x,transitionDuration:C=n,variant:T="temporary",slots:w={},slotProps:M={},...d}=a,W=l.useRef(!1);l.useEffect(()=>{W.current=!0},[]);const I=bo({direction:i?"rtl":"ltr"},u),E={...a,anchor:u,elevation:c,open:v,variant:T,...d},j=xo(E),R={slots:{transition:x,...w},slotProps:{paper:N,transition:g,...M,backdrop:us(M.backdrop||{...m,...P},{transitionDuration:C})}},[D,r]=H("root",{ref:t,elementType:go,className:q(j.root,j.modal,f),shouldForwardComponentProp:!0,ownerState:E,externalForwardedProps:{...R,...d,...S},additionalProps:{open:v,onClose:p,hideBackdrop:A,slots:{backdrop:R.slots.backdrop},slotProps:{backdrop:R.slotProps.backdrop}}}),[U,F]=H("paper",{elementType:fo,shouldForwardComponentProp:!0,className:q(j.paper,N.className),ownerState:E,externalForwardedProps:R,additionalProps:{elevation:T==="temporary"?c:0,square:!0}}),[ye,ie]=H("docked",{elementType:ho,ref:t,className:q(j.root,j.docked,f),ownerState:E,externalForwardedProps:R,additionalProps:d}),[le,K]=H("transition",{elementType:xs,ownerState:E,externalForwardedProps:R,additionalProps:{in:v,direction:ns[I],timeout:C,appear:W.current}}),Ee=e.jsx(U,{...F,children:b});if(T==="permanent")return e.jsx(ye,{...ie,children:Ee});const ze=e.jsx(le,{...K,children:Ee});return T==="persistent"?e.jsx(ye,{...ie,children:ze}):e.jsx(D,{...r,children:ze})}),vo=(s,o)=>{const{ownerState:t}=s;return[o.root,t.dense&&o.dense,t.alignItems==="flex-start"&&o.alignItemsFlexStart,t.divider&&o.divider,!t.disableGutters&&o.gutters]},Co=s=>{const{alignItems:o,classes:t,dense:a,disabled:h,disableGutters:i,divider:n,selected:u}=s,b=ne({root:["root",a&&"dense",!i&&"gutters",n&&"divider",h&&"disabled",o==="flex-start"&&"alignItemsFlexStart",u&&"selected"]},Is,t);return{...t,...b}},wo=G(Fe,{shouldForwardProp:s=>Te(s)||s==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:vo})(Q(({theme:s})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:s.transitions.create("background-color",{duration:s.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(s.vars||s).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ce.selected}`]:{backgroundColor:s.vars?`rgba(${s.vars.palette.primary.mainChannel} / ${s.vars.palette.action.selectedOpacity})`:z(s.palette.primary.main,s.palette.action.selectedOpacity),[`&.${ce.focusVisible}`]:{backgroundColor:s.vars?`rgba(${s.vars.palette.primary.mainChannel} / calc(${s.vars.palette.action.selectedOpacity} + ${s.vars.palette.action.focusOpacity}))`:z(s.palette.primary.main,s.palette.action.selectedOpacity+s.palette.action.focusOpacity)}},[`&.${ce.selected}:hover`]:{backgroundColor:s.vars?`rgba(${s.vars.palette.primary.mainChannel} / calc(${s.vars.palette.action.selectedOpacity} + ${s.vars.palette.action.hoverOpacity}))`:z(s.palette.primary.main,s.palette.action.selectedOpacity+s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:s.vars?`rgba(${s.vars.palette.primary.mainChannel} / ${s.vars.palette.action.selectedOpacity})`:z(s.palette.primary.main,s.palette.action.selectedOpacity)}},[`&.${ce.focusVisible}`]:{backgroundColor:(s.vars||s).palette.action.focus},[`&.${ce.disabled}`]:{opacity:(s.vars||s).palette.action.disabledOpacity},variants:[{props:({ownerState:o})=>o.divider,style:{borderBottom:`1px solid ${(s.vars||s).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:o})=>!o.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:o})=>o.dense,style:{paddingTop:4,paddingBottom:4}}]}))),So=l.forwardRef(function(o,t){const a=ae({props:o,name:"MuiListItemButton"}),{alignItems:h="center",autoFocus:i=!1,component:n="div",children:u,dense:m=!1,disableGutters:b=!1,divider:f=!1,focusVisibleClassName:c,selected:A=!1,className:P,...S}=a,p=l.useContext(Be),v=l.useMemo(()=>({dense:m||p.dense||!1,alignItems:h,disableGutters:b}),[h,p.dense,m,b]),N=l.useRef(null);hs(()=>{i&&N.current&&N.current.focus()},[i]);const g={...a,alignItems:h,dense:v.dense,disableGutters:b,divider:f,selected:A},x=Co(g),C=fs(N,t);return e.jsx(Be.Provider,{value:v,children:e.jsx(wo,{ref:C,href:S.href||S.to,component:(S.href||S.to)&&n==="div"?"button":n,focusVisibleClassName:q(x.focusVisible,c),ownerState:g,className:q(x.root,P),...S,classes:x,children:u})})}),Ro=We(e.jsx("path",{d:"M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 4h5v8l-2.5-1.5L6 12z"}),"Book"),is=We(e.jsx("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation"),Po=We(e.jsx("path",{d:"M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5M9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5 6 6.34 6 8s1.34 3 3 3m7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75M9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13"}),"SupervisorAccount"),re={rooms:{displayName:"Rooms",icon:"Hotel",color:"#1976d2"},bookings:{displayName:"Bookings",icon:"EventNote",color:"#2e7d32"},guests:{displayName:"Guests",icon:"People",color:"#ed6c02"},users:{displayName:"Users",icon:"PersonAdd",color:"#7b1fa2"},navigation:{displayName:"Navigation",icon:"Navigation",color:"#9c27b0"},settings:{displayName:"Settings",icon:"Settings",color:"#757575"},ekyc:{displayName:"eKYC",icon:"VerifiedUser",color:"#0288d1"},rbac:{displayName:"Access Control",icon:"Security",color:"#d32f2f"},loyalty:{displayName:"Loyalty",icon:"CardGiftcard",color:"#f57c00"},rewards:{displayName:"Rewards",icon:"Star",color:"#fbc02d"},ledgers:{displayName:"Ledgers",icon:"AccountBalance",color:"#5d4037"},analytics:{displayName:"Analytics",icon:"Assessment",color:"#00838f"}},ve={superadmin:"#6a1b9a",admin:"#d32f2f",manager:"#1976d2",receptionist:"#2e7d32",guest:"#757575",default:"#9e9e9e"},ko={core:"Core",management:"Management",analytics:"Analytics",system:"System"},ls=[{id:"timeline",label:"Reservation Timeline",path:"/timeline",icon:"EventNote",description:"View and manage room reservations timeline",category:"core"},{id:"my-bookings",label:"My Bookings",path:"/my-bookings",icon:"Book",description:"View personal bookings (Guest only)",category:"core"},{id:"guest-config",label:"Guest",path:"/guest-config",icon:"People",description:"Manage guest profiles and information",category:"management"},{id:"room-config",label:"Room Configuration",path:"/room-config",icon:"Hotel",description:"Manage room types and configurations",category:"management"},{id:"room-type-config",label:"Room Types",path:"/room-type-config",icon:"Category",description:"Configure room type settings and pricing",category:"management"},{id:"bookings",label:"Bookings",path:"/bookings",icon:"CalendarMonth",description:"View and manage all bookings",category:"management"},{id:"room-management",label:"Room Management",path:"/room-management",icon:"HomeWork",description:"Comprehensive room status and management dashboard",category:"management"},{id:"company-ledger",label:"Company Ledger",path:"/company-ledger",icon:"AccountBalance",description:"Manage company accounts and ledgers",category:"management"},{id:"complimentary",label:"Complimentary",path:"/complimentary",icon:"CardGiftcard",description:"Manage complimentary nights and credits",category:"management"},{id:"loyalty",label:"Loyalty Portal",path:"/loyalty",icon:"CardGiftcard",description:"Manage loyalty program and rewards",category:"analytics"},{id:"my-rewards",label:"My Rewards",path:"/my-rewards",icon:"Star",description:"View personal rewards (Guest only)",category:"core"},{id:"reports",label:"Reports",path:"/reports",icon:"Assessment",description:"View reports and analytics",category:"analytics"},{id:"ekyc-admin",label:"eKYC Verification",path:"/ekyc-admin",icon:"VerifiedUser",description:"Manage eKYC verifications",category:"system"},{id:"rbac",label:"Roles & Permissions",path:"/rbac",icon:"Security",description:"Manage roles and permissions",category:"system"},{id:"settings",label:"Settings",path:"/settings",icon:"Settings",description:"System settings and configuration",category:"system"}],cs={timeline:[{name:"rooms:read",resource:"rooms",action:"read",description:"View rooms and their availability"},{name:"bookings:read",resource:"bookings",action:"read",description:"View booking information"}],"my-bookings":[{name:"bookings:read",resource:"bookings",action:"read",description:"View booking information"}],"guest-config":[{name:"guests:read",resource:"guests",action:"read",description:"View guest information"},{name:"guests:manage",resource:"guests",action:"manage",description:"Manage guest profiles and data"}],"room-config":[{name:"rooms:read",resource:"rooms",action:"read",description:"View rooms and their availability"},{name:"rooms:manage",resource:"rooms",action:"manage",description:"Manage room configurations and settings"}],"room-type-config":[{name:"rooms:read",resource:"rooms",action:"read",description:"View rooms and their availability"},{name:"rooms:write",resource:"rooms",action:"write",description:"Create and modify room types"},{name:"rooms:manage",resource:"rooms",action:"manage",description:"Full room management access"}],bookings:[{name:"bookings:read",resource:"bookings",action:"read",description:"View booking information"},{name:"bookings:manage",resource:"bookings",action:"manage",description:"Manage all bookings"}],"room-management":[{name:"rooms:read",resource:"rooms",action:"read",description:"View rooms and their status"},{name:"rooms:manage",resource:"rooms",action:"manage",description:"Manage room status, availability, and assignments"}],"company-ledger":[{name:"ledgers:read",resource:"ledgers",action:"read",description:"View company ledgers"},{name:"ledgers:manage",resource:"ledgers",action:"manage",description:"Manage company accounts"}],complimentary:[{name:"bookings:read",resource:"bookings",action:"read",description:"View booking information"},{name:"bookings:update",resource:"bookings",action:"update",description:"Update booking details"}],loyalty:[{name:"loyalty:read",resource:"loyalty",action:"read",description:"View loyalty program data"},{name:"loyalty:manage",resource:"loyalty",action:"manage",description:"Manage loyalty program"}],"my-rewards":[{name:"rewards:read",resource:"rewards",action:"read",description:"View reward information"}],reports:[{name:"analytics:read",resource:"analytics",action:"read",description:"View analytics and reports"}],"ekyc-admin":[{name:"ekyc:manage",resource:"ekyc",action:"manage",description:"Manage eKYC verifications"}],rbac:[{name:"rbac:read",resource:"rbac",action:"read",description:"View roles and permissions"},{name:"rbac:manage",resource:"rbac",action:"manage",description:"Manage roles and permissions"},{name:"users:read",resource:"users",action:"read",description:"View user accounts"},{name:"users:manage",resource:"users",action:"manage",description:"Manage user accounts and role assignments"}],settings:[{name:"settings:read",resource:"settings",action:"read",description:"View system settings"},{name:"settings:manage",resource:"settings",action:"manage",description:"Manage system settings"}]},Ao=s=>{var o;return((o=re[s])==null?void 0:o.color)||"#9e9e9e"},oe=s=>ve[s.toLowerCase()]||ve.default;function Io(){const[s,o]=l.useState([]),[t,a]=l.useState([]),[h,i]=l.useState({}),[n,u]=l.useState([]),[m,b]=l.useState(!0),[f,c]=l.useState(null),A=l.useCallback(async()=>{b(!0),c(null);try{const[g,x,C]=await Promise.all([B.getAllRoles(),B.getAllPermissions(),B.getAllUsers()]);o(g),a(x);const T={};await Promise.all(g.map(async M=>{try{const{permissions:d}=await B.getRolePermissions(String(M.id));T[M.id]=d}catch{T[M.id]=[]}})),i(T);const w=await Promise.all(C.map(async M=>{try{const d=await B.getUserRolesAndPermissions(M.id);return{...M,roles:d.roles||[]}}catch{return{...M,roles:[]}}}));u(w)}catch(g){c(g.message||"Failed to load RBAC data")}finally{b(!1)}},[]);l.useEffect(()=>{A()},[A]);const P=l.useCallback((g,x)=>{i(C=>({...C,[g]:x}))},[]),S=l.useCallback((g,x)=>{u(C=>C.map(T=>{if(T.id===g){const w=s.filter(M=>x.includes(M.id));return{...T,roles:w}}return T}))},[s]),p=l.useMemo(()=>{const g={};return s.forEach(x=>{const C=h[x.id]||[];g[x.id]=new Set(C.map(T=>T.id))}),g},[s,h]),v=l.useMemo(()=>{const g={};return t.forEach(x=>{let C=x.resource;x.resource.includes(":")&&(C=x.resource.split(":")[0]),g[C]||(g[C]=[]),g[C].push(x)}),Object.entries(g).map(([x,C])=>{var T,w,M;return{name:x,displayName:((T=re[x])==null?void 0:T.displayName)||x.charAt(0).toUpperCase()+x.slice(1),icon:((w=re[x])==null?void 0:w.icon)||"VpnKey",color:((M=re[x])==null?void 0:M.color)||"#9e9e9e",permissions:C.sort((d,W)=>d.name.localeCompare(W.name))}}).sort((x,C)=>x.displayName.localeCompare(C.displayName))},[t]),N=l.useMemo(()=>s.map(g=>{const x=h[g.id]||[],T=x.filter(w=>w.resource.startsWith("navigation:")).map(w=>w.resource.replace("navigation:","")).filter(w=>ls.some(M=>M.id===w));return{...g,permissionCount:x.length,navigationCount:T.length,permissions:x,navigationItems:T}}),[s,h]);return{roles:s,permissions:t,rolePermissions:h,users:n,rolesWithStats:N,permissionCategories:v,rolePermissionMap:p,loading:m,error:f,reload:A,setRoles:o,setPermissions:a,setUsers:u,updateRolePermissions:P,updateUserRoles:S}}const Do=({role:s,onRemove:o,onClick:t,disabled:a=!1,size:h="small"})=>{const i=oe(s.name);return e.jsx(Z,{label:s.name,size:h,onClick:t,onDelete:o,disabled:a,variant:"outlined",sx:{backgroundColor:z(i,.1),color:i,borderColor:z(i,.5),fontWeight:500,"&:hover":{backgroundColor:z(i,.2),borderColor:i},"& .MuiChip-deleteIcon":{color:z(i,.7),"&:hover":{color:i}}}})},No=({anchorEl:s,onClose:o,availableRoles:t,onAddRole:a,loading:h=!1})=>{const[i,n]=l.useState(null),u=async m=>{n(m.id);try{await a(m),o()}catch{}finally{n(null)}};return e.jsxs(ys,{open:!!s,anchorEl:s,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{minWidth:200,maxHeight:300}},children:[e.jsx(y,{sx:{p:1.5,pb:1},children:e.jsx($,{variant:"subtitle2",color:"text.secondary",children:"Add role to permission"})}),e.jsx(je,{}),t.length===0?e.jsx(y,{sx:{p:2,textAlign:"center"},children:e.jsx($,{variant:"body2",color:"text.secondary",children:"All roles have this permission"})}):e.jsx(bs,{dense:!0,sx:{py:.5},children:t.map(m=>e.jsxs(So,{onClick:()=>u(m),disabled:h||i===m.id,sx:{py:1,"&:hover":{backgroundColor:`${oe(m.name)}10`}},children:[e.jsx(Le,{primary:m.name,secondary:m.description,primaryTypographyProps:{fontWeight:500,color:oe(m.name)},secondaryTypographyProps:{variant:"caption",noWrap:!0}}),i===m.id?e.jsx(L,{size:16,sx:{ml:1}}):e.jsx(we,{fontSize:"small",sx:{ml:1,opacity:.5}})]},m.id))})]})},Mo=({permission:s,assignedRoles:o,allRoles:t,onAddRole:a,onRemoveRole:h,disabled:i=!1})=>{const[n,u]=l.useState(null),[m,b]=l.useState(null),f=t.filter(S=>!o.some(p=>p.id===S.id)),c=async S=>{b(S.id);try{await h(s,S)}finally{b(null)}},A=async S=>{await a(s,S)},P=S=>{const p=S.split(":");return p.length===2?p[1].charAt(0).toUpperCase()+p[1].slice(1):S};return e.jsxs(y,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",py:1.5,px:2,borderBottom:"1px solid",borderColor:"divider","&:last-child":{borderBottom:"none"},"&:hover":{backgroundColor:"action.hover"}},children:[e.jsxs(y,{sx:{flex:1,minWidth:0,mr:2},children:[e.jsx($,{variant:"body2",fontWeight:600,sx:{mb:.25},children:s.name}),e.jsx($,{variant:"caption",color:"text.secondary",children:s.description||`${P(s.name)} access for ${s.resource}`})]}),e.jsxs(y,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:.5},children:[e.jsxs(se,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:[o.map(S=>e.jsx(Do,{role:S,onRemove:i||m===S.id?void 0:()=>c(S),disabled:i||m===S.id},S.id)),o.length===0&&e.jsx($,{variant:"caption",color:"text.disabled",sx:{fontStyle:"italic"},children:"No roles assigned"})]}),e.jsx(ee,{title:"Add role",children:e.jsx("span",{children:e.jsx(Y,{size:"small",onClick:S=>u(S.currentTarget),disabled:i||f.length===0,sx:{ml:.5,border:"1px dashed",borderColor:"divider",borderRadius:1,"&:hover":{borderColor:"primary.main",backgroundColor:"primary.50"}},children:e.jsx(we,{fontSize:"small"})})})}),e.jsx(No,{anchorEl:n,onClose:()=>u(null),availableRoles:f,onAddRole:A,loading:i})]})]})},To={Hotel:Qe,EventNote:Ke,People:Ue,Navigation:is,Settings:$e,VerifiedUser:Ye,Security:Ce,CardGiftcard:qe,Star:Xe,AccountBalance:He,Assessment:Ge,VpnKey:Se},Wo=({category:s,roles:o,rolePermissionMap:t,onAddRole:a,onRemoveRole:h,defaultExpanded:i=!1,disabled:n=!1})=>{const u=To[s.icon]||Se,m=o.filter(c=>s.permissions.some(A=>{var P;return(P=t[c.id])==null?void 0:P.has(A.id)})).length,b=o.length>0?m/o.length*100:0,f=c=>o.filter(A=>{var P;return(P=t[A.id])==null?void 0:P.has(c.id)});return e.jsxs(Zs,{defaultExpanded:i,disableGutters:!0,sx:{border:"1px solid",borderColor:"divider",borderRadius:2,mb:1.5,"&:before":{display:"none"},"&.Mui-expanded":{margin:0,mb:1.5}},children:[e.jsxs(io,{expandIcon:e.jsx(Je,{}),sx:{backgroundColor:z(s.color,.05),borderRadius:2,"&.Mui-expanded":{borderBottomLeftRadius:0,borderBottomRightRadius:0},"& .MuiAccordionSummary-content":{alignItems:"center",gap:1.5}},children:[e.jsx(y,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:36,height:36,borderRadius:1,backgroundColor:z(s.color,.15),color:s.color},children:e.jsx(u,{fontSize:"small"})}),e.jsx(y,{sx:{flex:1},children:e.jsx($,{variant:"subtitle1",fontWeight:600,children:s.displayName})}),e.jsx(Z,{label:`${s.permissions.length} permission${s.permissions.length!==1?"s":""}`,size:"small",sx:{backgroundColor:z(s.color,.1),color:s.color,fontWeight:500}}),e.jsx(y,{sx:{width:80,ml:1},children:e.jsx(Ns,{variant:"determinate",value:b,sx:{height:6,borderRadius:3,backgroundColor:z(s.color,.1),"& .MuiLinearProgress-bar":{backgroundColor:s.color,borderRadius:3}}})})]}),e.jsx(so,{sx:{p:0},children:s.permissions.map(c=>e.jsx(Mo,{permission:c,assignedRoles:f(c),allRoles:o,onAddRole:a,onRemoveRole:h,disabled:n},c.id))})]})},$o=({permissions:s,roles:o,permissionCategories:t,rolePermissionMap:a,onAddRoleToPermission:h,onRemoveRoleFromPermission:i,onPermissionCreated:n,loading:u=!1})=>{const[m,b]=l.useState(""),[f,c]=l.useState(!1),[A,P]=l.useState(!1),[S,p]=l.useState(null),[v,N]=l.useState({name:"",resource:"",action:"",description:""}),g=l.useMemo(()=>{if(!m.trim())return t;const d=m.toLowerCase();return t.map(W=>({...W,permissions:W.permissions.filter(I=>{var k;return I.name.toLowerCase().includes(d)||I.resource.toLowerCase().includes(d)||I.action.toLowerCase().includes(d)||((k=I.description)==null?void 0:k.toLowerCase().includes(d))})})).filter(W=>W.permissions.length>0)},[t,m]),x=s.length,C=t.length,T=async()=>{if(!v.name||!v.resource||!v.action){p("Name, resource, and action are required");return}P(!0),p(null);try{const d=await B.createPermission(v);n(d),c(!1),N({name:"",resource:"",action:"",description:""})}catch(d){p(d.message||"Failed to create permission")}finally{P(!1)}},w=(d,W)=>{const I={...v,[d]:W};I.resource&&I.action&&(I.name=`${I.resource}:${I.action}`),N(I)},M=l.useMemo(()=>{const d={};return o.forEach(W=>{d[W.id]=a[W.id]||new Set}),d},[o,a]);return e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(y,{children:[e.jsxs($,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[x," permissions across ",C," categories"]}),e.jsx(se,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:o.map(d=>e.jsx(Z,{label:d.name,size:"small",sx:{backgroundColor:z(oe(d.name),.1),color:oe(d.name),fontWeight:500,fontSize:"0.75rem"}},d.id))})]}),e.jsxs(y,{sx:{display:"flex",gap:1.5},children:[e.jsx(O,{size:"small",placeholder:"Search permissions...",value:m,onChange:d=>b(d.target.value),InputProps:{startAdornment:e.jsx(ss,{position:"start",children:e.jsx(Ms,{fontSize:"small",color:"action"})})},sx:{width:250}}),e.jsx(_,{variant:"contained",startIcon:e.jsx(we,{}),onClick:()=>c(!0),children:"New Permission"})]})]}),u?e.jsx(y,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(L,{})}):g.length===0?e.jsx(fe,{sx:{p:4,textAlign:"center"},children:e.jsx($,{color:"text.secondary",children:m?"No permissions match your search":"No permissions configured"})}):g.map((d,W)=>e.jsx(Wo,{category:d,roles:o,rolePermissionMap:M,onAddRole:h,onRemoveRole:i,defaultExpanded:W===0,disabled:u},d.name)),e.jsxs(pe,{open:f,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(me,{children:"Create New Permission"}),e.jsxs(ue,{children:[S&&e.jsx(X,{severity:"error",sx:{mb:2},children:S}),e.jsxs(se,{spacing:2,sx:{mt:1},children:[e.jsxs(O,{select:!0,label:"Resource",value:v.resource,onChange:d=>w("resource",d.target.value),fullWidth:!0,required:!0,children:[Object.entries(re).map(([d,W])=>e.jsx(J,{value:d,children:W.displayName},d)),e.jsx(J,{value:"other",children:"Other"})]}),v.resource==="other"&&e.jsx(O,{label:"Custom Resource",value:v.resource==="other"?"":v.resource,onChange:d=>N({...v,resource:d.target.value}),fullWidth:!0,placeholder:"e.g., reports"}),e.jsxs(O,{select:!0,label:"Action",value:v.action,onChange:d=>w("action",d.target.value),fullWidth:!0,required:!0,children:[e.jsx(J,{value:"read",children:"Read - View access"}),e.jsx(J,{value:"write",children:"Write - Create access"}),e.jsx(J,{value:"update",children:"Update - Modify access"}),e.jsx(J,{value:"delete",children:"Delete - Remove access"}),e.jsx(J,{value:"manage",children:"Manage - Full access"})]}),e.jsx(O,{label:"Permission Name",value:v.name,onChange:d=>N({...v,name:d.target.value}),fullWidth:!0,required:!0,helperText:"Auto-generated from resource:action"}),e.jsx(O,{label:"Description",value:v.description,onChange:d=>N({...v,description:d.target.value}),fullWidth:!0,multiline:!0,rows:2,placeholder:"Optional description of what this permission allows"})]})]}),e.jsxs(xe,{children:[e.jsx(_,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(_,{variant:"contained",onClick:T,disabled:A||!v.name||!v.resource||!v.action,children:A?e.jsx(L,{size:20}):"Create"})]})]})]})},Uo={admin:Ds,manager:Po,receptionist:Ze,guest:Ts},Eo=({role:s,onEdit:o,onDelete:t})=>{const a=oe(s.name),h=Uo[s.name.toLowerCase()]||Ze;return e.jsx(Ws,{sx:{border:"1px solid",borderColor:"divider",borderRadius:2,transition:"all 0.2s ease-in-out","&:hover":{borderColor:z(a,.5),boxShadow:`0 4px 12px ${z(a,.15)}`}},children:e.jsx(Us,{onClick:()=>o(s),sx:{p:0},children:e.jsx($s,{sx:{p:2.5,"&:last-child":{pb:2.5}},children:e.jsxs(y,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(y,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:48,height:48,borderRadius:2,backgroundColor:z(a,.1),color:a},children:e.jsx(h,{})}),e.jsxs(y,{sx:{flex:1,minWidth:0},children:[e.jsx($,{variant:"h6",fontWeight:600,sx:{mb:.5},children:s.name}),e.jsx($,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.description||"No description"}),e.jsxs(se,{direction:"row",spacing:1,sx:{mt:1.5},children:[e.jsx(Z,{icon:e.jsx(is,{sx:{fontSize:16}}),label:`${s.navigationCount} tabs`,size:"small",sx:{backgroundColor:z("#9c27b0",.1),color:"#9c27b0",fontWeight:500,"& .MuiChip-icon":{color:"inherit"}}}),e.jsx(Z,{icon:e.jsx(Se,{sx:{fontSize:16}}),label:`${s.permissionCount} permissions`,size:"small",sx:{backgroundColor:z("#1976d2",.1),color:"#1976d2",fontWeight:500,"& .MuiChip-icon":{color:"inherit"}}})]})]}),e.jsxs(y,{sx:{display:"flex",gap:.5},onClick:i=>i.stopPropagation(),children:[e.jsx(ee,{title:"Edit role",children:e.jsx(Y,{size:"small",onClick:i=>{i.stopPropagation(),o(s)},sx:{color:"text.secondary","&:hover":{color:"primary.main"}},children:e.jsx(De,{fontSize:"small"})})}),e.jsx(ee,{title:"Delete role",children:e.jsx(Y,{size:"small",onClick:i=>{i.stopPropagation(),t(s)},sx:{color:"text.secondary","&:hover":{color:"error.main"}},children:e.jsx(Ne,{fontSize:"small"})})})]})]})})})})},zo={EventNote:Ke,Book:Ro,People:Ue,Hotel:Qe,Category:Cs,CalendarMonth:vs,HomeWork:js,AccountBalance:He,CardGiftcard:qe,Star:Xe,Assessment:Ge,VerifiedUser:Ye,Security:Ce,Settings:$e},Bo=({selectedNavItems:s,onToggleNavItem:o,disabled:t=!1})=>{const a=ls.reduce((i,n)=>(i[n.category]||(i[n.category]=[]),i[n.category].push(n),i),{}),h=["core","management","analytics","system"];return e.jsxs(y,{children:[e.jsx($,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:"Which tabs can this role access?"}),h.map(i=>{const n=a[i]||[];return n.length===0?null:e.jsxs(y,{sx:{mb:2},children:[e.jsx($,{variant:"caption",fontWeight:600,color:"text.secondary",sx:{display:"block",mb:1,textTransform:"uppercase",letterSpacing:.5},children:ko[i]}),e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:.5,pl:1},children:n.map(u=>{const m=s.includes(u.id),b=zo[u.icon]||$e,f=cs[u.id]||[];return e.jsx(ee,{title:f.length>0?`Also grants: ${f.map(c=>c.name).join(", ")}`:u.description,placement:"right",arrow:!0,children:e.jsx(os,{control:e.jsx(ts,{size:"small",checked:m,onChange:c=>o(u.id,c.target.checked),disabled:t}),label:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{sx:{fontSize:18,color:m?"primary.main":"text.disabled"}}),e.jsx($,{variant:"body2",sx:{color:m?"text.primary":"text.secondary",fontWeight:m?500:400},children:u.label})]}),sx:{mx:0,py:.5,px:1,borderRadius:1,"&:hover":{backgroundColor:"action.hover"}}})},u.id)})}),i!=="system"&&e.jsx(je,{sx:{mt:2}})]},i)})]})},Vo=({permissions:s,allPermissions:o})=>{const[t,a]=Ve.useState(new Set),h=Ve.useMemo(()=>{const n={};s.forEach(b=>{let f=b.resource;b.resource.includes(":")&&(f=b.resource.split(":")[0]),n[f]||(n[f]=[]),n[f].push(b)});const u={};return o.forEach(b=>{let f=b.resource;b.resource.includes(":")&&(f=b.resource.split(":")[0]),u[f]=(u[f]||0)+1}),Object.entries(n).map(([b,f])=>{var c;return{name:b,displayName:((c=re[b])==null?void 0:c.displayName)||b.charAt(0).toUpperCase()+b.slice(1),color:Ao(b),permissions:f.sort((A,P)=>A.name.localeCompare(P.name)),totalInCategory:u[b]||f.length}}).sort((b,f)=>b.displayName.localeCompare(f.displayName))},[s,o]),i=n=>{a(u=>{const m=new Set(u);return m.has(n)?m.delete(n):m.add(n),m})};return s.length===0?e.jsx(y,{sx:{py:2,textAlign:"center"},children:e.jsx($,{variant:"body2",color:"text.secondary",children:"No permissions assigned yet"})}):e.jsxs(y,{children:[e.jsxs($,{variant:"subtitle2",color:"text.secondary",sx:{mb:2},children:["Assigned permissions (",s.length," total)"]}),e.jsx(se,{spacing:1,children:h.map(n=>{const u=t.has(n.name);return e.jsxs(y,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden"},children:[e.jsxs(y,{onClick:()=>i(n.name),sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:1.5,py:1,backgroundColor:z(n.color,.05),cursor:"pointer","&:hover":{backgroundColor:z(n.color,.1)}},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($,{variant:"body2",fontWeight:600,sx:{color:n.color},children:n.displayName}),e.jsx(Z,{label:`${n.permissions.length}/${n.totalInCategory}`,size:"small",sx:{height:20,fontSize:"0.7rem",backgroundColor:z(n.color,.15),color:n.color}})]}),e.jsx(Y,{size:"small",sx:{p:0},children:u?e.jsx(As,{fontSize:"small"}):e.jsx(Je,{fontSize:"small"})})]}),e.jsx(es,{in:u,children:e.jsx(y,{sx:{p:1.5,pt:1},children:e.jsx(se,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,children:n.permissions.map(m=>e.jsx(Z,{label:m.action,size:"small",variant:"outlined",sx:{borderColor:z(n.color,.3),color:n.color,fontSize:"0.75rem"}},m.id))})})})]},n.name)})})]})},Oo=({open:s,role:o,allPermissions:t,onClose:a,onSave:h})=>{const[i,n]=l.useState(""),[u,m]=l.useState(""),[b,f]=l.useState([]),[c,A]=l.useState([]),[P,S]=l.useState(!1),[p,v]=l.useState(null),[N,g]=l.useState(!1);l.useEffect(()=>{o&&(n(o.name),m(o.description||""),f(o.navigationItems||[]),A(o.permissions||[]),g(!1),v(null))},[o]);const x=async(w,M)=>{if(!o)return;g(!0),v(null);const d=cs[w]||[],W=`navigation_${w}:read`;if(M){f(E=>[...E,w]);let I=t.find(E=>E.name===W);const k=[];I&&!c.some(E=>E.id===I.id)&&k.push(I),d.forEach(E=>{const j=t.find(R=>R.name===E.name);j&&!c.some(R=>R.id===j.id)&&k.push(j)}),k.length>0&&A(E=>[...E,...k])}else f(I=>I.filter(k=>k!==w)),A(I=>I.filter(k=>k.name!==W))},C=async()=>{if(o){S(!0),v(null);try{let w=o;(i!==o.name||u!==(o.description||""))&&(w=await B.updateRole(String(o.id),{name:i,description:u}));const M=new Set(o.permissions.map(k=>k.id)),d=new Set(c.map(k=>k.id)),W=c.filter(k=>!M.has(k.id)),I=o.permissions.filter(k=>!d.has(k.id));for(const k of W)await B.assignPermissionToRole({role_id:o.id,permission_id:k.id});for(const k of I)await B.removePermissionFromRole(String(o.id),String(k.id));h(w,c),a()}catch(w){v(w.message||"Failed to save role")}finally{S(!1)}}},T=o?oe(o.name):"#9e9e9e";return e.jsxs(jo,{anchor:"right",open:s,onClose:a,PaperProps:{sx:{width:{xs:"100%",sm:420},maxWidth:"100%"}},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:3,py:2,borderBottom:"1px solid",borderColor:"divider",backgroundColor:z(T,.05)},children:[e.jsx($,{variant:"h6",fontWeight:600,children:o?`Edit Role: ${o.name}`:"Edit Role"}),e.jsx(Y,{onClick:a,size:"small",children:e.jsx(zs,{})})]}),e.jsxs(y,{sx:{flex:1,overflow:"auto",p:3},children:[p&&e.jsx(X,{severity:"error",sx:{mb:2},onClose:()=>v(null),children:p}),e.jsxs(y,{sx:{mb:3},children:[e.jsx($,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Basic Information"}),e.jsx(O,{label:"Role Name",value:i,onChange:w=>{n(w.target.value),g(!0)},fullWidth:!0,size:"small",sx:{mb:2}}),e.jsx(O,{label:"Description",value:u,onChange:w=>{m(w.target.value),g(!0)},fullWidth:!0,size:"small",multiline:!0,rows:2,placeholder:"Brief description of this role's responsibilities"})]}),e.jsx(je,{sx:{my:3}}),e.jsxs(y,{sx:{mb:3},children:[e.jsx($,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Navigation Access"}),e.jsx(Bo,{selectedNavItems:b,onToggleNavItem:x,disabled:P})]}),e.jsx(je,{sx:{my:3}}),e.jsxs(y,{children:[e.jsx($,{variant:"subtitle2",fontWeight:600,sx:{mb:2},children:"Permission Summary"}),e.jsx(Vo,{permissions:c,allPermissions:t})]})]}),e.jsxs(y,{sx:{display:"flex",justifyContent:"flex-end",gap:1.5,px:3,py:2,borderTop:"1px solid",borderColor:"divider",backgroundColor:"background.paper"},children:[e.jsx(_,{onClick:a,disabled:P,children:"Cancel"}),e.jsx(_,{variant:"contained",startIcon:P?e.jsx(L,{size:16}):e.jsx(Bs,{}),onClick:C,disabled:P||!N,children:P?"Saving...":"Save Changes"})]})]})},_o=({roles:s,permissions:o,onRoleCreated:t,onRoleUpdated:a,onRoleDeleted:h,loading:i=!1})=>{const[n,u]=l.useState(!1),[m,b]=l.useState(null),[f,c]=l.useState(!1),[A,P]=l.useState({name:"",description:""}),[S,p]=l.useState(!1),[v,N]=l.useState(null),[g,x]=l.useState(!1),[C,T]=l.useState(null),[w,M]=l.useState(!1),[d,W]=l.useState(null),I=D=>{b(D),u(!0)},k=(D,r)=>{a(D,r)},E=async()=>{if(!A.name.trim()){N("Role name is required");return}p(!0),N(null);try{const D=await B.createRole(A);t(D),c(!1),P({name:"",description:""})}catch(D){N(D.message||"Failed to create role")}finally{p(!1)}},j=D=>{T(D),x(!0),W(null)},R=async()=>{if(C){M(!0),W(null);try{await B.deleteRole(String(C.id)),h(C.id),x(!1),T(null)}catch(D){W(D.message||"Failed to delete role")}finally{M(!1)}}};return e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs($,{variant:"body2",color:"text.secondary",children:[s.length," role",s.length!==1?"s":""," configured"]}),e.jsx(_,{variant:"contained",startIcon:e.jsx(we,{}),onClick:()=>c(!0),children:"Create Role"})]}),i?e.jsx(y,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(L,{})}):s.length===0?e.jsx(y,{sx:{textAlign:"center",py:4},children:e.jsx($,{color:"text.secondary",children:'No roles configured. Click "Create Role" to add one.'})}):e.jsx(_e,{container:!0,spacing:2,children:s.map(D=>e.jsx(_e,{item:!0,xs:12,md:6,children:e.jsx(Eo,{role:D,onEdit:I,onDelete:j})},D.id))}),e.jsx(Oo,{open:n,role:m,allPermissions:o,onClose:()=>{u(!1),b(null)},onSave:k}),e.jsxs(pe,{open:f,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(me,{children:"Create New Role"}),e.jsxs(ue,{children:[v&&e.jsx(X,{severity:"error",sx:{mb:2},children:v}),e.jsxs(se,{spacing:2,sx:{mt:1},children:[e.jsx(O,{label:"Role Name",value:A.name,onChange:D=>P({...A,name:D.target.value}),fullWidth:!0,required:!0,placeholder:"e.g., Housekeeping"}),e.jsx(O,{label:"Description",value:A.description,onChange:D=>P({...A,description:D.target.value}),fullWidth:!0,multiline:!0,rows:2,placeholder:"Brief description of this role's responsibilities"})]})]}),e.jsxs(xe,{children:[e.jsx(_,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(_,{variant:"contained",onClick:E,disabled:S||!A.name.trim(),children:S?e.jsx(L,{size:20}):"Create"})]})]}),e.jsxs(pe,{open:g,onClose:()=>x(!1),children:[e.jsx(me,{children:"Delete Role"}),e.jsxs(ue,{children:[d&&e.jsx(X,{severity:"error",sx:{mb:2},children:d}),e.jsxs(mo,{children:["Are you sure you want to delete the role ",e.jsx("strong",{children:C==null?void 0:C.name}),"? This action cannot be undone."]}),C&&C.permissionCount>0&&e.jsxs(X,{severity:"warning",sx:{mt:2},children:["This role has ",C.permissionCount," permissions assigned. Users with this role will lose access to those features."]})]}),e.jsxs(xe,{children:[e.jsx(_,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(_,{variant:"contained",color:"error",onClick:R,disabled:w,children:w?e.jsx(L,{size:20}):"Delete"})]})]})]})},ke={username:"",email:"",full_name:"",phone:"",password:"",confirmPassword:"",is_active:!0,role_ids:[]},Fo=({users:s,roles:o,loading:t,onUserCreated:a,onUserUpdated:h,onUserDeleted:i,onRolesAssigned:n})=>{const[u,m]=l.useState(!1),[b,f]=l.useState(!1),[c,A]=l.useState(null),[P,S]=l.useState(null),[p,v]=l.useState(ke),[N,g]=l.useState(!1),[x,C]=l.useState(!1),[T,w]=l.useState(null),M=()=>{A(null),v(ke),w(null),m(!0)},d=r=>{var U;A(r),v({username:r.username,email:r.email,full_name:r.full_name||"",phone:"",password:"",confirmPassword:"",is_active:r.is_active,role_ids:((U=r.roles)==null?void 0:U.map(F=>F.id))||[]}),w(null),m(!0)},W=r=>{S(r),f(!0)},I=()=>{m(!1),A(null),v(ke),w(null)},k=(r,U)=>{v(F=>({...F,[r]:U})),w(null)},E=()=>p.username.trim()?p.email.trim()?!c&&!p.password?"Password is required for new users":p.password&&p.password.length<6?"Password must be at least 6 characters":p.password&&p.password!==p.confirmPassword?"Passwords do not match":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.email)?null:"Invalid email format":"Email is required":"Username is required",j=async()=>{var U;const r=E();if(r){w(r);return}C(!0),w(null);try{if(c){const F={username:p.username,email:p.email,full_name:p.full_name||void 0,is_active:p.is_active};p.password&&(F.password=p.password);const ye=await B.updateUser(c.id,F);h(ye);const ie=((U=c.roles)==null?void 0:U.map(K=>K.id))||[],le=p.role_ids;for(const K of ie)le.includes(K)||await B.removeRoleFromUser(c.id,String(K));for(const K of le)ie.includes(K)||await B.assignRoleToUser({user_id:c.id,role_id:K});n(c.id,le)}else{const F=await B.createUser({username:p.username,email:p.email,password:p.password,full_name:p.full_name||void 0,role_ids:p.role_ids.length>0?p.role_ids:void 0});a(F)}I()}catch(F){w(F.message||"Failed to save user")}finally{C(!1)}},R=async()=>{if(P){C(!0);try{await B.deleteUser(P.id),i(P.id),f(!1),S(null)}catch(r){w(r.message||"Failed to delete user")}finally{C(!1)}}},D=r=>{const U=r.toLowerCase();return ve[U]||ve.default};return t?e.jsx(y,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(L,{})}):e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(y,{children:[e.jsx($,{variant:"h6",fontWeight:600,children:"User Management"}),e.jsx($,{variant:"body2",color:"text.secondary",children:"Create, edit, and manage user accounts and their role assignments"})]}),e.jsx(_,{variant:"contained",startIcon:e.jsx(Me,{}),onClick:M,children:"Add User"})]}),e.jsx(Vs,{component:fe,sx:{borderRadius:2},children:e.jsxs(Os,{children:[e.jsx(_s,{children:e.jsxs(Pe,{sx:{bgcolor:"grey.50"},children:[e.jsx(V,{sx:{fontWeight:600},children:"Username"}),e.jsx(V,{sx:{fontWeight:600},children:"Email"}),e.jsx(V,{sx:{fontWeight:600},children:"Full Name"}),e.jsx(V,{sx:{fontWeight:600},children:"Roles"}),e.jsx(V,{sx:{fontWeight:600},children:"Status"}),e.jsx(V,{sx:{fontWeight:600},children:"Created"}),e.jsx(V,{sx:{fontWeight:600},align:"right",children:"Actions"})]})}),e.jsx(Fs,{children:s.length===0?e.jsx(Pe,{children:e.jsx(V,{colSpan:7,align:"center",sx:{py:4},children:e.jsx($,{color:"text.secondary",children:"No users found"})})}):s.map(r=>e.jsxs(Pe,{hover:!0,children:[e.jsx(V,{children:e.jsx($,{fontWeight:500,children:r.username})}),e.jsx(V,{children:r.email}),e.jsx(V,{children:r.full_name||"-"}),e.jsx(V,{children:e.jsx(y,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:r.roles&&r.roles.length>0?r.roles.map(U=>e.jsx(Z,{label:U.name,size:"small",icon:e.jsx(Ce,{sx:{fontSize:14}}),sx:{bgcolor:z(D(U.name),.1),color:D(U.name),fontWeight:500,"& .MuiChip-icon":{color:"inherit"}}},U.id)):e.jsx($,{variant:"body2",color:"text.secondary",children:"No roles"})})}),e.jsx(V,{children:e.jsx(Z,{label:r.is_active?"Active":"Inactive",size:"small",color:r.is_active?"success":"default",variant:r.is_active?"filled":"outlined"})}),e.jsx(V,{children:r.created_at?new Date(r.created_at).toLocaleDateString():"-"}),e.jsxs(V,{align:"right",children:[e.jsx(ee,{title:"Edit User",children:e.jsx(Y,{size:"small",onClick:()=>d(r),color:"primary",children:e.jsx(De,{fontSize:"small"})})}),e.jsx(ee,{title:"Delete User",children:e.jsx(Y,{size:"small",onClick:()=>W(r),color:"error",children:e.jsx(Ne,{fontSize:"small"})})})]})]},r.id))})]})}),e.jsxs(pe,{open:u,onClose:I,maxWidth:"sm",fullWidth:!0,children:[e.jsx(me,{sx:{pb:1},children:e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[c?e.jsx(De,{color:"primary"}):e.jsx(Me,{color:"primary"}),e.jsx($,{variant:"h6",children:c?"Edit User":"Create New User"})]})}),e.jsxs(ue,{children:[T&&e.jsx(X,{severity:"error",sx:{mb:2,mt:1},children:T}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(O,{label:"Username",value:p.username,onChange:r=>k("username",r.target.value),required:!0,fullWidth:!0,disabled:!!c}),e.jsx(O,{label:"Email",type:"email",value:p.email,onChange:r=>k("email",r.target.value),required:!0,fullWidth:!0}),e.jsx(O,{label:"Full Name",value:p.full_name,onChange:r=>k("full_name",r.target.value),fullWidth:!0}),e.jsx(O,{label:c?"New Password (leave blank to keep current)":"Password",type:N?"text":"password",value:p.password,onChange:r=>k("password",r.target.value),required:!c,fullWidth:!0,InputProps:{endAdornment:e.jsx(ss,{position:"end",children:e.jsx(Y,{onClick:()=>g(!N),edge:"end",children:N?e.jsx(Es,{}):e.jsx(Ls,{})})})}}),(p.password||!c)&&e.jsx(O,{label:"Confirm Password",type:N?"text":"password",value:p.confirmPassword,onChange:r=>k("confirmPassword",r.target.value),required:!c,fullWidth:!0}),e.jsxs(ws,{fullWidth:!0,children:[e.jsx(Ss,{children:"Roles"}),e.jsx(Rs,{multiple:!0,value:p.role_ids,onChange:r=>k("role_ids",r.target.value),input:e.jsx(Ps,{label:"Roles"}),renderValue:r=>o.filter(U=>r.includes(U.id)).map(U=>U.name).join(", "),children:o.map(r=>e.jsxs(J,{value:r.id,children:[e.jsx(Gs,{checked:p.role_ids.includes(r.id)}),e.jsx(Le,{primary:r.name,secondary:r.description})]},r.id))})]}),c&&e.jsx(os,{control:e.jsx(ts,{checked:p.is_active,onChange:r=>k("is_active",r.target.checked),color:"success"}),label:"Active"})]})]}),e.jsxs(xe,{sx:{px:3,pb:2},children:[e.jsx(_,{onClick:I,disabled:x,children:"Cancel"}),e.jsx(_,{variant:"contained",onClick:j,disabled:x,startIcon:x?e.jsx(L,{size:20}):null,children:x?"Saving...":c?"Update":"Create"})]})]}),e.jsxs(pe,{open:b,onClose:()=>f(!1),children:[e.jsx(me,{children:"Delete User"}),e.jsx(ue,{children:e.jsxs($,{children:["Are you sure you want to delete user ",e.jsx("strong",{children:P==null?void 0:P.username}),"? This action cannot be undone."]})}),e.jsxs(xe,{children:[e.jsx(_,{onClick:()=>f(!1),disabled:x,children:"Cancel"}),e.jsx(_,{variant:"contained",color:"error",onClick:R,disabled:x,startIcon:x?e.jsx(L,{size:20}):e.jsx(Ne,{}),children:x?"Deleting...":"Delete"})]})]})]})};function Ae(s){const{children:o,value:t,index:a,...h}=s;return e.jsx("div",{role:"tabpanel",hidden:t!==a,id:`rbac-tabpanel-${a}`,"aria-labelledby":`rbac-tab-${a}`,...h,children:t===a&&e.jsx(y,{sx:{py:3},children:o})})}function Ie(s){return{id:`rbac-tab-${s}`,"aria-controls":`rbac-tabpanel-${s}`}}const yt=()=>{const[s,o]=l.useState(0),[t,a]=l.useState({open:!1,message:"",severity:"success"}),{roles:h,permissions:i,users:n,rolesWithStats:u,permissionCategories:m,rolePermissionMap:b,loading:f,error:c,reload:A,setRoles:P,setPermissions:S,setUsers:p,updateRolePermissions:v,updateUserRoles:N}=Io(),g=(j,R="success")=>{a({open:!0,message:j,severity:R})},x=async(j,R)=>{var D;try{await B.assignPermissionToRole({role_id:R.id,permission_id:j.id});const r=((D=u.find(U=>U.id===R.id))==null?void 0:D.permissions)||[];v(R.id,[...r,j]),g(`Added ${R.name} to ${j.name}`)}catch(r){throw g(r.message||"Failed to assign permission","error"),r}},C=async(j,R)=>{var D;try{await B.removePermissionFromRole(String(R.id),String(j.id));const r=((D=u.find(U=>U.id===R.id))==null?void 0:D.permissions)||[];v(R.id,r.filter(U=>U.id!==j.id)),g(`Removed ${R.name} from ${j.name}`)}catch(r){throw g(r.message||"Failed to remove permission","error"),r}},T=j=>{S(R=>[...R,j]),g(`Permission "${j.name}" created`)},w=j=>{P(R=>[...R,j]),v(j.id,[]),g(`Role "${j.name}" created`)},M=(j,R)=>{P(D=>D.map(r=>r.id===j.id?j:r)),v(j.id,R),g(`Role "${j.name}" updated`)},d=j=>{P(R=>R.filter(D=>D.id!==j)),g("Role deleted")},W=j=>{p(R=>[...R,{...j,roles:[]}]),g(`User "${j.username}" created`)},I=j=>{p(R=>R.map(D=>D.id===j.id?{...D,...j}:D)),g(`User "${j.username}" updated`)},k=j=>{p(R=>R.filter(D=>D.id!==j)),g("User deleted")},E=(j,R)=>{N(j,R),g("User roles updated")};return c&&!f?e.jsx(y,{sx:{p:3},children:e.jsx(X,{severity:"error",action:e.jsx(Y,{color:"inherit",size:"small",onClick:A,children:e.jsx(Oe,{})}),children:c})}):e.jsxs(y,{sx:{p:3},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:48,height:48,borderRadius:2,backgroundColor:z("#d32f2f",.1),color:"#d32f2f"},children:e.jsx(Ce,{fontSize:"large"})}),e.jsxs(y,{children:[e.jsx($,{variant:"h4",fontWeight:700,children:"Roles & Permissions"}),e.jsx($,{variant:"body2",color:"text.secondary",children:"Manage access control for your hotel management system"})]})]}),e.jsx(ee,{title:"Refresh data",children:e.jsx(Y,{onClick:A,disabled:f,children:f?e.jsx(L,{size:24}):e.jsx(Oe,{})})})]}),e.jsxs(fe,{sx:{borderRadius:2,overflow:"hidden"},children:[e.jsx(y,{sx:{borderBottom:1,borderColor:"divider",px:2},children:e.jsxs(ks,{value:s,onChange:(j,R)=>o(R),"aria-label":"RBAC management tabs",children:[e.jsx(Re,{icon:e.jsx(Se,{sx:{fontSize:20}}),iconPosition:"start",label:"Permissions",...Ie(0),sx:{minHeight:56}}),e.jsx(Re,{icon:e.jsx(Ue,{sx:{fontSize:20}}),iconPosition:"start",label:"Roles",...Ie(1),sx:{minHeight:56}}),e.jsx(Re,{icon:e.jsx(Me,{sx:{fontSize:20}}),iconPosition:"start",label:"Users",...Ie(2),sx:{minHeight:56}})]})}),e.jsxs(y,{sx:{px:3},children:[e.jsx(Ae,{value:s,index:0,children:e.jsx($o,{permissions:i,roles:h,permissionCategories:m,rolePermissionMap:b,onAddRoleToPermission:x,onRemoveRoleFromPermission:C,onPermissionCreated:T,loading:f})}),e.jsx(Ae,{value:s,index:1,children:e.jsx(_o,{roles:u,permissions:i,onRoleCreated:w,onRoleUpdated:M,onRoleDeleted:d,loading:f})}),e.jsx(Ae,{value:s,index:2,children:e.jsx(Fo,{users:n,roles:h,loading:f,onUserCreated:W,onUserUpdated:I,onUserDeleted:k,onRolesAssigned:E})})]})]}),e.jsx(Hs,{open:t.open,autoHideDuration:4e3,onClose:()=>a({...t,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(X,{onClose:()=>a({...t,open:!1}),severity:t.severity,variant:"filled",children:t.message})})]})};export{yt as default};
