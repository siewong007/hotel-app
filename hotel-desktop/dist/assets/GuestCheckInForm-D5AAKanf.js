import{i as z,ab as H,r as u,H as B,j as e,ax as b,C as A,T as j,p as D,A as q,o as y,B as _,a0 as $,a1 as F,F as M,y as E,S as R,t as o,n as r}from"./index-DnWmqzJF.js";import{G as a}from"./Grid-0tqG7FTE.js";function G(d){const{children:v,value:c,index:l,...p}=d;return e.jsx("div",{role:"tabpanel",hidden:c!==l,id:`guest-tabpanel-${l}`,...p,children:c===l&&e.jsx(_,{sx:{p:3},children:v})})}const Q=()=>{const d=z(),[v]=H(),c=v.get("token"),[l,p]=u.useState(null),[U,N]=u.useState(null),[w,C]=u.useState(!0),[x,k]=u.useState(!1),[m,h]=u.useState(null),[f,L]=u.useState(0),[n,W]=u.useState({}),[S,P]=u.useState("WKII"),[I,T]=u.useState("");u.useEffect(()=>{if(!c){h("Invalid or missing token"),C(!1);return}K()},[c]);const K=async()=>{var t;try{const s=await B.guestPortalGetBooking(c);p(s.booking),N(s.guest);const g=((t=s.guest.full_name)==null?void 0:t.split(" "))||[];W({first_name:g[0]||"",last_name:g.slice(1).join(" ")||"",email:s.guest.email||"",phone:s.guest.phone||"",alt_phone:s.guest.alt_phone||"",nationality:s.guest.nationality||"",address_line1:s.guest.address_line1||"",city:s.guest.city||"",state_province:s.guest.state_province||"",postal_code:s.guest.postal_code||"",country:s.guest.country||"",title:s.guest.title||"",ic_number:s.guest.ic_number||""}),P(s.booking.market_code||"WKII"),T(s.booking.special_requests||"")}catch(s){h(s.message||"Failed to load booking")}finally{C(!1)}},i=(t,s)=>{W(g=>({...g,[t]:s}))},O=async()=>{k(!0),h(null);try{await B.guestPortalSubmitPreCheckin(c,{guest_update:n,market_code:S,special_requests:I}),d("/guest-checkin/confirm")}catch(t){h(t.message||"Failed to submit pre-check-in"),k(!1)}};return w?e.jsxs(b,{maxWidth:"sm",sx:{mt:8,textAlign:"center"},children:[e.jsx(A,{}),e.jsx(j,{sx:{mt:2},children:"Loading..."})]}):m&&!l?e.jsx(b,{maxWidth:"sm",sx:{mt:8},children:e.jsxs(D,{elevation:3,sx:{p:4},children:[e.jsx(q,{severity:"error",children:m}),e.jsx(y,{variant:"outlined",fullWidth:!0,sx:{mt:3},onClick:()=>d("/guest-checkin"),children:"Back to Start"})]})}):e.jsx(b,{maxWidth:"md",sx:{mt:8,mb:4},children:e.jsxs(D,{elevation:3,sx:{p:4},children:[e.jsxs(_,{sx:{textAlign:"center",mb:3},children:[e.jsx(j,{variant:"h4",component:"h1",gutterBottom:!0,children:"Update Your Information"}),e.jsx(j,{variant:"body2",color:"text.secondary",children:"Please review and update your details for a smooth check-in"})]}),m&&e.jsx(q,{severity:"error",sx:{mb:3},onClose:()=>h(null),children:m}),e.jsxs($,{value:f,onChange:(t,s)=>L(s),children:[e.jsx(F,{label:"Personal Information"}),e.jsx(F,{label:"Stay Details"})]}),e.jsx(G,{value:f,index:0,children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,sm:3,children:e.jsxs(M,{fullWidth:!0,children:[e.jsx(E,{children:"Title"}),e.jsxs(R,{value:n.title||"",onChange:t=>i("title",t.target.value),label:"Title",children:[e.jsx(o,{value:"Mr",children:"Mr"}),e.jsx(o,{value:"Mrs",children:"Mrs"}),e.jsx(o,{value:"Ms",children:"Ms"}),e.jsx(o,{value:"Dr",children:"Dr"}),e.jsx(o,{value:"Prof",children:"Prof"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:4.5,children:e.jsx(r,{fullWidth:!0,label:"First Name",value:n.first_name||"",onChange:t=>i("first_name",t.target.value),required:!0})}),e.jsx(a,{item:!0,xs:12,sm:4.5,children:e.jsx(r,{fullWidth:!0,label:"Last Name",value:n.last_name||"",onChange:t=>i("last_name",t.target.value),required:!0})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Email",type:"email",value:n.email||"",onChange:t=>i("email",t.target.value),required:!0})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Phone",value:n.phone||"",onChange:t=>i("phone",t.target.value)})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Alternate Phone",value:n.alt_phone||"",onChange:t=>i("alt_phone",t.target.value)})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Nationality",value:n.nationality||"",onChange:t=>i("nationality",t.target.value)})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(r,{fullWidth:!0,label:"Street Address",value:n.address_line1||"",onChange:t=>i("address_line1",t.target.value)})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"City",value:n.city||"",onChange:t=>i("city",t.target.value)})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"State/Province",value:n.state_province||"",onChange:t=>i("state_province",t.target.value)})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Postal Code",value:n.postal_code||"",onChange:t=>i("postal_code",t.target.value)})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Country",value:n.country||"",onChange:t=>i("country",t.target.value)})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(r,{fullWidth:!0,label:"IC/Passport Number",value:n.ic_number||"",onChange:t=>i("ic_number",t.target.value)})})]})}),e.jsx(G,{value:f,index:1,children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(j,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"The following information is read-only. Please contact the hotel if you need to make changes."})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Check-in Date",value:(l==null?void 0:l.check_in_date)||"",disabled:!0})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Check-out Date",value:(l==null?void 0:l.check_out_date)||"",disabled:!0})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Room Type",value:(l==null?void 0:l.room_type)||"Standard",disabled:!0})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(r,{fullWidth:!0,label:"Number of Guests",value:(l==null?void 0:l.number_of_guests)||1,disabled:!0})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(M,{fullWidth:!0,children:[e.jsx(E,{children:"Booking Type"}),e.jsxs(R,{value:S,onChange:t=>P(t.target.value),label:"Booking Type",children:[e.jsx(o,{value:"DIRECT",children:"Direct Booking"}),e.jsx(o,{value:"OTA",children:"Online Travel Agency"}),e.jsx(o,{value:"WKII",children:"Walk-in"}),e.jsx(o,{value:"CORP",children:"Corporate"})]})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(r,{fullWidth:!0,label:"Special Requests",multiline:!0,rows:4,value:I,onChange:t=>T(t.target.value),placeholder:"Enter any special requests or preferences"})})]})}),e.jsxs(_,{sx:{display:"flex",gap:2,mt:3},children:[e.jsx(y,{variant:"outlined",onClick:()=>d(`/guest-checkin/verify?token=${c}`),disabled:x,sx:{flex:1},children:"Back"}),e.jsx(y,{variant:"contained",onClick:O,disabled:x,startIcon:x&&e.jsx(A,{size:20}),sx:{flex:1},size:"large",children:x?"Submitting...":"Submit Pre-Check-In"})]})]})})};export{Q as GuestCheckInForm,Q as default};
