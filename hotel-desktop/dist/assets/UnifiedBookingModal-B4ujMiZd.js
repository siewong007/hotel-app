import{r as s,H as L,j as e,B as f,T as a,A as Ie,a0 as $t,a1 as ge,F as se,y as ie,S as le,t as T,n as o,D as O,p as ke,I as Xe,C as Se,o as re,aH as Tt,G as It,f as qt,ay as Xt}from"./index-DnWmqzJF.js";import{u as Gt}from"./useCurrency-C4JSCWBJ.js";import{D as St,a as Wt,b as Dt,c as wt}from"./DialogTitle-DKxRfOzX.js";import{G as r}from"./Grid-0tqG7FTE.js";import{I as ne}from"./InputAdornment-BrN3aL1-.js";import{F as vt}from"./FormControlLabel-Ddfix5uo.js";import{C as Ct}from"./Checkbox-1RYp8RQ2.js";import{V as Kt,C as Mt}from"./VisibilityOff-JntHt1L2.js";import{V as Vt}from"./Visibility-DUc7LFax.js";import{A as ot}from"./Autocomplete-CZ6UKh6h.js";import{P as Ve}from"./PersonAdd-C6oEVzXr.js";import{B as At}from"./Business-D15Uf3Sq.js";import{S as at}from"./Search-CErNxQ4Y.js";import{S as Yt}from"./Snackbar-BmHWVIFe.js";import{f as kt}from"./format-DjXxzLAN.js";import{g as Et}from"./currency-SgYezy9c.js";import{i as Ft}from"./validation-C2QFlzQX.js";import{C as lt}from"./Chip-CSuofl6d.js";import{S as Ut}from"./Stack-DcjgMJBo.js";import{S as Ht,a as Qt,b as Zt}from"./Stepper-DWx8UZeC.js";import{B as Jt}from"./ArrowBack-DoSpaJPE.js";import{C as er}from"./Check-D73JkDWp.js";import{B as zt}from"./EventAvailable-CtePsli0.js";import{C as Ot,a as Lt}from"./CardContent-BhQI87uj.js";const tr=_=>_?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_):!0,rr=_=>{if(!_)return!0;const P=_.replace(/-/g,"");return!!(P.length===12&&/^\d{12}$/.test(P)||/^[A-Za-z0-9]{6,20}$/.test(_))},ar=_=>{if(!_)return!0;const P=_.replace(/[\s-]/g,"");return/^\d{13,19}$/.test(P)},nr=_=>{if(!_)return!0;if(!/^(0[1-9]|1[0-2])\/([0-9]{2})$/.test(_))return!1;const[l,x]=_.split("/"),M=new Date,z=M.getFullYear()%100,H=M.getMonth()+1,b=parseInt(x,10),oe=parseInt(l,10);return!(b<z||b===z&&oe<H)};function Ke(_){const{children:P,value:l,index:x,...M}=_;return e.jsx("div",{role:"tabpanel",hidden:l!==x,id:`checkin-tabpanel-${x}`,"aria-labelledby":`checkin-tab-${x}`,...M,children:l===x&&e.jsx(f,{sx:{p:3},children:P})})}function Nr({open:_,onClose:P,booking:l,guest:x,onCheckInSuccess:M}){const{symbol:z,format:H}=Gt(),[b,oe]=s.useState(0),[K,V]=s.useState(!1),[Y,U]=s.useState(null),Q=s.useRef({bookingId:null,guestId:null}),[c,y]=s.useState({}),[$,C]=s.useState({}),[D,W]=s.useState({}),[w,A]=s.useState({}),[We,g]=s.useState(!0),[De,_e]=s.useState(!1),[me,ct]=s.useState(!1),[dt,Z]=s.useState("90.00"),[we,ut]=s.useState("90.00"),[Ye,I]=s.useState(1),[Ee,S]=s.useState(""),[q,he]=s.useState("Cash"),[xe,pe]=s.useState(""),[Re,fe]=s.useState(""),[Ue,Ne]=s.useState(""),[Pe,J]=s.useState(!1),[mt,ce]=s.useState(""),[Be,ee]=s.useState(""),[E,ae]=s.useState(""),[Fe,He]=s.useState("Default Language (English)"),[Te,Oe]=s.useState(""),[Qe,G]=s.useState(""),[Ze,Rt]=s.useState(""),[Je,Me]=s.useState(""),[Le,k]=s.useState([]),[m,te]=s.useState(null),[je,$e]=s.useState(!1),[ht,ye]=s.useState(!1),[R,p]=s.useState({company_name:"",company_registration_number:"",contact_person:"",contact_email:"",contact_phone:"",billing_address:""}),[et,be]=s.useState(!1),[Ae,Ge]=s.useState(""),[de,tt]=s.useState(!1),[xt,pt]=s.useState([]),[Nt,jt]=s.useState([]),[gt]=s.useState(["Mr","Mrs","Ms","Dr","Prof"]),[ze]=s.useState(["Cash","Credit Card","Debit Card","DuitNow","Online Banking","E-Wallet","Direct Billing"]),[Pt]=s.useState(["Mobile","Home","Work","Fax"]);s.useEffect(()=>{_||(Q.current={bookingId:null,guestId:null},W({}),A({}),oe(0))},[_]),s.useEffect(()=>{_&&l&&x&&(Q.current.bookingId!==l.id||Q.current.guestId!==x.id)&&(_t(),ft(),ve(),Q.current={bookingId:l.id,guestId:x.id})},[_,l==null?void 0:l.id,x==null?void 0:x.id]);const _t=async()=>{try{const[t,i]=await Promise.all([L.getRateCodes(),L.getMarketCodes()]);pt(t.rate_codes),jt(i.market_codes)}catch(t){console.error("Failed to load dropdown data:",t)}},ft=async()=>{try{$e(!0);const i=(await L.getCompanies({is_active:!0})).map(n=>({company_name:n.company_name,company_registration_number:n.registration_number,contact_person:n.contact_person,contact_email:n.contact_email,contact_phone:n.contact_phone,billing_address:n.billing_address}));k(i)}catch(t){console.error("Failed to load companies:",t)}finally{$e(!1)}},yt=async()=>{try{const t=await L.createCompany({company_name:R.company_name,registration_number:R.company_registration_number,contact_person:R.contact_person,contact_email:R.contact_email,contact_phone:R.contact_phone,billing_address:R.billing_address}),i={company_name:t.company_name,company_registration_number:t.registration_number,contact_person:t.contact_person,contact_email:t.contact_email,contact_phone:t.contact_phone,billing_address:t.billing_address};k([...Le,i]),te(i),ce(i.company_name),ye(!1),Ge(`Company "${i.company_name}" registered successfully!`),be(!0),p({company_name:"",company_registration_number:"",contact_person:"",contact_email:"",contact_phone:"",billing_address:""})}catch(t){console.error("Failed to register company:",t),Ge((t==null?void 0:t.message)||"Failed to register company"),be(!0)}},ve=()=>{var u;if(!x||!l)return;const t=((u=x.full_name)==null?void 0:u.split(" "))||[],i=t[0]||"",n=t.slice(1).join(" ")||"";y({first_name:i,last_name:n,email:x.email,phone:x.phone,ic_number:x.ic_number,nationality:x.nationality,address_line1:x.address_line1,city:x.city,state_province:x.state_province,postal_code:x.postal_code,country:x.country,title:x.title,alt_phone:x.alt_phone}),C({market_code:l.market_code||"WKII",rate_code:l.rate_code||"RACK",payment_method:l.payment_method||"Cash",check_in_time:l.check_in_time||"15:00",check_out_time:l.check_out_time||"11:00"})},X=s.useCallback((t,i)=>{switch(t){case"first_name":return!i||!i.trim()?"First name is required":i.trim().length<2?"First name must be at least 2 characters":void 0;case"email":return i&&!tr(i)?"Please enter a valid email address":void 0;case"phone":return;case"alt_phone":return;case"ic_number":return i&&!rr(i)?"Please enter a valid IC/Passport number":void 0;case"cardNumber":return i&&!ar(i)?"Please enter a valid card number (13-19 digits)":void 0;case"cardExpiry":return i&&!nr(i)?"Please enter a valid expiry date (MM/YY)":void 0;default:return}},[]),rt=s.useCallback(()=>{const t={},i=X("first_name",c.first_name||"");i&&(t.first_name=i);const n=X("email",c.email||"");n&&(t.email=n);const u=X("phone",c.phone||"");u&&(t.phone=u);const d=X("alt_phone",c.alt_phone||"");d&&(t.alt_phone=d);const B=X("ic_number",c.ic_number||"");if(B&&(t.ic_number=B),q==="Credit Card"||q==="Debit Card"){const N=X("cardNumber",xe);N&&(t.cardNumber=N);const qe=X("cardExpiry",Re);qe&&(t.cardExpiry=qe)}return t},[c,q,xe,Re,X]),F=(t,i)=>{if(y(n=>({...n,[t]:i})),w[t]){const n=X(t,i);W(u=>({...u,[t]:n}))}},ue=(t,i)=>{A(u=>({...u,[t]:!0}));const n=X(t,i);W(u=>({...u,[t]:n}))},Ce=(t,i)=>{C(n=>({...n,[t]:i}))},bt=async()=>{if(!l)return;const t=rt();if(W(t),A({first_name:!0,email:!0,phone:!0,alt_phone:!0,ic_number:!0,cardNumber:!0,cardExpiry:!0}),Object.keys(t).length>0){U("Please fix the validation errors before proceeding"),t.first_name||t.email||t.phone||t.alt_phone||t.ic_number?oe(0):(t.cardNumber||t.cardExpiry)&&oe(2);return}V(!0),U(null);try{const i={...$,...q==="Direct Billing"&&m?{company_id:m.id,company_name:m.company_name}:{}},n={guest_update:c,booking_update:i};if(await L.checkInGuest(l.id,n),q==="Direct Billing"&&m)try{const u=typeof l.total_amount=="string"?parseFloat(l.total_amount):l.total_amount,d={company_name:m.company_name,company_registration_number:m.registration_number,contact_person:m.contact_person,contact_email:m.contact_email,contact_phone:m.contact_phone,billing_address_line1:m.billing_address,billing_city:m.billing_city,billing_state:m.billing_state,billing_postal_code:m.billing_postal_code,billing_country:m.billing_country,description:`Room charge for booking ${l.booking_number||l.id} - ${(x==null?void 0:x.full_name)||"Guest"}`,expense_type:"accommodation",amount:u||0,booking_id:typeof l.id=="string"?parseInt(l.id):l.id,guest_id:typeof l.guest_id=="string"?parseInt(l.guest_id):l.guest_id,due_date:kt(new Date(new Date().getTime()+(m.payment_terms_days||30)*24*60*60*1e3),"yyyy-MM-dd"),folio_type:"city_ledger",transaction_type:"debit",post_type:"room_charge",room_number:l.room_number||String(l.room_id)};await Tt.createCustomerLedger(d)}catch(u){console.error("Failed to create company ledger:",u)}M(),P()}catch(i){U(i.message||"Failed to check in guest")}finally{V(!1)}},h=async()=>{if(!l||!m){U("Please select a company for Direct Billing first");return}tt(!0),U(null);try{const t=typeof l.total_amount=="string"?parseFloat(l.total_amount):l.total_amount,i={company_name:m.company_name,company_registration_number:m.registration_number,contact_person:m.contact_person,contact_email:m.contact_email,contact_phone:m.contact_phone,billing_address_line1:m.billing_address,billing_city:m.billing_city,billing_state:m.billing_state,billing_postal_code:m.billing_postal_code,billing_country:m.billing_country,description:`Room charge for booking ${l.booking_number||l.id} - ${(x==null?void 0:x.full_name)||"Guest"}`,expense_type:"accommodation",amount:t||0,booking_id:typeof l.id=="string"?parseInt(l.id):l.id,guest_id:typeof l.guest_id=="string"?parseInt(l.guest_id):l.guest_id,due_date:kt(new Date(new Date().getTime()+(m.payment_terms_days||30)*24*60*60*1e3),"yyyy-MM-dd"),folio_type:"city_ledger",transaction_type:"debit",post_type:"room_charge",room_number:l.room_number||String(l.room_id)};await Tt.createCustomerLedger(i),Ge(`Company ledger created for ${m.company_name}`),be(!0)}catch(t){U(t.message||"Failed to create company ledger")}finally{tt(!1)}},j=()=>{if(!l)return 0;const t=new Date(l.check_in_date),i=new Date(l.check_out_date),n=Math.abs(i.getTime()-t.getTime());return Math.ceil(n/(1e3*60*60*24))},v=t=>{try{return kt(new Date(t),"EEEE")}catch{return""}};return!l||!x?null:e.jsxs(e.Fragment,{children:[e.jsxs(St,{open:_,onClose:P,maxWidth:"lg",fullWidth:!0,children:[e.jsx(Wt,{sx:{bgcolor:"primary.main",color:"white",pb:2},children:e.jsxs(f,{children:[e.jsxs(a,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:["Walk-in Guest - Folio: ",l.folio_number||l.id]}),e.jsxs(a,{variant:"body2",sx:{mt:.5,opacity:.9},children:["Room Number: ",l.room_id," | Room Type: ",l.room_type||"STDQ - Standard Queen"]})]})}),e.jsxs(Dt,{children:[Y&&e.jsx(Ie,{severity:"error",sx:{mb:2},onClose:()=>U(null),children:Y}),e.jsxs($t,{value:b,onChange:(t,i)=>oe(i),variant:"scrollable",scrollButtons:"auto",children:[e.jsx(ge,{label:"General Information"}),e.jsx(ge,{label:"Stay Information"}),e.jsx(ge,{label:"Payment"}),e.jsx(ge,{label:"Custom Fields"}),e.jsx(ge,{label:"Notes"})]}),e.jsx(Ke,{value:b,index:0,children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,sm:3,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Title"}),e.jsx(le,{value:c.title||"",onChange:t=>F("title",t.target.value),label:"Title",children:gt.map(t=>e.jsx(T,{value:t,children:t},t))})]})}),e.jsx(r,{item:!0,xs:12,sm:4.5,children:e.jsx(o,{fullWidth:!0,label:"First Name",value:c.first_name||"",onChange:t=>F("first_name",t.target.value),onBlur:t=>ue("first_name",t.target.value),error:w.first_name&&!!D.first_name,helperText:w.first_name&&D.first_name,required:!0})}),e.jsx(r,{item:!0,xs:12,sm:4.5,children:e.jsx(o,{fullWidth:!0,label:"Last Name",value:c.last_name||"",onChange:t=>F("last_name",t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Email",type:"email",value:c.email||"",onChange:t=>F("email",t.target.value),onBlur:t=>ue("email",t.target.value),error:w.email&&!!D.email,helperText:w.email&&D.email})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Phone 1",value:c.phone||"",onChange:t=>F("phone",t.target.value),onBlur:t=>ue("phone",t.target.value),error:w.phone&&!!D.phone,helperText:w.phone&&D.phone||"Format: +60XXXXXXXXX or 0XXXXXXXXX"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Phone 2",value:c.alt_phone||"",onChange:t=>F("alt_phone",t.target.value),onBlur:t=>ue("alt_phone",t.target.value),error:w.alt_phone&&!!D.alt_phone,helperText:w.alt_phone&&D.alt_phone})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Reference/IC Number",value:c.ic_number||"",onChange:t=>F("ic_number",t.target.value),onBlur:t=>ue("ic_number",t.target.value),error:w.ic_number&&!!D.ic_number,helperText:w.ic_number&&D.ic_number||"IC: YYMMDD-SS-NNNN or Passport"})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Street Address",value:c.address_line1||"",onChange:t=>F("address_line1",t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"City",value:c.city||"",onChange:t=>F("city",t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"State/Province",value:c.state_province||"",onChange:t=>F("state_province",t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Zip Code",value:c.postal_code||"",onChange:t=>F("postal_code",t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Country",value:c.country||"",onChange:t=>F("country",t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Nationality",value:c.nationality||"",onChange:t=>F("nationality",t.target.value)})})]})}),e.jsx(Ke,{value:b,index:1,children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Check-in/Check-out"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Check-in Date",type:"date",value:l.check_in_date,disabled:!0,InputLabelProps:{shrink:!0},helperText:v(l.check_in_date)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Check-in Time",type:"time",value:$.check_in_time||"15:00",onChange:t=>Ce("check_in_time",t.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Nights",value:j(),disabled:!0})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Check-out Date",type:"date",value:l.check_out_date,disabled:!0,InputLabelProps:{shrink:!0},helperText:v(l.check_out_date)})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Check-out Time",type:"time",value:$.check_out_time||"11:00",onChange:t=>Ce("check_out_time",t.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Adults",type:"number",value:l.number_of_guests||1,disabled:!0})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Children",type:"number",value:l.extra_bed_count||0,disabled:!0})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Room Number",value:l.room_id,disabled:!0})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Rate & Charges"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Rate Code"}),e.jsx(le,{value:$.rate_code||"RACK",onChange:t=>Ce("rate_code",t.target.value),label:"Rate Code",children:xt.map(t=>e.jsxs(T,{value:t,children:[t," - Standard Rack Rate"]},t))})]})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Discount %",type:"number",value:$.discount_percentage||0,onChange:t=>Ce("discount_percentage",parseFloat(t.target.value)),InputProps:{inputProps:{min:0,max:100,step:.01}}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Weekday Rate",type:"number",value:dt,onChange:t=>Z(t.target.value),disabled:!me,InputProps:{startAdornment:e.jsx(ne,{position:"start",children:z})}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Weekend Rate",type:"number",value:we,onChange:t=>ut(t.target.value),disabled:!me,InputProps:{startAdornment:e.jsx(ne,{position:"start",children:z})}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(vt,{control:e.jsx(Ct,{checked:me,onChange:t=>ct(t.target.checked)}),label:"Override Rate"})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(ke,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Room Charge Summary"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Amount:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",fontWeight:"bold",children:H(Number(l.total_amount))})})]})]})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Special Posting"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"EPI Rate",type:"number",value:Ye,onChange:t=>I(Number(t.target.value)),InputProps:{inputProps:{min:1,step:1}}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(o,{fullWidth:!0,label:"Next Posting",value:Ee,onChange:t=>S(t.target.value)})}),e.jsxs(r,{item:!0,xs:12,sm:4,sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(vt,{control:e.jsx(Ct,{checked:We,onChange:t=>g(t.target.checked)}),label:"Charge Incidentals"}),e.jsx(vt,{control:e.jsx(Ct,{checked:De,onChange:t=>_e(t.target.checked)}),label:"VIP Guest"})]})]})}),e.jsx(Ke,{value:b,index:2,children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Payment Method"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Payment Type"}),e.jsx(le,{value:q,onChange:t=>{he(t.target.value),Ce("payment_method",t.target.value)},label:"Payment Type",children:ze.map(t=>e.jsx(T,{value:t,children:t},t))})]})}),(q==="Credit Card"||q==="Debit Card")&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Card Information"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Card Number",type:Pe?"text":"password",value:xe,onChange:t=>{if(pe(t.target.value),w.cardNumber){const i=X("cardNumber",t.target.value);W(n=>({...n,cardNumber:i}))}},onBlur:t=>ue("cardNumber",t.target.value),error:w.cardNumber&&!!D.cardNumber,helperText:w.cardNumber&&D.cardNumber,placeholder:"•••••",InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(Xe,{onClick:()=>J(!Pe),edge:"end",children:Pe?e.jsx(Kt,{}):e.jsx(Vt,{})})})}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Expire Date",placeholder:"MM/YY",value:Re,onChange:t=>{if(fe(t.target.value),w.cardExpiry){const i=X("cardExpiry",t.target.value);W(n=>({...n,cardExpiry:i}))}},onBlur:t=>ue("cardExpiry",t.target.value),error:w.cardExpiry&&!!D.cardExpiry,helperText:w.cardExpiry&&D.cardExpiry||"Format: MM/YY"})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Name on Card",value:Ue,onChange:t=>Ne(t.target.value)})})]}),q==="Direct Billing"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Direct Billing Information"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(ot,{value:m,onChange:(t,i)=>{i?i.isNew?(p({...R,company_name:i.inputValue||""}),ye(!0)):(te(i),ce(i.company_name)):(te(null),ce(""))},filterOptions:(t,i)=>{const n=i.inputValue.toLowerCase(),u=t.filter(B=>B.company_name.toLowerCase().includes(n)),d=t.some(B=>B.company_name.toLowerCase()===n);return n!==""&&!d&&u.push({inputValue:i.inputValue,company_name:`Add "${i.inputValue}" as new company`,isNew:!0}),u},selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:Le,loading:je,getOptionLabel:t=>t.isNew?t.inputValue||"":t.company_name,isOptionEqualToValue:(t,i)=>t.company_name===i.company_name,renderOption:(t,i)=>{const{key:n,...u}=t;return e.jsx("li",{...u,children:i.isNew?e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{color:"primary",fontSize:"small"}),e.jsx(a,{color:"primary",children:i.company_name})]}):e.jsxs(f,{children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(At,{color:"action",fontSize:"small"}),e.jsx(a,{children:i.company_name})]}),i.contact_person&&e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{ml:3.5},children:["Contact: ",i.contact_person]})]})},n)},renderInput:t=>e.jsx(o,{...t,label:"Company",placeholder:"Type to search or add new company",helperText:"Select existing company or type new name to register",InputProps:{...t.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[je?e.jsx(Se,{color:"inherit",size:20}):null,t.InputProps.endAdornment]})}})})}),m&&!m.isNew&&e.jsx(r,{item:!0,xs:12,children:e.jsxs(ke,{variant:"outlined",sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Company Details"}),e.jsxs(r,{container:!0,spacing:1,children:[m.company_registration_number&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:4,children:e.jsx(a,{variant:"caption",color:"text.secondary",children:"Reg. No:"})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(a,{variant:"body2",children:m.company_registration_number})})]}),m.contact_person&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:4,children:e.jsx(a,{variant:"caption",color:"text.secondary",children:"Contact:"})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(a,{variant:"body2",children:m.contact_person})})]}),m.contact_email&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:4,children:e.jsx(a,{variant:"caption",color:"text.secondary",children:"Email:"})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(a,{variant:"body2",children:m.contact_email})})]}),m.contact_phone&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:4,children:e.jsx(a,{variant:"caption",color:"text.secondary",children:"Phone:"})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(a,{variant:"body2",children:m.contact_phone})})]})]})]})})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Guest Identification"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Nationality",value:c.nationality||"",onChange:t=>F("nationality",t.target.value),placeholder:"@SAR - Sarawak",InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(Xe,{size:"small",children:e.jsx(at,{})})})}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Passport or IC #",value:c.ic_number||"",onChange:t=>F("ic_number",t.target.value),placeholder:"1234"})})]})}),e.jsx(Ke,{value:b,index:3,children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Guest Vehicles"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Car Plate No.",value:Ze,onChange:t=>Rt(t.target.value)})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"ETA",value:Je,onChange:t=>Me(t.target.value),placeholder:"Estimated Time of Arrival"})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Travel Information"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Group Code",value:E,onChange:t=>ae(t.target.value),InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(Xe,{size:"small",children:e.jsx(at,{})})})}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Language"}),e.jsxs(le,{value:Fe,onChange:t=>He(t.target.value),label:"Language",children:[e.jsx(T,{value:"Default Language (English)",children:"Default Language (English)"}),e.jsx(T,{value:"Bahasa Malaysia",children:"Bahasa Malaysia"}),e.jsx(T,{value:"Mandarin",children:"Mandarin"}),e.jsx(T,{value:"Tamil",children:"Tamil"})]})]})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Travel Agent 1",value:Te,onChange:t=>Oe(t.target.value),InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(Xe,{size:"small",children:e.jsx(at,{})})})}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Travel Agent 2",value:Qe,onChange:t=>G(t.target.value),InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(Xe,{size:"small",children:e.jsx(at,{})})})}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Drivers Info",value:Be,onChange:t=>ee(t.target.value),multiline:!0,rows:2})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Special Charges"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Tourism Tax",value:l.tourism_tax_amount||0,disabled:!0,InputProps:{startAdornment:e.jsx(ne,{position:"start",children:z})}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Room Card Deposit",value:l.room_card_deposit||0,disabled:!0,InputProps:{startAdornment:e.jsx(ne,{position:"start",children:z})}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Extra Bed Count",type:"number",value:l.extra_bed_count||0,disabled:!0})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Extra Bed Charge",value:l.extra_bed_charge||0,disabled:!0,InputProps:{startAdornment:e.jsx(ne,{position:"start",children:z})}})})]})}),e.jsx(Ke,{value:b,index:4,children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Special Requests"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Special Requests",multiline:!0,rows:4,value:l.special_requests||"",disabled:!0,helperText:"Special requests from booking"})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Check-in Information"}),e.jsx(O,{sx:{mb:2}})]}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(ke,{sx:{p:2,bgcolor:"info.50",borderLeft:4,borderColor:"info.main"},children:[e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"Confirmation Number:"})," ",l.folio_number||"N/A"]}),e.jsxs(a,{variant:"body2",sx:{mt:1},children:[e.jsx("strong",{children:"Status:"})," ",l.status.toUpperCase()]}),l.pre_checkin_completed&&e.jsx(a,{variant:"body2",color:"success.main",sx:{mt:1},children:"✓ Pre-check-in completed"})]})})]})})]}),e.jsxs(wt,{sx:{px:3,py:2,bgcolor:"grey.50",justifyContent:"space-between"},children:[e.jsx(f,{children:e.jsx(re,{onClick:P,disabled:K,sx:{mr:1},children:"Cancel"})}),e.jsxs(f,{children:[e.jsx(re,{variant:"outlined",disabled:K||de||q!=="Direct Billing"||!m,onClick:h,sx:{mr:1},startIcon:de?e.jsx(Se,{size:16}):e.jsx(At,{}),children:de?"Creating...":"Company Ledger"}),e.jsx(re,{variant:"contained",onClick:bt,disabled:K,startIcon:K&&e.jsx(Se,{size:20}),size:"large",sx:{minWidth:120},children:K?"Processing...":"Check In"})]})]})]}),e.jsxs(St,{open:ht,onClose:()=>ye(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Wt,{children:e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ve,{color:"primary"}),"Register New Company"]})}),e.jsxs(Dt,{children:[e.jsx(Ie,{severity:"info",sx:{mb:2},children:"This company is not in our system. Please provide the company details below."}),e.jsxs(r,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,required:!0,label:"Company Name",value:R.company_name,onChange:t=>p({...R,company_name:t.target.value})})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,label:"Registration Number",value:R.company_registration_number||"",onChange:t=>p({...R,company_registration_number:t.target.value}),placeholder:"e.g., 123456-A"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Contact Person",value:R.contact_person||"",onChange:t=>p({...R,contact_person:t.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Contact Email",type:"email",value:R.contact_email||"",onChange:t=>p({...R,contact_email:t.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Contact Phone",value:R.contact_phone||"",onChange:t=>p({...R,contact_phone:t.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,label:"Billing Address",value:R.billing_address||"",onChange:t=>p({...R,billing_address:t.target.value})})})]})]}),e.jsxs(wt,{children:[e.jsx(re,{onClick:()=>ye(!1),children:"Cancel"}),e.jsx(re,{onClick:yt,variant:"contained",startIcon:e.jsx(Ve,{}),disabled:!R.company_name,children:"Register Company"})]})]}),e.jsx(Yt,{open:et,autoHideDuration:4e3,onClose:()=>be(!1),children:e.jsx(Ie,{onClose:()=>be(!1),severity:"success",children:Ae})})]})}const nt={first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""},sr=({selectedGuest:_,onGuestSelect:P,guests:l,newGuestForm:x,onNewGuestFormChange:M,isCreatingNew:z,onToggleMode:H,filterByCredits:b=!1,guestsWithCredits:oe=[],selectedGuestWithCredits:K=null,onGuestWithCreditsSelect:V,loadingGuestsWithCredits:Y=!1,onMemberSelected:U})=>{const Q=c=>{P(c),U&&U((c==null?void 0:c.guest_type)==="member")};return b?e.jsx(f,{children:Y?e.jsxs(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2,gap:1},children:[e.jsx(Se,{size:24}),e.jsx(a,{children:"Loading guests with credits..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{severity:"info",sx:{mb:2},children:e.jsxs(a,{variant:"body2",children:["This booking uses the guest's ",e.jsx("strong",{children:"Free Room Credits"}),". Only guests with available credits are shown below."]})}),e.jsx(ot,{value:K,onChange:(c,y)=>V==null?void 0:V(y),options:oe,getOptionLabel:c=>c.email?`${c.full_name} - ${c.email} (${c.total_complimentary_credits} credits)`:`${c.full_name} (${c.total_complimentary_credits} credits)`,renderOption:(c,y)=>{const{key:$,...C}=c;return e.jsx(f,{component:"li",...C,children:e.jsxs(f,{sx:{width:"100%"},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(f,{children:[e.jsx(a,{variant:"body1",children:y.full_name}),y.email&&e.jsx(a,{variant:"caption",color:"text.secondary",children:y.email})]}),e.jsx(lt,{icon:e.jsx(It,{sx:{fontSize:14}}),label:`${y.total_complimentary_credits} night${y.total_complimentary_credits!==1?"s":""}`,size:"small",color:"secondary"})]}),y.credits_by_room_type.length>0&&e.jsx(f,{sx:{mt:.5,display:"flex",flexWrap:"wrap",gap:.5},children:y.credits_by_room_type.map(D=>e.jsx(lt,{label:`${D.room_type_name}: ${D.nights_available}`,size:"small",variant:"outlined",sx:{fontSize:"0.65rem",height:20}},D.room_type_id))})]})},$)},renderInput:c=>e.jsx(o,{...c,label:"Select Guest with Free Room Credits *",placeholder:"Search by name or email"}),noOptionsText:"No guests with free room credits found"})]})}):e.jsxs(f,{children:[e.jsxs(Ut,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(re,{variant:z?"outlined":"contained",onClick:()=>H(!1),size:"small",children:"Select Existing Guest"}),e.jsx(re,{variant:z?"contained":"outlined",onClick:()=>H(!0),size:"small",children:"Register New Guest"})]}),!z&&e.jsxs(f,{children:[e.jsx(ot,{value:_,onChange:(c,y)=>Q(y),options:l,getOptionLabel:c=>c.email?`${c.full_name} - ${c.email}`:c.full_name,renderOption:(c,y)=>{const{key:$,...C}=c;return e.jsxs(f,{component:"li",...C,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(f,{sx:{flex:1},children:[e.jsx(a,{variant:"body2",children:y.full_name}),y.email&&e.jsx(a,{variant:"caption",color:"text.secondary",children:y.email})]}),y.guest_type==="member"&&e.jsx(lt,{label:"Member",size:"small",color:"success",sx:{fontSize:"0.65rem",height:20}})]},$)},renderInput:c=>e.jsx(o,{...c,label:"Select Guest *",placeholder:"Search by name or email"})}),(_==null?void 0:_.guest_type)==="member"&&e.jsx(Ie,{severity:"success",sx:{mt:1},icon:e.jsx(It,{}),children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:_.full_name})," is a Member — Room card deposit is ",e.jsx("strong",{children:"waived"})]})})]}),z&&e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,required:!0,label:"First Name",value:x.first_name,onChange:c=>M({...x,first_name:c.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,required:!0,label:"Last Name",value:x.last_name,onChange:c=>M({...x,last_name:c.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,label:"Email",type:"email",value:x.email,onChange:c=>M({...x,email:c.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,label:"Phone",value:x.phone,onChange:c=>M({...x,phone:c.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,label:"IC/Passport Number",value:x.ic_number,onChange:c=>M({...x,ic_number:c.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,label:"Nationality",value:x.nationality,onChange:c=>M({...x,nationality:c.target.value})})})]})]})},st={direct:{label:"Direct Booking",description:"Check in guest immediately",icon:Ve,color:"#2196f3"},reservation:{label:"Booking Reservation",description:"Create reservation for future check-in",icon:zt,color:"#4caf50"}},it={walk_in:{label:"Walk-in",description:"Guest booking in person or by phone",icon:Ve,color:"#2196f3"},online:{label:"Online",description:"OTA or website booking",icon:zt,color:"#4caf50"},complimentary:{label:"Complimentary",description:"Use guest free room credits",icon:It,color:"#9c27b0"}},Pr=({open:_,onClose:P,room:l,rooms:x=[],guests:M,initialBookingType:z,onSuccess:H,onError:b,onBookingCreated:oe,onRefreshData:K})=>{const{format:V,symbol:Y}=Gt(),U=Et().booking_channels,Q=Et().room_card_deposit,c=!l,[y,$]=s.useState(0),[C,D]=s.useState(null),[W,w]=s.useState(null),[A,We]=s.useState(null),[g,De]=s.useState(nt),[_e,me]=s.useState(!1),[ct,dt]=s.useState([]),[Z,we]=s.useState(null),[ut,Ye]=s.useState(!1),[I,Ee]=s.useState(""),[S,q]=s.useState(""),[he,xe]=s.useState(1),[pe,Re]=s.useState(""),[fe,Ue]=s.useState(""),[Ne,Pe]=s.useState(0),[J,mt]=s.useState("cash"),[ce,Be]=s.useState(Q),[ee,E]=s.useState(!1),[ae,Fe]=s.useState(null),[He,Te]=s.useState([]),[Oe,Qe]=s.useState(!1),[G,Ze]=s.useState(null),[Rt,Je]=s.useState(null),[Me,Le]=s.useState(0),[k,m]=s.useState({}),[te,je]=s.useState({}),[$e,ht]=s.useState([]),[ye,R]=s.useState([]),p=l||ae;s.useEffect(()=>{if(_){const h=new Date().toISOString().split("T")[0],j=new Date(Date.now()+864e5).toISOString().split("T")[0];Ee(h),q(j),xe(1),$(0),D(null),w(null),Fe(null),Te([])}else $(0),D(null),w(null),We(null),De(nt),me(!1),we(null),Ee(""),q(""),xe(1),Re(""),Ue(""),Pe(0),mt("cash"),Be(Q),Fe(null),Te([]),Ze(null),Je(null),Le(0),m({}),je({})},[_,Q]);const et=s.useRef(x);et.current=x,s.useEffect(()=>{if(!c||!I||!S)return;(async()=>{Qe(!0);try{const j=await L.getAvailableRoomsForDates(I,S);Te(j)}catch(j){console.error("Failed to fetch available rooms:",j),Te(et.current)}finally{Qe(!1)}})()},[c,I,S]),s.useEffect(()=>{W==="complimentary"&&_&&be()},[W,_]),s.useEffect(()=>{G&&_&&(async()=>{try{const[j,v]=await Promise.all([L.getRateCodes(),L.getMarketCodes()]);ht(j.rate_codes),R(v.market_codes)}catch(j){console.error("Failed to load dropdown data:",j)}})()},[G,_]);const be=async()=>{Ye(!0);try{const j=(await L.getMyGuestsWithCredits()).filter(v=>v.total_complimentary_credits>0);dt(j)}catch(h){console.error("Failed to load guests with credits:",h)}finally{Ye(!1)}},Ae=(h,j)=>{if(h==="checkIn"){if(Ee(j),S){const v=Math.max(1,Math.ceil((new Date(S).getTime()-new Date(j).getTime())/864e5));xe(v)}}else if(q(j),I){const v=Math.max(1,Math.ceil((new Date(j).getTime()-new Date(I).getTime())/864e5));xe(v)}},Ge=h=>{Be(h?0:Q)},de=()=>c?C==="direct"?["Mode","Room","Guest","Dates & Payment","Confirm","Check-In"]:C==="reservation"?["Mode","Type","Room","Guest","Details","Confirm"]:["Mode","Room","Guest","Details","Confirm"]:C==="direct"?["Mode","Guest","Dates & Payment","Confirm","Check-In"]:C==="reservation"?["Mode","Type","Guest","Details","Confirm"]:["Mode","Guest","Details","Confirm"],tt=()=>{switch(de()[y]){case"Mode":return!!C;case"Type":return!!W;case"Room":return!I||!S||new Date(S)<=new Date(I)?!1:!!ae;case"Guest":return W==="complimentary"?!!Z:_e?!!(g.first_name&&g.last_name):!!A;case"Dates & Payment":return!(!I||!S||new Date(S)<=new Date(I));case"Details":return!(!c&&(!I||!S||new Date(S)<=new Date(I))||W==="online"&&!pe);case"Confirm":return!0;case"Check-In":return!!(k.first_name&&k.first_name.trim());default:return!1}},xt=async()=>{const j=de()[y];if(C==="direct"&&j==="Confirm"){await pt();return}$(v=>v+1)},pt=async()=>{var h;if(!p){b("No room selected");return}E(!0);try{let j=null;if(_e){if(!g.first_name||!g.last_name){b("Please fill in required guest fields"),E(!1);return}if(g.email&&g.email.trim()&&!Ft(g.email)){b("Please enter a valid email address"),E(!1);return}if(g.email&&g.email.trim()&&M.find(Bt=>Bt.email&&Bt.email.toLowerCase()===g.email.toLowerCase())){b(`A guest with email ${g.email} already exists`),E(!1);return}j=await L.createGuest({first_name:g.first_name,last_name:g.last_name,email:g.email||void 0,phone:g.phone,ic_number:g.ic_number,nationality:g.nationality})}else j=A;if(!j){b("Please select a guest"),E(!1);return}const v=j.guest_type==="member",t=v?0:ce,i={guest_id:j.id,room_id:String(p.id),check_in_date:I,check_out_date:S,number_of_guests:1,post_type:"normal_stay",booking_remarks:v?"Walk-In Guest (Member - Card Deposit Waived)":"Walk-In Guest",source:"walk_in",room_card_deposit:t,payment_method:J,amount_paid:Ne},n=await L.createBooking(i),u={id:n.id,guest_id:j.id.toString(),room_id:p.id,room_type:p.room_type,check_in_date:n.check_in_date,check_out_date:n.check_out_date,total_amount:n.total_amount,status:n.status,folio_number:n.folio_number||`WALKIN-${n.id}`,market_code:"Walk-In",rate_code:"RACK",payment_method:J==="cash"?"Cash":J==="card"?"Card":J==="bank_transfer"?"Bank Transfer":"E-Wallet",post_type:n.post_type,created_at:n.created_at,updated_at:n.updated_at},d=((h=j.full_name)==null?void 0:h.split(" "))||[],B=d[0]||"",N=d.slice(1).join(" ")||"";m({first_name:B,last_name:N,email:j.email,phone:j.phone,ic_number:j.ic_number,nationality:j.nationality,address_line1:j.address_line1,city:j.city,state_province:j.state_province,postal_code:j.postal_code,country:j.country,title:j.title,alt_phone:j.alt_phone}),je({market_code:"WKII",rate_code:"RACK",payment_method:J==="cash"?"Cash":J==="card"?"Credit Card":J==="bank_transfer"?"Online Banking":"E-Wallet"}),Ze(u),Je(j),$(qe=>qe+1)}catch(j){b(j.message||"Failed to create booking")}finally{E(!1)}},Nt=()=>{$(h=>h-1)},jt=h=>{D(h),w(null),We(null),we(null),me(!1),De(nt)},gt=h=>{w(h),We(null),we(null),me(!1),De(nt)},ze=()=>C==="direct"?"walk_in":W,Pt=async()=>{const j=de()[y];if(C==="direct"&&j==="Check-In"&&G){await _t();return}if(!p){b("No room selected");return}const v=ze();if(!v){b("Please select a booking type");return}E(!0);try{let t=null;if(v!=="complimentary"){if(_e){if(!g.first_name||!g.last_name){b("Please fill in required guest fields"),E(!1);return}if(g.email&&g.email.trim()&&!Ft(g.email)){b("Please enter a valid email address"),E(!1);return}if(g.email&&g.email.trim()&&M.find(u=>u.email&&u.email.toLowerCase()===g.email.toLowerCase())){b(`A guest with email ${g.email} already exists`),E(!1);return}t=await L.createGuest({first_name:g.first_name,last_name:g.last_name,email:g.email||void 0,phone:g.phone,ic_number:g.ic_number,nationality:g.nationality})}else t=A;if(!t){b("Please select a guest"),E(!1);return}}switch(v){case"walk_in":{const i=t.guest_type==="member",n=i?0:ce,u={guest_id:t.id,room_id:String(p.id),check_in_date:I,check_out_date:S,number_of_guests:1,post_type:"normal_stay",booking_remarks:i?"Walk-In Guest (Member - Card Deposit Waived)":"Walk-In Guest",source:"walk_in",room_card_deposit:n,payment_method:J,amount_paid:Ne};await L.createBooking(u),H(`Reservation created for ${t.full_name} in Room ${p.room_number}`),P(),await K();break}case"online":{const i={guest_id:t.id,room_id:String(p.id),check_in_date:I,check_out_date:S,number_of_guests:1,post_type:"normal_stay",source:"online",booking_remarks:fe?`${pe} - Ref: ${fe}`:`${pe} Booking`};await L.createBooking(i),H(`Reservation created for ${t.full_name} in Room ${p.room_number}`),P(),await K();break}case"complimentary":{if(!Z){b("Please select a guest with free room credits"),E(!1);return}const i=[],n=new Date(I),u=new Date(S);for(let B=new Date(n);B<u;B.setDate(B.getDate()+1))i.push(B.toISOString().split("T")[0]);const d=await L.bookWithCredits({guest_id:Z.id,room_id:typeof p.id=="string"?parseInt(p.id):p.id,check_in_date:I,check_out_date:S,complimentary_dates:i});H(`Complimentary reservation created for ${Z.full_name} in Room ${p.room_number} (${d.complimentary_nights} nights used)`),P(),await K();break}}}catch(t){b(t.message||"Failed to create booking")}finally{E(!1)}},_t=async()=>{if(!G){b("No booking found for check-in");return}E(!0);try{const h={guest_update:k,booking_update:te};await L.checkInGuest(G.id,h),H(`Guest checked in successfully to Room ${p==null?void 0:p.room_number}`),P(),await K()}catch(h){b(h.message||"Failed to complete check-in")}finally{E(!1)}},ft=()=>{const h=(p==null?void 0:p.price_per_night)||0;return(typeof h=="string"?parseFloat(h):h)*he},yt=()=>{const h=ze(),v=de()[y];if(v==="Mode")return e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:"How would you like to proceed?"}),e.jsx(r,{container:!0,spacing:2,children:Object.keys(st).map(n=>{const u=st[n],d=u.icon;return e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(Ot,{sx:{border:C===n?2:1,borderColor:C===n?u.color:"divider",transition:"all 0.2s","&:hover":{borderColor:u.color,transform:"translateY(-2px)"}},children:e.jsx(Mt,{onClick:()=>jt(n),children:e.jsxs(Lt,{sx:{textAlign:"center",py:3},children:[e.jsx(f,{sx:{width:56,height:56,borderRadius:"50%",bgcolor:C===n?u.color:"grey.100",color:C===n?"white":u.color,display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:1.5,transition:"all 0.2s"},children:e.jsx(d,{sx:{fontSize:28}})}),e.jsx(a,{variant:"subtitle1",fontWeight:600,children:u.label}),e.jsx(a,{variant:"caption",color:"text.secondary",children:u.description})]})})})},n)})})]});if(v==="Type")return e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:"Select Reservation Type"}),e.jsx(r,{container:!0,spacing:2,children:Object.keys(it).map(n=>{const u=it[n],d=u.icon;return e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(Ot,{sx:{border:W===n?2:1,borderColor:W===n?u.color:"divider",transition:"all 0.2s","&:hover":{borderColor:u.color,transform:"translateY(-2px)"}},children:e.jsx(Mt,{onClick:()=>gt(n),children:e.jsxs(Lt,{sx:{textAlign:"center",py:3},children:[e.jsx(f,{sx:{width:56,height:56,borderRadius:"50%",bgcolor:W===n?u.color:"grey.100",color:W===n?"white":u.color,display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:1.5,transition:"all 0.2s"},children:e.jsx(d,{sx:{fontSize:28}})}),e.jsx(a,{variant:"subtitle1",fontWeight:600,children:u.label}),e.jsx(a,{variant:"caption",color:"text.secondary",children:u.description})]})})})},n)})})]});if(v==="Room")return e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:"Select Dates & Room"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,required:!0,type:"date",label:"Check-in Date",value:I,onChange:n=>Ae("checkIn",n.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,required:!0,type:"date",label:"Check-out Date",value:S,onChange:n=>Ae("checkOut",n.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(ot,{fullWidth:!0,options:He,loading:Oe,getOptionLabel:n=>`Room ${n.room_number} - ${n.room_type} (${V(Number(n.price_per_night))}/night)`,value:ae,onChange:(n,u)=>{Fe(u)},noOptionsText:!I||!S?"Select dates first to see available rooms":Oe?"Loading available rooms...":"No rooms available for selected dates",renderInput:n=>e.jsx(o,{...n,label:"Select Room",placeholder:I&&S?"Search available rooms...":"Select dates first...",helperText:I&&S?`${He.length} room(s) available for selected dates`:"",InputProps:{...n.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[Oe?e.jsx(Se,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})}}),isOptionEqualToValue:(n,u)=>n.id===u.id,disabled:!I||!S})}),ae&&e.jsx(r,{item:!0,xs:12,children:e.jsx(ke,{sx:{p:2,bgcolor:"grey.50"},children:e.jsxs(r,{container:!0,spacing:1,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Room Number"}),e.jsx(a,{variant:"body1",fontWeight:600,children:ae.room_number})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Room Type"}),e.jsx(a,{variant:"body1",children:ae.room_type})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Rate per Night"}),e.jsx(a,{variant:"body1",children:V(Number(ae.price_per_night))})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Total (",he," night",he>1?"s":"",")"]}),e.jsx(a,{variant:"body1",fontWeight:600,children:V(Number(ae.price_per_night)*he)})]})]})})})]})]});if(v==="Guest")return e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:h==="complimentary"?"Select Guest with Credits":"Guest Information"}),e.jsx(sr,{selectedGuest:A,onGuestSelect:We,guests:M,newGuestForm:g,onNewGuestFormChange:De,isCreatingNew:_e,onToggleMode:me,filterByCredits:h==="complimentary",guestsWithCredits:ct,selectedGuestWithCredits:Z,onGuestWithCreditsSelect:we,loadingGuestsWithCredits:ut,onMemberSelected:Ge})]});if(v==="Dates & Payment"||v==="Details"){const n=h==="walk_in",u=h==="online",d=n&&C==="direct",B=!c;return e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:d?"Dates & Payment":u?"Booking Details":B?"Select Dates":"Additional Details"}),e.jsxs(r,{container:!0,spacing:2,children:[B&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,required:!0,type:"date",label:"Check-in Date",value:I,onChange:N=>Ae("checkIn",N.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,required:!0,type:"date",label:"Check-out Date",value:S,onChange:N=>Ae("checkOut",N.target.value),InputLabelProps:{shrink:!0}})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsxs(se,{fullWidth:!0,required:!0,children:[e.jsx(ie,{children:"Booking Channel"}),e.jsx(le,{value:pe,onChange:N=>Re(N.target.value),label:"Booking Channel",children:U.map(N=>e.jsx(T,{value:N,children:N},N))})]})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,label:"Booking Reference",value:fe,onChange:N=>Ue(N.target.value),placeholder:"e.g., OL-123456"})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(O,{sx:{my:1}}),e.jsx(a,{variant:"subtitle2",gutterBottom:!0,sx:{mt:1},children:"Payment Details"})]}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(ie,{children:"Payment Method"}),e.jsxs(le,{value:J,onChange:N=>mt(N.target.value),label:"Payment Method",children:[e.jsx(T,{value:"cash",children:"Cash"}),e.jsx(T,{value:"card",children:"Credit/Debit Card"}),e.jsx(T,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(T,{value:"e_wallet",children:"E-Wallet"})]})]})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,type:"number",label:"Deposit Amount",value:Ne,onChange:N=>Pe(parseFloat(N.target.value)||0),InputProps:{startAdornment:e.jsx(a,{sx:{mr:.5},children:Y})}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(o,{fullWidth:!0,type:"number",label:"Room Card Deposit",value:ce,onChange:N=>Be(parseFloat(N.target.value)||0),disabled:(A==null?void 0:A.guest_type)==="member",InputProps:{startAdornment:e.jsx(a,{sx:{mr:.5},children:Y})},helperText:(A==null?void 0:A.guest_type)==="member"?"Waived for members":""})})]})]})]})}if(v==="Check-In"&&G){const n=["Mr","Mrs","Ms","Dr","Prof"],u=["Cash","Credit Card","Debit Card","DuitNow","Online Banking","E-Wallet","Direct Billing"];return e.jsxs(f,{children:[e.jsxs(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:["Complete Check-In - Folio: ",G.folio_number]}),e.jsx(Ie,{severity:"success",sx:{mb:2},children:"Booking created successfully! Please verify guest details and complete the check-in."}),e.jsxs($t,{value:Me,onChange:(d,B)=>Le(B),variant:"scrollable",scrollButtons:"auto",sx:{mb:2},children:[e.jsx(ge,{label:"Guest Info"}),e.jsx(ge,{label:"Stay Details"}),e.jsx(ge,{label:"Payment"})]}),Me===0&&e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,sm:3,children:e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(ie,{children:"Title"}),e.jsx(le,{value:k.title||"",onChange:d=>m({...k,title:d.target.value}),label:"Title",children:n.map(d=>e.jsx(T,{value:d,children:d},d))})]})}),e.jsx(r,{item:!0,xs:12,sm:4.5,children:e.jsx(o,{fullWidth:!0,size:"small",label:"First Name",value:k.first_name||"",onChange:d=>m({...k,first_name:d.target.value}),required:!0})}),e.jsx(r,{item:!0,xs:12,sm:4.5,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Last Name",value:k.last_name||"",onChange:d=>m({...k,last_name:d.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Email",type:"email",value:k.email||"",onChange:d=>m({...k,email:d.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Phone",value:k.phone||"",onChange:d=>m({...k,phone:d.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"IC/Passport Number",value:k.ic_number||"",onChange:d=>m({...k,ic_number:d.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Nationality",value:k.nationality||"",onChange:d=>m({...k,nationality:d.target.value})})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Address",value:k.address_line1||"",onChange:d=>m({...k,address_line1:d.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"City",value:k.city||"",onChange:d=>m({...k,city:d.target.value})})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Country",value:k.country||"",onChange:d=>m({...k,country:d.target.value})})})]}),Me===1&&e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Check-in Date",type:"date",value:G.check_in_date,disabled:!0,InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(o,{fullWidth:!0,size:"small",label:"Check-out Date",type:"date",value:G.check_out_date,disabled:!0,InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(ie,{children:"Rate Code"}),e.jsx(le,{value:te.rate_code||"RACK",onChange:d=>je({...te,rate_code:d.target.value}),label:"Rate Code",children:$e.length>0?$e.map(d=>e.jsx(T,{value:d,children:d},d)):e.jsx(T,{value:"RACK",children:"RACK"})})]})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(ie,{children:"Market Code"}),e.jsx(le,{value:te.market_code||"WKII",onChange:d=>je({...te,market_code:d.target.value}),label:"Market Code",children:ye.length>0?ye.map(d=>e.jsx(T,{value:d,children:d},d)):e.jsx(T,{value:"WKII",children:"WKII"})})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(ke,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Room Details"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Room:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(a,{variant:"body2",children:[p==null?void 0:p.room_number," (",p==null?void 0:p.room_type,")"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",fontWeight:"bold",children:V(Number(G.total_amount))})})]})]})})]}),Me===2&&e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(se,{fullWidth:!0,size:"small",children:[e.jsx(ie,{children:"Payment Method"}),e.jsx(le,{value:te.payment_method||"Cash",onChange:d=>je({...te,payment_method:d.target.value}),label:"Payment Method",children:u.map(d=>e.jsx(T,{value:d,children:d},d))})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(ke,{sx:{p:2,bgcolor:"info.50",borderLeft:4,borderColor:"info.main"},children:[e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"Folio Number:"})," ",G.folio_number]}),e.jsxs(a,{variant:"body2",sx:{mt:1},children:[e.jsx("strong",{children:"Status:"})," ",G.status.toUpperCase()]}),e.jsxs(a,{variant:"body2",sx:{mt:1},children:[e.jsx("strong",{children:"Total Amount:"})," ",V(Number(G.total_amount))]})]})})]})]})}const t=()=>C==="direct"?"Direct Booking":W==="walk_in"?"Walk-in Reservation":W==="online"?"Online Reservation":W==="complimentary"?"Complimentary Reservation":"Reservation",i=()=>C==="direct"?st.direct.color:W?it[W].color:"#1976d2";return v!=="Confirm"?null:e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2,fontWeight:600},children:"Review & Confirm"}),e.jsx(ke,{sx:{p:2,bgcolor:"grey.50"},children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(f,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:e.jsx(lt,{label:t(),sx:{bgcolor:i(),color:"white",fontWeight:600}})})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(O,{})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Room"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(a,{variant:"body2",fontWeight:600,children:[p==null?void 0:p.room_number," (",p==null?void 0:p.room_type,")"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Guest"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",fontWeight:600,children:h==="complimentary"?Z==null?void 0:Z.full_name:_e?`${g.first_name} ${g.last_name} (New)`:A==null?void 0:A.full_name})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Check-in"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:I})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Check-out"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:S})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Nights"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:he})}),h==="online"&&pe&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Channel"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:pe})}),fe&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Reference"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:fe})})]})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(O,{})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Rate"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:h==="complimentary"?e.jsxs(f,{component:"span",sx:{textDecoration:"line-through",color:"text.disabled"},children:[Y,p==null?void 0:p.price_per_night,"/night"]}):`${Y}${p==null?void 0:p.price_per_night}/night`})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",fontWeight:600,children:"Total"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",fontWeight:600,color:h==="complimentary"?"success.main":"text.primary",children:h==="complimentary"?"FREE (Complimentary)":`${Y}${ft().toFixed(2)}`})}),h==="walk_in"&&C==="direct"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Deposit"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(a,{variant:"body2",color:"success.main",children:[Y,Ne.toFixed(2)]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"Room Card Deposit"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(a,{variant:"body2",children:ce>0?`${Y}${ce.toFixed(2)}`:"Waived"})})]}),h==="complimentary"&&Z&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(O,{})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(Ie,{severity:"info",sx:{mt:1},children:e.jsxs(a,{variant:"body2",children:["Using ",he," night(s) from guest's free room credits"]})})})]})]})})]})},ve=de(),X=y===ve.length-1,rt=tt(),F=ze(),ue=()=>C==="direct"?st.direct.color:W?it[W].color:"#1976d2",Ce=()=>{if(ee)return"Processing...";const h=ve[y];return C==="direct"&&h==="Check-In"?"Complete Check-In":"Create Reservation"},bt=()=>{const h=ve[y];return C==="direct"&&h==="Confirm"?ee?"Creating...":"Create Booking":"Next"};return e.jsxs(St,{open:_,onClose:()=>!ee&&P(),maxWidth:"md",fullWidth:!0,children:[e.jsx(Wt,{sx:{bgcolor:ue(),color:"white",py:2,px:3},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(qt,{sx:{fontSize:28}}),e.jsxs(a,{variant:"h6",component:"span",sx:{fontWeight:600},children:["New Booking - Room ",(p==null?void 0:p.room_number)||"N/A"]})]})}),e.jsx(f,{sx:{px:3,pt:2},children:e.jsx(Ht,{activeStep:y,alternativeLabel:!0,children:ve.map(h=>e.jsx(Qt,{children:e.jsx(Zt,{children:h})},h))})}),e.jsx(Dt,{sx:{pt:3,minHeight:300},children:yt()}),e.jsxs(wt,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(re,{onClick:P,disabled:ee,children:"Cancel"}),e.jsx(f,{sx:{flex:1}}),y>0&&ve[y]!=="Check-In"&&e.jsx(re,{onClick:Nt,disabled:ee,startIcon:e.jsx(Jt,{}),children:"Back"}),X?e.jsx(re,{variant:"contained",onClick:Pt,disabled:ee||!rt,startIcon:ee?e.jsx(Se,{size:20}):e.jsx(er,{}),color:F==="complimentary"?"secondary":"primary",children:Ce()}):e.jsx(re,{variant:"contained",onClick:xt,disabled:!rt||ee,endIcon:ee?e.jsx(Se,{size:20}):e.jsx(Xt,{}),children:bt()})]})]})};export{Nr as E,Pr as U};
