const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-Bm_vtoqk.js","assets/index-DnWmqzJF.js","assets/index-9DzPy6IV.css"])))=>i.map(i=>d[i]);
import{l as Ie,j as e,r as u,aj as Re,I as W,bc as we,bd as Te,a as Be,g as Le,u as Ae,az as be,af as F,s as z,c as de,be as ke,b as Fe,t as D,m as ce,bf as De,S as ie,bg as le,bh as Q,bi as me,B as R,T as A,o as re,x as ze,n as ue,F as pe,y as ge,p as fe,C as Ee,R as Ue,P as Me,q as $e}from"./index-DnWmqzJF.js";import{D as Ne}from"./Download-B25JP-dd.js";import{P as Ge}from"./PictureAsPdf-D3q8hJGQ.js";import{C as Ve,a as Oe}from"./CardContent-BhQI87uj.js";import{I as We}from"./InputAdornment-BrN3aL1-.js";import{S as He}from"./Search-CErNxQ4Y.js";import{F as Ke,C as qe}from"./FilterList-CoQMGMK3.js";import{C as je}from"./Collapse-B4NV5VtR.js";import{G as V}from"./Grid-0tqG7FTE.js";import{d as x,T as Ye,a as Je,b as Qe,c as he,e as Xe}from"./TableRow-B78mTfEk.js";import{a as Ze,E as et}from"./ExpandMore-DENjYJ81.js";import{S as tt}from"./Computer-BIKVQGFH.js";import{C as ye}from"./Chip-CSuofl6d.js";const st=Ie(e.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage"),ot=Ie(e.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),at=u.forwardRef(function(s,n){var L,Z,ee,te,se,oe,ae,ne;const{backIconButtonProps:p,count:l,disabled:I=!1,getItemAriaLabel:r,nextIconButtonProps:b,onPageChange:m,page:d,rowsPerPage:k,showFirstButton:H,showLastButton:K,slots:_={},slotProps:i={},...q}=s,o=Re(),f=w=>{m(w,0)},P=w=>{m(w,d-1)},E=w=>{m(w,d+1)},Y=w=>{m(w,Math.max(0,Math.ceil(l/k)-1))},U=(L=_.firstButton)!=null?L:W,S=(Z=_.lastButton)!=null?Z:W,B=(ee=_.nextButton)!=null?ee:W,C=(te=_.previousButton)!=null?te:W,y=(se=_.firstButtonIcon)!=null?se:st,g=(oe=_.lastButtonIcon)!=null?oe:ot,j=(ae=_.nextButtonIcon)!=null?ae:we,M=(ne=_.previousButtonIcon)!=null?ne:Te,$=o?S:U,J=o?B:C,N=o?C:B,G=o?U:S,v=o?i.lastButton:i.firstButton,t=o?i.nextButton:i.previousButton,c=o?i.previousButton:i.nextButton,h=o?i.firstButton:i.lastButton;return e.jsxs("div",{ref:n,...q,children:[H&&e.jsx($,{onClick:f,disabled:I||d===0,"aria-label":r("first",d),title:r("first",d),...v,children:o?e.jsx(g,{...i.lastButtonIcon}):e.jsx(y,{...i.firstButtonIcon})}),e.jsx(J,{onClick:P,disabled:I||d===0,color:"inherit","aria-label":r("previous",d),title:r("previous",d),...t!=null?t:p,children:o?e.jsx(j,{...i.nextButtonIcon}):e.jsx(M,{...i.previousButtonIcon})}),e.jsx(N,{onClick:E,disabled:I||(l!==-1?d>=Math.ceil(l/k)-1:!1),color:"inherit","aria-label":r("next",d),title:r("next",d),...c!=null?c:b,children:o?e.jsx(M,{...i.previousButtonIcon}):e.jsx(j,{...i.nextButtonIcon})}),K&&e.jsx(G,{onClick:Y,disabled:I||d>=Math.ceil(l/k)-1,"aria-label":r("last",d),title:r("last",d),...h,children:o?e.jsx(y,{...i.firstButtonIcon}):e.jsx(g,{...i.lastButtonIcon})})]})});function nt(a){return Le("MuiTablePagination",a)}const X=Be("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var _e;const lt=z(x,{name:"MuiTablePagination",slot:"Root",overridesResolver:(a,s)=>s.root})(ce(({theme:a})=>({overflow:"auto",color:(a.vars||a).palette.text.primary,fontSize:a.typography.pxToRem(14),"&:last-child":{padding:0}}))),rt=z(De,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(a,s)=>({[`& .${X.actions}`]:s.actions,...s.toolbar})})(ce(({theme:a})=>({minHeight:52,paddingRight:2,[`${a.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[a.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${X.actions}`]:{flexShrink:0,marginLeft:20}}))),it=z("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(a,s)=>s.spacer})({flex:"1 1 100%"}),ct=z("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(a,s)=>s.selectLabel})(ce(({theme:a})=>({...a.typography.body2,flexShrink:0}))),dt=z(ie,{name:"MuiTablePagination",slot:"Select",overridesResolver:(a,s)=>({[`& .${X.selectIcon}`]:s.selectIcon,[`& .${X.select}`]:s.select,...s.input,...s.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${X.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),ut=z(D,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(a,s)=>s.menuItem})({}),pt=z("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(a,s)=>s.displayedRows})(ce(({theme:a})=>({...a.typography.body2,flexShrink:0})));function gt({from:a,to:s,count:n}){return`${a}â€“${s} of ${n!==-1?n:`more than ${s}`}`}function ht(a){return`Go to ${a} page`}const xt=a=>{const{classes:s}=a;return Fe({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},nt,s)},bt=u.forwardRef(function(s,n){var xe;const p=Ae({props:s,name:"MuiTablePagination"}),{ActionsComponent:l=at,backIconButtonProps:I,colSpan:r,component:b=x,count:m,disabled:d=!1,getItemAriaLabel:k=ht,labelDisplayedRows:H=gt,labelRowsPerPage:K="Rows per page:",nextIconButtonProps:_,onPageChange:i,onRowsPerPageChange:q,page:o,rowsPerPage:f,rowsPerPageOptions:P=[10,25,50,100],SelectProps:E={},showFirstButton:Y=!1,showLastButton:U=!1,slotProps:S={},slots:B={},...C}=p,y=p,g=xt(y),j=(xe=S==null?void 0:S.select)!=null?xe:E,M=j.native?"option":ut;let $;(b===x||b==="td")&&($=r||1e3);const J=be(j.id),N=be(j.labelId),G=()=>m===-1?(o+1)*f:f===-1?m:Math.min(m,(o+1)*f),v={slots:B,slotProps:S},[t,c]=F("root",{ref:n,className:g.root,elementType:lt,externalForwardedProps:{...v,component:b,...C},ownerState:y,additionalProps:{colSpan:$}}),[h,L]=F("toolbar",{className:g.toolbar,elementType:rt,externalForwardedProps:v,ownerState:y}),[Z,ee]=F("spacer",{className:g.spacer,elementType:it,externalForwardedProps:v,ownerState:y}),[te,se]=F("selectLabel",{className:g.selectLabel,elementType:ct,externalForwardedProps:v,ownerState:y,additionalProps:{id:N}}),[oe,ae]=F("select",{className:g.select,elementType:dt,externalForwardedProps:v,ownerState:y}),[ne,w]=F("menuItem",{className:g.menuItem,elementType:M,externalForwardedProps:v,ownerState:y}),[Pe,Ce]=F("displayedRows",{className:g.displayedRows,elementType:pt,externalForwardedProps:v,ownerState:y});return e.jsx(t,{...c,children:e.jsxs(h,{...L,children:[e.jsx(Z,{...ee}),P.length>1&&e.jsx(te,{...se,children:K}),P.length>1&&e.jsx(oe,{variant:"standard",...!j.variant&&{input:_e||(_e=e.jsx(ke,{}))},value:f,onChange:q,id:J,labelId:N,...j,classes:{...j.classes,root:de(g.input,g.selectRoot,(j.classes||{}).root),select:de(g.select,(j.classes||{}).select),icon:de(g.selectIcon,(j.classes||{}).icon)},disabled:d,...ae,children:P.map(T=>u.createElement(ne,{...w,key:T.label?T.label:T,value:T.value?T.value:T},T.label?T.label:T))}),e.jsx(Pe,{...Ce,children:H({from:m===0?0:o*f+1,to:G(),count:m===-1?-1:m,page:o})}),e.jsx(l,{className:g.actions,backIconButtonProps:I,count:m,nextIconButtonProps:_,onPageChange:i,page:o,rowsPerPage:f,showFirstButton:Y,showLastButton:U,slotProps:S.actions,slots:B.actions,getItemAriaLabel:k,disabled:d})]})})});class O{static async getAuditLogs(s){const n=new URLSearchParams;s&&(s.user_id&&n.set("user_id",s.user_id.toString()),s.action&&n.set("action",s.action),s.resource_type&&n.set("resource_type",s.resource_type),s.start_date&&n.set("start_date",s.start_date),s.end_date&&n.set("end_date",s.end_date),s.search&&n.set("search",s.search),s.page&&n.set("page",s.page.toString()),s.page_size&&n.set("page_size",s.page_size.toString()),s.sort_by&&n.set("sort_by",s.sort_by),s.sort_order&&n.set("sort_order",s.sort_order));const p=n.toString(),l=p?`audit-logs?${p}`:"audit-logs";return await le(()=>Q.get(l).json(),{maxAttempts:3,initialDelay:1e3})}static async getAuditActions(){return await le(()=>Q.get("audit-logs/actions").json(),{maxAttempts:3,initialDelay:1e3})}static async getAuditResourceTypes(){return await le(()=>Q.get("audit-logs/resource-types").json(),{maxAttempts:3,initialDelay:1e3})}static async getAuditUsers(){return await le(()=>Q.get("audit-logs/users").json(),{maxAttempts:3,initialDelay:1e3})}static async exportCSV(s){const n=new URLSearchParams;s&&(s.user_id&&n.set("user_id",s.user_id.toString()),s.action&&n.set("action",s.action),s.resource_type&&n.set("resource_type",s.resource_type),s.start_date&&n.set("start_date",s.start_date),s.end_date&&n.set("end_date",s.end_date),s.search&&n.set("search",s.search));const p=n.toString(),l=p?`audit-logs/export/csv?${p}`:"audit-logs/export/csv";return await Q.get(l).blob()}static async downloadCSV(s){const n=await this.exportCSV(s),p=window.URL.createObjectURL(n),l=document.createElement("a");l.href=p,l.download=`audit_logs_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(p),document.body.removeChild(l)}static async downloadPDF(s){const n=await this.getAuditLogs({...s,page:1,page_size:1e4}),{jsPDF:p}=await me(async()=>{const{jsPDF:r}=await import("./jspdf.es.min-Bm_vtoqk.js").then(b=>b.j);return{jsPDF:r}},__vite__mapDeps([0,1,2]));await me(()=>import("./jspdf.plugin.autotable-CiWB1QeR.js"),[]);const l=new p;l.setFontSize(16),l.text("Audit Log Report",14,20),l.setFontSize(10),l.text(`Generated: ${new Date().toLocaleString()}`,14,28);const I=n.data.map(r=>{var b;return[new Date(r.created_at).toLocaleString(),r.username||"System",r.action.replace(/_/g," "),r.resource_type.replace(/_/g," "),((b=r.resource_id)==null?void 0:b.toString())||"-",r.ip_address||"-"]});l.autoTable({startY:35,head:[["Timestamp","User","Action","Resource","ID","IP"]],body:I,styles:{fontSize:8},headStyles:{fillColor:[66,66,66]}}),l.save(`audit_logs_${new Date().toISOString().split("T")[0]}.pdf`)}}const mt={login_success:{label:"Login Success",color:"#4caf50"},login_failure:{label:"Login Failed",color:"#f44336"},logout:{label:"Logout",color:"#9e9e9e"},booking_created:{label:"Booking Created",color:"#2196f3"},booking_updated:{label:"Booking Updated",color:"#ff9800"},booking_cancelled:{label:"Booking Cancelled",color:"#f44336"},booking_checkin:{label:"Guest Checked In",color:"#4caf50"},booking_checkout:{label:"Guest Checked Out",color:"#9c27b0"},room_status_changed:{label:"Room Status Changed",color:"#795548"},guest_created:{label:"Guest Created",color:"#2196f3"},guest_updated:{label:"Guest Updated",color:"#ff9800"},guest_deleted:{label:"Guest Deleted",color:"#f44336"},user_created:{label:"User Created",color:"#2196f3"},role_assigned:{label:"Role Assigned",color:"#4caf50"},role_removed:{label:"Role Removed",color:"#f44336"},settings_changed:{label:"Settings Changed",color:"#ff9800"},password_changed:{label:"Password Changed",color:"#9c27b0"},ekyc_approved:{label:"eKYC Approved",color:"#4caf50"},ekyc_rejected:{label:"eKYC Rejected",color:"#f44336"}},ft={user:{label:"User",color:"#3f51b5"},guest:{label:"Guest",color:"#009688"},booking:{label:"Booking",color:"#673ab7"},room:{label:"Room",color:"#795548"},user_role:{label:"User Role",color:"#607d8b"},system_setting:{label:"Settings",color:"#ff5722"},ekyc_verification:{label:"eKYC",color:"#00bcd4"}};function Se(a){return mt[a]||{label:a.replace(/_/g," "),color:"#757575"}}function ve(a){return ft[a]||{label:a.replace(/_/g," "),color:"#757575"}}const At=()=>{var v;const[a,s]=u.useState([]),[n,p]=u.useState(0),[l,I]=u.useState(!0),[r,b]=u.useState(!1),[m,d]=u.useState([]),[k,H]=u.useState([]),[K,_]=u.useState([]),[i,q]=u.useState(!1),[o,f]=u.useState({page:1,page_size:25,sort_by:"created_at",sort_order:"desc"}),[P,E]=u.useState(""),[Y,U]=u.useState(new Set),S=u.useCallback(async()=>{try{I(!0);const t=await O.getAuditLogs(o);s(t.data),p(t.total)}catch(t){console.error("Failed to fetch audit logs:",t)}finally{I(!1)}},[o]),B=u.useCallback(async()=>{try{const[t,c,h]=await Promise.all([O.getAuditActions(),O.getAuditResourceTypes(),O.getAuditUsers()]);d(t),H(c),_(h)}catch(t){console.error("Failed to fetch filter options:",t)}},[]);u.useEffect(()=>{S()},[S]),u.useEffect(()=>{B()},[B]),u.useEffect(()=>{const t=setTimeout(()=>{P!==(o.search||"")&&f(c=>({...c,search:P||void 0,page:1}))},500);return()=>clearTimeout(t)},[P,o.search]);const C=(t,c)=>{f(h=>({...h,[t]:c||void 0,page:1}))},y=()=>{E(""),f({page:1,page_size:25,sort_by:"created_at",sort_order:"desc"})},g=(t,c)=>{f(h=>({...h,page:c+1}))},j=t=>{f(c=>({...c,page_size:parseInt(t.target.value,10),page:1}))},M=t=>{U(c=>{const h=new Set(c);return h.has(t)?h.delete(t):h.add(t),h})},$=async()=>{try{b(!0),await O.downloadCSV(o)}catch(t){console.error("Failed to export CSV:",t)}finally{b(!1)}},J=async()=>{try{b(!0),await O.downloadPDF(o)}catch(t){console.error("Failed to export PDF:",t)}finally{b(!1)}},N=t=>new Date(t).toLocaleString(),G=!!(o.action||o.resource_type||o.user_id||o.start_date||o.end_date||o.search);return e.jsxs(R,{sx:{p:3},children:[e.jsxs(R,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(A,{variant:"h4",children:"Audit Log"}),e.jsxs(R,{sx:{display:"flex",gap:1},children:[e.jsx(re,{variant:"outlined",startIcon:e.jsx(Ne,{}),onClick:$,disabled:r||l,children:"Export CSV"}),e.jsx(re,{variant:"outlined",startIcon:e.jsx(Ge,{}),onClick:J,disabled:r||l,children:"Export PDF"}),e.jsx(W,{onClick:S,disabled:l,children:e.jsx(ze,{})})]})]}),e.jsx(Ve,{sx:{mb:2},children:e.jsxs(Oe,{children:[e.jsxs(R,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(ue,{placeholder:"Search logs...",value:P,onChange:t=>E(t.target.value),size:"small",sx:{flexGrow:1},InputProps:{startAdornment:e.jsx(We,{position:"start",children:e.jsx(He,{})})}}),e.jsxs(re,{variant:i?"contained":"outlined",startIcon:e.jsx(Ke,{}),onClick:()=>q(!i),children:["Filters ",G&&`(${Object.values(o).filter(Boolean).length-4})`]}),G&&e.jsx(re,{variant:"text",startIcon:e.jsx(qe,{}),onClick:y,children:"Clear"})]}),e.jsx(je,{in:i,children:e.jsxs(V,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(V,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ge,{children:"Action"}),e.jsxs(ie,{value:o.action||"",label:"Action",onChange:t=>C("action",t.target.value),children:[e.jsx(D,{value:"",children:"All Actions"}),m.map(t=>e.jsx(D,{value:t,children:Se(t).label},t))]})]})}),e.jsx(V,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ge,{children:"Resource Type"}),e.jsxs(ie,{value:o.resource_type||"",label:"Resource Type",onChange:t=>C("resource_type",t.target.value),children:[e.jsx(D,{value:"",children:"All Resources"}),k.map(t=>e.jsx(D,{value:t,children:ve(t).label},t))]})]})}),e.jsx(V,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ge,{children:"User"}),e.jsxs(ie,{value:((v=o.user_id)==null?void 0:v.toString())||"",label:"User",onChange:t=>C("user_id",t.target.value?parseInt(t.target.value):void 0),children:[e.jsx(D,{value:"",children:"All Users"}),K.map(t=>e.jsx(D,{value:t.id.toString(),children:t.username},t.id))]})]})}),e.jsx(V,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ue,{fullWidth:!0,size:"small",type:"date",label:"Start Date",value:o.start_date||"",onChange:t=>C("start_date",t.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(V,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ue,{fullWidth:!0,size:"small",type:"date",label:"End Date",value:o.end_date||"",onChange:t=>C("end_date",t.target.value),InputLabelProps:{shrink:!0}})})]})})]})}),e.jsx(Ye,{component:fe,children:l?e.jsx(R,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(Ee,{})}):a.length===0?e.jsx(R,{sx:{textAlign:"center",p:4},children:e.jsx(A,{color:"textSecondary",children:"No audit logs found"})}):e.jsxs(e.Fragment,{children:[e.jsxs(Je,{size:"small",children:[e.jsx(Qe,{children:e.jsxs(he,{children:[e.jsx(x,{width:40}),e.jsx(x,{children:"Timestamp"}),e.jsx(x,{children:"User"}),e.jsx(x,{children:"Action"}),e.jsx(x,{children:"Resource"}),e.jsx(x,{children:"IP Address"})]})}),e.jsx(Xe,{children:a.map(t=>{const c=Y.has(t.id),h=Se(t.action),L=ve(t.resource_type);return e.jsxs(Ue.Fragment,{children:[e.jsxs(he,{hover:!0,sx:{"& > *":{borderBottom:c?"none":void 0}},children:[e.jsx(x,{children:t.details&&e.jsx(W,{size:"small",onClick:()=>M(t.id),children:c?e.jsx(Ze,{}):e.jsx(et,{})})}),e.jsx(x,{children:e.jsx(A,{variant:"body2",children:N(t.created_at)})}),e.jsx(x,{children:e.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:.5},children:[t.username?e.jsx(Me,{fontSize:"small"}):e.jsx(tt,{fontSize:"small"}),e.jsx(A,{variant:"body2",children:t.username||"System"})]})}),e.jsx(x,{children:e.jsx(ye,{label:h.label,size:"small",sx:{backgroundColor:h.color,color:"white",fontWeight:500}})}),e.jsx(x,{children:e.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ye,{label:L.label,size:"small",variant:"outlined",sx:{borderColor:L.color,color:L.color}}),t.resource_id&&e.jsxs(A,{variant:"body2",color:"textSecondary",children:["#",t.resource_id]})]})}),e.jsx(x,{children:e.jsx($e,{title:t.user_agent||"",children:e.jsx(A,{variant:"body2",color:"textSecondary",children:t.ip_address||"-"})})})]}),e.jsx(he,{children:e.jsx(x,{colSpan:6,sx:{py:0},children:e.jsx(je,{in:c,timeout:"auto",unmountOnExit:!0,children:e.jsxs(R,{sx:{p:2,backgroundColor:"grey.50"},children:[e.jsx(A,{variant:"subtitle2",gutterBottom:!0,children:"Details"}),e.jsx(fe,{variant:"outlined",sx:{p:2,backgroundColor:"grey.100"},children:e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"0.85rem"},children:JSON.stringify(t.details,null,2)})}),t.user_agent&&e.jsx(R,{sx:{mt:1},children:e.jsxs(A,{variant:"caption",color:"textSecondary",children:["User Agent: ",t.user_agent]})})]})})})})]},t.id)})})]}),e.jsx(bt,{component:"div",count:n,page:(o.page||1)-1,rowsPerPage:o.page_size||25,onPageChange:g,onRowsPerPageChange:j,rowsPerPageOptions:[10,25,50,100]})]})})]})};export{At as default};
