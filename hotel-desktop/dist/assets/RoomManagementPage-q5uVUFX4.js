import{l as Us,j as e,i as rr,r as l,H as f,B as c,C as A,p as C,f as ht,T as s,D as Be,G as R,q as Fe,aE as zs,P as xe,Z as ut,I as Ns,aF as ir,t as me,aG as or,w as ar,o as m,n as p,A as $,F as xt,y as mt,S as pt,a6 as Lt,ad as Ts,a0 as lr,a1 as Ms}from"./index-DnWmqzJF.js";import{u as cr}from"./useCurrency-C4JSCWBJ.js";import{g as gt}from"./currency-SgYezy9c.js";import{i as Gs}from"./validation-C2QFlzQX.js";import{P as dr,g as hr,b as ur}from"./roomStatusConfig-B1QbfJX6.js";import{C as xr}from"./CheckoutInvoiceModal-EWeHLpHP.js";import{E as mr,U as pr}from"./UnifiedBookingModal-B4ujMiZd.js";import{C as F}from"./Chip-CSuofl6d.js";import{G as r}from"./Grid-0tqG7FTE.js";import{C as gr,a as jr}from"./CardContent-BhQI87uj.js";import{B as Pe}from"./EventAvailable-CtePsli0.js";import{T as fr}from"./AccessTime-l9--GsKj.js";import{C as te}from"./Login-D54QK0No.js";import{R as Oe}from"./Receipt-BNM73xOv.js";import{D as E,a as q,b as V,c as K}from"./DialogTitle-DKxRfOzX.js";import{S as ze}from"./Stack-DcjgMJBo.js";import{A as $t}from"./Autocomplete-CZ6UKh6h.js";import{C as As}from"./Cancel-zFl1_j2m.js";import{C as Ut}from"./CheckCircle-B5gS3fbx.js";import{C as Ls,M as $s,B as yr}from"./Report-B_BU71sw.js";import{F as br}from"./FormGroup-mJQ_joo_.js";import{F as _r}from"./FormControlLabel-Ddfix5uo.js";import{C as vr}from"./Checkbox-1RYp8RQ2.js";import{S as Cr}from"./Snackbar-BmHWVIFe.js";import{P as kr}from"./PersonAdd-C6oEVzXr.js";import"./Business-D15Uf3Sq.js";import"./InputAdornment-BrN3aL1-.js";import"./VisibilityOff-JntHt1L2.js";import"./Visibility-DUc7LFax.js";import"./Search-CErNxQ4Y.js";import"./format-DjXxzLAN.js";import"./Stepper-DWx8UZeC.js";import"./ArrowBack-DoSpaJPE.js";import"./Check-D73JkDWp.js";const Sr=Us(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),wr=Us(e.jsx("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHoriz"),gi=()=>{var Fs,Ps,Os;const Hs=rr(),{format:pe,symbol:_}=cr(),[P,Ht]=l.useState([]),[ie,Es]=l.useState([]),[qs,Et]=l.useState(!0),[Ne,qt]=l.useState(null),[i,U]=l.useState(null),[ge,jt]=l.useState({open:!1,message:"",severity:"success"}),[X,Vs]=l.useState(new Map),[je,Ks]=l.useState(new Map),[Xs,Ys]=l.useState(new Map),[Vt,Qs]=l.useState([]),[y,oe]=l.useState(null),[Zs,Kt]=l.useState(!1),[Js,ft]=l.useState(!1),[en,yt]=l.useState(!1),[tn,Te]=l.useState(!1),[sn,bt]=l.useState(!1),[nn,Me]=l.useState(!1),[rn,Ge]=l.useState(!1),[Xt,_t]=l.useState(""),[fe,Yt]=l.useState(!1),[I,vt]=l.useState(null),[ye,Qt]=l.useState(!1),[O,Ct]=l.useState(null),[Dr,Ir]=l.useState(""),[Wr,Rr]=l.useState(""),[Ae,Zt]=l.useState(""),[Le,Jt]=l.useState(""),[kt,St]=l.useState(1),[B,W]=l.useState(!1),[se,$e]=l.useState(!1),[g,Z]=l.useState({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}),[Ue,es]=l.useState(0),[be,ts]=l.useState("cash"),[_e,wt]=l.useState(0),on=[{value:"cash",label:"Cash"},{value:"card",label:"Credit/Debit Card"},{value:"bank_transfer",label:"Bank Transfer"},{value:"e_wallet",label:"E-Wallet"}],[He,Ee]=l.useState(null),[ve,qe]=l.useState(""),[Dt,Ve]=l.useState(""),[Ce,It]=l.useState(""),[ke,Wt]=l.useState(""),[ss,Ke]=l.useState(1),[ne,Se]=l.useState(!1),[j,Y]=l.useState({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}),[an,ns]=l.useState(!1),[re,Rt]=l.useState(null),[ae,Bt]=l.useState(""),[le,Ft]=l.useState(""),[ln,Xe]=l.useState(1),[cn,Br]=l.useState([]),[dn,Fr]=l.useState(!1),[rs,is]=l.useState([]),[hn,os]=l.useState(!1),[v,un]=l.useState(null),[xn,Ye]=l.useState(!1),[Pt,as]=l.useState(0),[Q,ls]=l.useState(null),[mn,cs]=l.useState(!1),[ds,pn]=l.useState([]),[b,we]=l.useState({room_id:"",check_in_date:new Date().toISOString().split("T")[0],check_out_date:new Date(Date.now()+864e5).toISOString().split("T")[0],adults:1,children:0,special_requests:""}),[L,J]=l.useState([]),[Ot,hs]=l.useState(!1),[De,zt]=l.useState(null),[Qe,us]=l.useState([]),[gn,Ze]=l.useState(!1),[jn,Je]=l.useState(null),[fn,et]=l.useState(null),[yn,xs]=l.useState(!1),[bn,ms]=l.useState(void 0),[_n,tt]=l.useState(!1),[ps,vn]=l.useState([]),[Cn,Pr]=l.useState(!1),[kn,Ie]=l.useState(!1),[u,st]=l.useState(null),[We,gs]=l.useState(!1),[Or,Nt]=l.useState(!1),[js,Tt]=l.useState(""),[Sn,ce]=l.useState(!1),[T,de]=l.useState(null),[nt,rt]=l.useState(""),[Re,fs]=l.useState(!1),wn=gt().booking_channels,Dn=gt().payment_methods;l.useEffect(()=>{M();const t=setInterval(()=>it(),3e4);return()=>clearInterval(t)},[]),l.useEffect(()=>{if(Qe.length>0&&L.length>0){const t=L.filter(n=>!at(n));t.length!==L.length&&J(t)}},[Qe]);const M=async()=>{await Promise.all([it(!0),Mt(),ys()])},it=async(t=!1)=>{try{Et(!0);const n=await f.getAllRooms();if(t){const o=n.filter(a=>a.status==="cleaning"&&!a.available);if(o.length>0){for(const h of o)await f.updateRoom(h.id,{available:!0});console.log(`Fixed ${o.length} hidden cleaning rooms`);const a=await f.getAllRooms();Ht(a);return}}Ht(n)}catch(n){d(n.message||"Failed to load rooms","error")}finally{Et(!1)}},ys=async()=>{try{const t=await f.getAllBookings();Qs(t);const n=new Map,o=new Map,a=new Map;t.forEach(h=>{(h.status==="checked_in"||h.status==="auto_checked_in")&&n.set(h.room_id,h),(h.status==="confirmed"||h.status==="pending")&&o.set(h.room_id,h),h.status==="comp_cancelled"&&a.set(h.room_id,h)}),Vs(n),Ks(o),Ys(a)}catch(t){console.error("Failed to load bookings:",t)}},Mt=async()=>{try{const t=await f.getAllGuests();Es(t)}catch(t){d(t.message||"Failed to load guests","error")}},d=(t,n)=>{jt({open:!0,message:t,severity:n})},bs=(t,n)=>{t.preventDefault(),qt({top:t.clientY,left:t.clientX}),U(n)},z=()=>{qt(null)},In=t=>hr(t.status||"available"),Wn=t=>{const n=t.status||"available";return ur(n).toUpperCase()},Rn=t=>({deluxe:"DLXX",superior:"SUP",standard:"STD",suite:"STE","standard queen":"STDQ","family room":"FR"})[t.toLowerCase()]||t.substring(0,4).toUpperCase(),_s=(t,n)=>{U(t),ms(n),xs(!0),z()},vs=()=>{B||(Kt(!1),Ct(null),$e(!1),Z({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}),es(0),ts("cash"),wt(0))},Cs=()=>{B||(ft(!1),Ee(null),qe(""),Ve(""),Se(!1),Y({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}))},ks=()=>{B||(ns(!1),Rt(null),Bt(""),Ft(""),Xe(1))},Bn=async()=>{if(!i||!re){d("Please select a guest with free room credits","error");return}if(!ae||!le){d("Please select check-in and check-out dates","error");return}try{W(!0);const t=[],n=new Date(ae),o=new Date(le);for(let h=new Date(n);h<o;h.setDate(h.getDate()+1))t.push(h.toISOString().split("T")[0]);const a=await f.bookWithCredits({guest_id:re.id,room_id:typeof i.id=="string"?parseInt(i.id):i.id,check_in_date:ae,check_out_date:le,complimentary_dates:t});d(`Complimentary reservation created for ${re.full_name} in Room ${i.room_number} (${a.complimentary_nights} nights used)`,"success"),ns(!1),Rt(null),Bt(""),Ft(""),Xe(1),await M()}catch(t){d(t.message||"Failed to create reservation","error")}finally{W(!1)}},Fn=async()=>{if(!i){d("Please select a room","error");return}let t=null;try{if(W(!0),se){if(!g.first_name||!g.last_name){d("Please fill in all required fields (First Name, Last Name)","error"),W(!1);return}if(g.email&&g.email.trim()&&!Gs(g.email)){d("Please enter a valid email address","error"),W(!1);return}if(g.email&&g.email.trim()&&ie.find(N=>N.email&&N.email.toLowerCase()===g.email.toLowerCase())){d(`A guest with email ${g.email} already exists. Please select from existing guests.`,"error"),W(!1);return}t=await f.createGuest({first_name:g.first_name,last_name:g.last_name,email:g.email||void 0,phone:g.phone,ic_number:g.ic_number,nationality:g.nationality}),await Mt(),Z({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""})}else{if(!O){d("Please select a guest","error"),W(!1);return}t=O}const n=new Date().toISOString().split("T")[0],o=new Date(Date.now()+864e5).toISOString().split("T")[0];if(!i||!i.id){d("Invalid room selection. Please try again.","error"),W(!1);return}const a=t.guest_type==="member",h=a?0:_e,D={guest_id:t.id,room_id:String(i.id),check_in_date:Ae||n,check_out_date:Le||o,number_of_guests:1,post_type:"normal_stay",booking_remarks:a?"Walk-In Guest (Member - Card Deposit Waived)":"Walk-In Guest",source:"walk_in",room_card_deposit:h,payment_method:be,amount_paid:Ue},x=await f.createBooking(D),k={id:x.id,guest_id:t.id.toString(),room_id:i.id,room_type:i.room_type,check_in_date:x.check_in_date,check_out_date:x.check_out_date,total_amount:x.total_amount,status:x.status,folio_number:x.folio_number||`WALKIN-${x.id}`,market_code:"Walk-In",rate_code:"RACK",payment_method:be==="cash"?"Cash":be==="card"?"Card":be==="bank_transfer"?"Bank Transfer":"E-Wallet",post_type:x.post_type,created_at:x.created_at,updated_at:x.updated_at};Je(k),et(t),Kt(!1),Ze(!0)}catch(n){d(n.message||"Failed to create guest","error")}finally{W(!1)}},Gt=t=>{U(t),z();const n=je.get(t.id);if(n){st(n),Tt(""),Nt(!1),Ie(!0);return}ft(!0)},Pn=async(t=!1)=>{if(!u){d("No booking selected","error");return}if(t&&!js){d("Please select a payment method for the deposit","error");return}try{if(gs(!0),t){const n=u.room_card_deposit||50;await f.updateBooking(u.id,{deposit_paid:!0,deposit_amount:Number(n),payment_method:js})}await f.checkInGuest(u.id,{}),d(`Guest ${u.guest_name} checked in successfully to Room ${u.room_number}`,"success"),Ie(!1),st(null),Nt(!1),Tt(""),await M()}catch(n){d(n.message||"Failed to check in guest","error")}finally{gs(!1)}},On=async()=>{if(!T){d("No booking selected","error");return}if(!nt){d("Please select a payment method","error");return}try{fs(!0);const t=gt().room_card_deposit;await f.updateBooking(T.id,{payment_status:"paid",payment_method:nt,deposit_paid:!0,deposit_amount:t}),d(`Deposit collected for booking ${T.booking_number}. Room is now ready for check-in.`,"success"),ce(!1),de(null),rt(""),await M()}catch(t){d(t.message||"Failed to collect deposit","error")}finally{fs(!1)}},zn=async()=>{if(!i){d("Please select a room","error");return}if(!ve){d("Please select a booking channel","error");return}let t=null;try{if(W(!0),ne){if(!j.first_name||!j.last_name){d("Please fill in all required fields (First Name, Last Name)","error"),W(!1);return}if(j.email&&j.email.trim()&&!Gs(j.email)){d("Please enter a valid email address","error"),W(!1);return}if(j.email&&j.email.trim()&&ie.find(N=>N.email&&N.email.toLowerCase()===j.email.toLowerCase())){d(`A guest with email ${j.email} already exists. Please select from existing guests.`,"error"),W(!1);return}t=await f.createGuest({first_name:j.first_name,last_name:j.last_name,email:j.email||void 0,phone:j.phone,ic_number:j.ic_number,nationality:j.nationality}),await Mt(),Y({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""})}else{if(!He){d("Please select a guest","error"),W(!1);return}t=He}const n=new Date().toISOString().split("T")[0],o=new Date(Date.now()+864e5).toISOString().split("T")[0];if(!i||!i.id){console.error("Invalid room selection:",{selectedRoom:i,id:i==null?void 0:i.id}),d("Invalid room selection. Please try again.","error"),W(!1);return}const a=Ce||n,h=ke||o;if(console.log("Date debug:",{onlineCheckInDate:Ce,onlineCheckOutDate:ke,checkInDateToUse:a,checkOutDateToUse:h,today:n,tomorrow:o}),!a||!h){d("Check-in and check-out dates are required","error"),W(!1);return}const D=new Date(a);if(new Date(h)<=D){d("Check-out date must be after check-in date","error"),W(!1);return}const k={guest_id:t.id,room_id:String(i.id),check_in_date:a,check_out_date:h,number_of_guests:1,post_type:"normal_stay",source:"online",booking_remarks:Dt?`${ve} - Ref: ${Dt}`:`${ve} Booking`};console.log("Creating reservation with data:",k),await f.createBooking(k),d(`Reservation created for ${t.full_name} in Room ${i.room_number}`,"success"),ft(!1),Ee(null),qe(""),Ve(""),It(""),Wt(""),Ke(1),Se(!1),Y({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}),await M()}catch(n){d(n.message||"Failed to create guest","error")}finally{W(!1)}},Nn=async()=>{d("Guest checked in successfully!","success"),Ze(!1),Je(null),et(null),Ct(null),Zt(""),Jt(""),St(1),$e(!1),Z({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}),Ee(null),qe(""),Ve(""),It(""),Wt(""),Ke(1),Se(!1),Y({first_name:"",last_name:"",email:"",phone:"",nationality:"",ic_number:""}),await M()},Ss=t=>{U(t);const n=X.get(t.id);n?(oe(n),yt(!0)):d("No active booking found for this room","error"),z()},Tn=async t=>{if(y)try{const n={status:"checked_out"};t&&(n.late_checkout_penalty=t.penalty,n.late_checkout_notes=t.notes),await f.updateBooking(y.id,n);const o=t?`Room requires cleaning after late checkout. Late checkout penalty: ${t.penalty}. Notes: ${t.notes||"None"}`:"Room requires cleaning after checkout";if(await f.updateRoomStatus(y.room_id,{status:"dirty",notes:o}),y.company_id&&y.company_name)try{const h=typeof y.total_amount=="string"?parseFloat(y.total_amount):y.total_amount||0,D=(t==null?void 0:t.penalty)||0,x=h+D,k=new Date(y.check_in_date),H=new Date(y.check_out_date),G=Math.ceil((H.getTime()-k.getTime())/(1e3*60*60*24));let N=`Room ${y.room_number} - ${y.guest_name}`;N+=` (${G} night${G>1?"s":""}: ${y.check_in_date} to ${y.check_out_date})`,D>0&&(N+=" + Late checkout penalty"),await f.createCustomerLedger({company_name:y.company_name,description:N,expense_type:"accommodation",amount:x,booking_id:parseInt(y.id),room_number:y.room_number,posting_date:new Date().toISOString().split("T")[0],transaction_date:new Date().toISOString().split("T")[0],post_type:"room_charge",notes:t!=null&&t.notes?`Late checkout: ${t.notes}`:void 0})}catch(h){console.error("Failed to post room charges to company ledger:",h)}const a=t?`Room ${i==null?void 0:i.room_number} checked out (late checkout penalty: RM ${t.penalty})`:`Room ${i==null?void 0:i.room_number} checked out successfully`;d(a,"success"),await M(),yt(!1),oe(null)}catch(n){throw new Error(n.message||"Failed to process checkout")}},Mn=async t=>{try{await f.updateRoomStatus(t.id,{status:"cleaning",notes:"Room marked as dirty - requires cleaning"}),d(`Room ${t.room_number} marked as dirty`,"success"),await M()}catch(n){d(n.message||"Failed to update room status","error")}z()},Gn=async t=>{try{await f.updateRoomStatus(t.id,{status:"available",notes:"Room cleaned and ready for guests"}),await f.updateRoom(t.id,{available:!0}),d(`Room ${t.room_number} marked as clean`,"success"),await M()}catch(n){d(n.message||"Failed to update room status","error")}z()},An=async t=>{try{await f.updateRoomStatus(t.id,{status:"maintenance",notes:"Room under maintenance"}),d(`Room ${t.room_number} set to maintenance`,"success"),await M()}catch(n){d(n.message||"Failed to update room status","error")}z()},ws=t=>{z(),U(t),tt(!0);const n=new Date;n.setHours(0,0,0,0);const o=Vt.filter(a=>{var H;const h=((H=a.room_id)==null?void 0:H.toString())===t.id.toString(),D=new Date(a.check_in_date);D.setHours(0,0,0,0);const x=D>=n,k=["pending","confirmed","checked_in","auto_checked_in"].includes(a.status);return h&&(x||a.status==="checked_in")&&k});o.sort((a,h)=>new Date(a.check_in_date).getTime()-new Date(h.check_in_date).getTime()),vn(o)},Ln=async t=>{U(t),Te(!0),z();try{os(!0);const n=await f.getRoomHistory(t.id);is(n)}catch(n){d(n.message||"Failed to load room history","error"),is([])}finally{os(!1)}},ot=t=>{const n=ie.find(o=>o.id.toString()===t.toString());n?(un(n),as(0),ls(null),zt(null),J([]),Ye(!0),z(),Ds(n.id)):d(`Guest not found (ID: ${t})`,"error")},Ds=async t=>{try{cs(!0);const n=await f.getGuestCredits(t);ls(n)}catch(n){console.error("Error loading guest credits:",n)}finally{cs(!1)}},$n=()=>{pn(P)},Un=t=>{const o=Vt.filter(a=>{var h;return((h=a.room_id)==null?void 0:h.toString())===t&&!["cancelled","no_show","checked_out"].includes(a.status)}).map(a=>({start:a.check_in_date,end:a.check_out_date,status:a.status}));us(o)},at=t=>{const n=new Date(t);n.setHours(0,0,0,0);for(const o of Qe){const a=new Date(o.start);a.setHours(0,0,0,0);const h=new Date(o.end);if(h.setHours(0,0,0,0),n>=a&&n<h)return!0}return!1},lt=()=>{const t=[],n=new Date(b.check_in_date),o=new Date(b.check_out_date);for(let a=new Date(n);a<o;a.setDate(a.getDate()+1))t.push(a.toISOString().split("T")[0]);return t},ct=t=>{if(!Q||!t)return 0;const n=ds.find(a=>a.id.toString()===t);if(!n)return 0;const o=Q.credits_by_room_type.find(a=>{var h;return(h=n.room_type)==null?void 0:h.toLowerCase().includes(a.room_type_name.toLowerCase())});return(o==null?void 0:o.nights_available)||0},Hn=t=>{if(at(t))return;const n=ct(b.room_id);L.includes(t)?J(o=>o.filter(a=>a!==t)):L.length<n&&J(o=>[...o,t])},En=()=>{const t=lt(),n=ct(b.room_id),o=t.filter(a=>!at(a));J(o.slice(0,n))},qn=async()=>{if(!v||!b.room_id||L.length===0){d("Please select a room and at least one complimentary date","error");return}try{hs(!0);const t=await f.bookWithCredits({guest_id:v.id,room_id:parseInt(b.room_id,10),check_in_date:b.check_in_date,check_out_date:b.check_out_date,adults:b.adults,children:b.children,special_requests:b.special_requests,complimentary_dates:L});zt({booking_id:t.booking_id,booking_number:t.booking_number,complimentary_nights:t.complimentary_nights}),d(`Booking created successfully! ${t.complimentary_nights} night(s) are complimentary.`,"success"),Ds(v.id),it()}catch(t){d(t.message||"Failed to book with credits","error")}finally{hs(!1)}},Vn=async()=>{if(De)try{await f.checkInGuest(De.booking_id.toString()),d("Guest checked in successfully!","success"),Ye(!1),it(),ys()}catch(t){d(t.message||"Failed to check in guest","error")}},Kn=t=>{U(t),bt(!0),z()},Is=t=>{U(t),vt(null);const n=X.get(t.id);oe(n||null),Me(!0),z()},Xn=async()=>{if(!i||!I||!y){d("Please select a new room","error");return}try{Qt(!0);const t=typeof i.price_per_night=="string"?parseFloat(i.price_per_night):i.price_per_night,o=(typeof I.price_per_night=="string"?parseFloat(I.price_per_night):I.price_per_night)-t;await f.updateBooking(y.id,{room_id:String(I.id)}),await f.updateRoomStatus(i.id,{status:"cleaning",notes:`Guest moved to room ${I.room_number}`}),await f.updateRoomStatus(I.id,{status:"occupied",notes:`Guest moved from room ${i.room_number}`});const a=o>0?`Room changed successfully. Additional charge: ${_}${Math.abs(o).toFixed(2)}/night`:o<0?`Room changed successfully. Credit applied: ${_}${Math.abs(o).toFixed(2)}/night`:"Room changed successfully. No additional charges.";d(a,"success"),Me(!1),vt(null),await M()}catch(t){d(t.message||"Failed to change room","error")}finally{Qt(!1)}},Yn=t=>{U(t);const n=je.get(t.id);n?(oe(n),_t(""),Ge(!0)):d("No pending booking found for this room","error"),z()},Qn=async()=>{if(!y){d("No booking selected","error");return}try{Yt(!0);const t=await f.markBookingComplimentary(y.id,Xt||void 0);d(`Booking marked as complimentary! ${t.nights_credited} night(s) of ${t.room_type} credits added to guest.`,"success"),Ge(!1),_t(""),oe(null),await M()}catch(t){d(t.message||"Failed to mark booking as complimentary","error")}finally{Yt(!1)}},Zn=t=>{if(!t)return[];const n=X.get(t.id),o=je.get(t.id),a=new Date;a.setHours(0,0,0,0);const h=(n==null?void 0:n.status)==="checked_in",D=o&&(()=>{const ee=new Date(o.check_in_date);return ee.setHours(0,0,0,0),ee<=a})(),x=h?"occupied":D?"reserved":["maintenance","dirty","cleaning"].includes(t.status||"")?t.status:"available",k=x==="occupied",H=x==="reserved",G=x==="maintenance",N=k&&(n==null?void 0:n.is_complimentary)===!0||H&&(o==null?void 0:o.is_complimentary)===!0,S=[];if(G||(S.push({id:"upcoming",label:"View Upcoming Bookings",icon:e.jsx(ut,{}),color:"info",onClick:ws}),S.push({id:"divider-upcoming",label:"-",icon:e.jsx(e.Fragment,{}),onClick:()=>{}})),N&&(S.push({id:"complimentary-info",label:"ðŸŽ Free Gift Booking - No Cancellation",icon:e.jsx(R,{}),color:"secondary",onClick:()=>{d("This is a complimentary (Free Gift) booking. Cancellation is not recommended as the guest has used their free credits.","success")}}),S.push({id:"divider-comp",label:"-",icon:e.jsx(e.Fragment,{}),onClick:()=>{}})),!k&&!G)if(H&&o){const ee=o.guest_type==="member";o.payment_status==="paid"||ee?S.push({id:"reserved-checkin",label:"Check-in Guest",icon:e.jsx(te,{}),color:"primary",onClick:Gt}):S.push({id:"collect-deposit",label:"Collect Deposit (Required)",icon:e.jsx(Oe,{}),color:"warning",onClick:ue=>{U(ue),de(o),ce(!0),z()}}),o.is_complimentary||S.push({id:"complimentary",label:"Mark as Complimentary",icon:e.jsx(R,{}),color:"secondary",onClick:Yn})}else S.push({id:"new-booking",label:"New Booking",icon:e.jsx(kr,{}),onClick:_s});return k&&(n!=null&&n.guest_id)&&S.push({id:"guest-details",label:"View Guest Details",icon:e.jsx(xe,{}),color:"info",onClick:ee=>ot(n.guest_id)}),k&&n&&S.push({id:"change-room",label:"Change Room",icon:e.jsx(ht,{}),color:"warning",onClick:Is}),k&&S.push({id:"checkout",label:"Check Out",icon:e.jsx(zs,{}),color:"error",onClick:Ss}),S.length>0&&S.push({id:"divider1",label:"-",icon:e.jsx(e.Fragment,{}),onClick:()=>{}}),k||S.push({id:"clean",label:"Make Vacant/Clean",icon:e.jsx(Ut,{}),color:"success",onClick:Gn}),S.push({id:"dirty",label:"Make Dirty",icon:e.jsx(Ls,{}),color:"warning",onClick:Mn}),S.push({id:"maintenance",label:"Set Maintenance",icon:e.jsx($s,{}),color:"warning",onClick:An},{id:"divider2",label:"-",icon:e.jsx(e.Fragment,{}),onClick:()=>{}},{id:"history",label:"Show Room History",icon:e.jsx(Lt,{}),onClick:Ln},{id:"properties",label:"Room Properties...",icon:e.jsx(Ts,{}),onClick:Kn}),S};if(qs)return e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(A,{})});const he=t=>{const n=X.get(t.id),o=je.get(t.id),a=new Date;a.setHours(0,0,0,0);const h=(n==null?void 0:n.status)==="checked_in",D=o&&(()=>{const x=new Date(o.check_in_date);return x.setHours(0,0,0,0),x<=a})();return h?"occupied":D?"reserved":["maintenance","dirty","cleaning"].includes(t.status||"")?t.status:"available"},Jn=P.filter(t=>he(t)==="available").length,Ws=P.filter(t=>he(t)==="occupied").length,er=P.filter(t=>he(t)==="reserved").length,dt=P.filter(t=>he(t)==="cleaning").length,Rs=P.filter(t=>he(t)==="dirty").length,Bs=P.filter(t=>he(t)==="maintenance").length,tr=P.length>0?Math.round(Ws/P.length*100):0;return e.jsxs(c,{sx:{p:3},children:[e.jsxs(C,{elevation:0,sx:{p:2.5,mb:3,bgcolor:"white",border:"1px solid",borderColor:"divider",borderRadius:2},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:2,mb:2},children:[e.jsxs(c,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:.5},children:[e.jsx(ht,{sx:{fontSize:28,color:"primary.main"}}),e.jsx(s,{variant:"h5",sx:{fontWeight:700,color:"text.primary"},children:"Room Management"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[P.length," total rooms â€¢ ",tr,"% occupancy â€¢ Click room for actions"]})]}),e.jsxs(c,{sx:{display:"flex",gap:1.5,flexWrap:"wrap"},children:[e.jsxs(C,{elevation:0,sx:{px:2,py:1,bgcolor:"#66BB6A",color:"white",borderRadius:1.5,textAlign:"center",minWidth:80},children:[e.jsx(s,{variant:"h5",fontWeight:700,children:Jn}),e.jsx(s,{variant:"caption",children:"Available"})]}),e.jsxs(C,{elevation:0,sx:{px:2,py:1,bgcolor:"#FFA726",color:"white",borderRadius:1.5,textAlign:"center",minWidth:80},children:[e.jsx(s,{variant:"h5",fontWeight:700,children:Ws}),e.jsx(s,{variant:"caption",children:"Occupied"})]}),e.jsxs(C,{elevation:0,sx:{px:2,py:1,bgcolor:"#42A5F5",color:"white",borderRadius:1.5,textAlign:"center",minWidth:80},children:[e.jsx(s,{variant:"h5",fontWeight:700,children:er}),e.jsx(s,{variant:"caption",children:"Reserved"})]}),(dt>0||Rs>0)&&e.jsxs(C,{elevation:0,sx:{px:2,py:1,bgcolor:dt>0?"#2196f3":"#ff6f00",color:"white",borderRadius:1.5,textAlign:"center",minWidth:80},children:[e.jsx(s,{variant:"h5",fontWeight:700,children:dt+Rs}),e.jsx(s,{variant:"caption",children:dt>0?"Cleaning":"Dirty"})]}),Bs>0&&e.jsxs(C,{elevation:0,sx:{px:2,py:1,bgcolor:"#757575",color:"white",borderRadius:1.5,textAlign:"center",minWidth:80},children:[e.jsx(s,{variant:"h5",fontWeight:700,children:Bs}),e.jsx(s,{variant:"caption",children:"Maintenance"})]})]})]}),e.jsx(Be,{sx:{my:2}}),e.jsxs(c,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(s,{variant:"caption",sx:{fontWeight:600,color:"text.secondary"},children:"Status:"}),[{label:"Available",color:"#66BB6A"},{label:"Occupied",color:"#FFA726"},{label:"Reserved",color:"#42A5F5"},{label:"Dirty",color:"#ff6f00"},{label:"Cleaning",color:"#2196f3"},{label:"Maintenance",color:"#757575"}].map(t=>e.jsx(F,{label:t.label,size:"small",sx:{bgcolor:t.color,color:"white",fontWeight:500,fontSize:"0.7rem",height:22}},t.label))]})]}),e.jsx(r,{container:!0,spacing:2,children:P.map(t=>{const n=X.get(t.id),o=je.get(t.id),a=Xs.get(t.id),h=new Date;h.setHours(0,0,0,0);const D=(n==null?void 0:n.status)==="checked_in"||(n==null?void 0:n.status)==="auto_checked_in",x=o&&(()=>{const w=new Date(o.check_in_date);return w.setHours(0,0,0,0),(o.status==="confirmed"||o.status==="pending")&&w<=h})(),k=o&&!x,H=k?new Date(o.check_in_date):null,G=D?"occupied":x?"reserved":["maintenance","dirty","cleaning"].includes(t.status||"")?t.status:"available",N={...t,status:G},S=G==="occupied",ee=G==="reserved",ue=ee&&x,At=S&&(n==null?void 0:n.is_complimentary)===!0||ee&&(o==null?void 0:o.is_complimentary)===!0,sr=In(N),nr=G==="cleaning";return e.jsx(r,{item:!0,xs:6,sm:4,md:3,lg:2,children:e.jsx(gr,{elevation:2,sx:{bgcolor:sr,color:nr?"#333":"white",cursor:"pointer","&:hover":{boxShadow:4},position:"relative",height:240,display:"flex",flexDirection:"column",borderRadius:2,overflow:"hidden"},onClick:w=>{w.preventDefault(),bs(w,t)},children:e.jsxs(jr,{sx:{p:1.5,flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[ue&&e.jsx(Pe,{sx:{position:"absolute",top:8,left:8,fontSize:24,color:"inherit",opacity:.9}}),At&&e.jsxs(c,{sx:{position:"absolute",top:8,left:ue?36:8,display:"flex",alignItems:"center",gap:.3,bgcolor:"rgba(156, 39, 176, 0.9)",borderRadius:1,px:.5,py:.2},children:[e.jsx(R,{sx:{fontSize:14}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.6rem",fontWeight:600},children:"FREE"})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mt:ue||At?3:0},children:[e.jsx(ht,{sx:{fontSize:20,opacity:.9}}),e.jsx(s,{variant:"h5",fontWeight:700,children:t.room_number})]}),e.jsx(F,{label:Rn(t.room_type),size:"small",sx:{fontSize:"0.7rem",fontWeight:600,mt:.5,mb:1,bgcolor:"rgba(0,0,0,0.15)",color:"inherit"}}),e.jsxs(s,{variant:"caption",display:"block",sx:{fontWeight:600,mb:.5},children:[Wn(N),At&&" â€¢ ðŸŽ FREE GIFT",a&&" â€¢ ðŸ”“ COMP CANCELLED"]}),k&&H&&o&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[e.jsx(Pe,{sx:{fontSize:12}}),e.jsxs(s,{variant:"caption",display:"block",sx:{fontSize:"0.6rem",fontWeight:500,bgcolor:"rgba(0,0,0,0.2)",px:.5,borderRadius:.5},children:["ðŸ“… Upcoming: ",new Date(o.check_in_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),a&&e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:e.jsxs(s,{variant:"caption",display:"block",sx:{fontSize:"0.6rem",fontWeight:500,bgcolor:"rgba(156, 39, 176, 0.3)",px:.5,borderRadius:.5},children:["Comp Cancelled: ",new Date(a.check_in_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(a.check_out_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})}),S&&n&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[e.jsx(fr,{sx:{fontSize:14}}),e.jsxs(s,{variant:"caption",display:"block",sx:{fontSize:"0.65rem",fontWeight:500},children:[new Date(n.check_in_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(n.check_out_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),n!=null&&n.guest_name&&S?e.jsxs(c,{sx:{mt:1,pt:1,borderTop:"1px solid rgba(255,255,255,0.2)"},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:700,mb:.25,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem"},children:n.guest_name}),e.jsx(c,{sx:{display:"flex",flexDirection:"column",gap:.25},children:n.guest_phone&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(dr,{sx:{fontSize:12,opacity:.8}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.65rem",opacity:.9,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.guest_phone})]})}),e.jsxs(c,{sx:{display:"flex",gap:.5,mt:1},children:[e.jsx(Fe,{title:"Check Out",arrow:!0,children:e.jsxs(c,{onClick:w=>{w.stopPropagation(),Ss(t)},sx:{flex:1,bgcolor:"rgba(255,255,255,0.2)",borderRadius:1,p:.5,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.35)"},display:"flex",alignItems:"center",justifyContent:"center",gap:.3},children:[e.jsx(zs,{sx:{fontSize:14}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.6rem",fontWeight:600},children:"Out"})]})}),e.jsx(Fe,{title:"Change Room",arrow:!0,children:e.jsxs(c,{onClick:w=>{w.stopPropagation(),Is(t)},sx:{flex:1,bgcolor:"rgba(255,255,255,0.2)",borderRadius:1,p:.5,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.35)"},display:"flex",alignItems:"center",justifyContent:"center",gap:.3},children:[e.jsx(wr,{sx:{fontSize:14}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.6rem",fontWeight:600},children:"Move"})]})}),e.jsx(Fe,{title:"View Guest",arrow:!0,children:e.jsxs(c,{onClick:w=>{w.stopPropagation(),ot(n.guest_id)},sx:{flex:1,bgcolor:"rgba(255,255,255,0.2)",borderRadius:1,p:.5,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.35)"},display:"flex",alignItems:"center",justifyContent:"center",gap:.3},children:[e.jsx(xe,{sx:{fontSize:14}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.6rem",fontWeight:600},children:"Guest"})]})})]})]}):t.status_notes?e.jsx(s,{variant:"caption",display:"block",sx:{fontSize:"0.65rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.status_notes}):null,ue&&o&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[e.jsx(ut,{sx:{fontSize:14}}),e.jsxs(s,{variant:"caption",display:"block",sx:{fontSize:"0.65rem",fontWeight:500},children:[new Date(o.check_in_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(o.check_out_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),o.guest_name&&e.jsx(c,{sx:{mt:1,pt:1,borderTop:"1px solid rgba(255,255,255,0.2)"},children:e.jsx(s,{variant:"body2",sx:{fontWeight:700,mb:.25,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem"},children:o.guest_name})}),e.jsx(c,{sx:{mt:1},children:o.payment_status==="paid"||o.guest_type==="member"||o.is_complimentary?e.jsxs(c,{onClick:w=>{w.stopPropagation(),Gt(t)},sx:{bgcolor:"rgba(255,255,255,0.2)",borderRadius:1,p:.5,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.35)"},display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(te,{sx:{fontSize:16}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:600},children:"Check-in"})]}):e.jsxs(c,{onClick:w=>{w.stopPropagation(),U(t),de(o),ce(!0)},sx:{bgcolor:"rgba(255,255,255,0.2)",borderRadius:1,p:.5,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.35)"},display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(Oe,{sx:{fontSize:16}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:600},children:"Collect Payment"})]})})]}),k&&o&&!S&&e.jsxs(c,{onClick:w=>{w.stopPropagation(),ws(t)},sx:{position:"absolute",bottom:12,left:12,right:12,bgcolor:"#2196f3",borderRadius:1,p:.75,cursor:"pointer","&:hover":{bgcolor:"#1976d2"},display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(ut,{sx:{fontSize:16}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:600},children:"View Upcoming Booking"})]}),G==="available"&&!k&&e.jsx(c,{sx:{position:"absolute",bottom:12,left:12,right:12},children:e.jsx(Fe,{title:"Create new booking",arrow:!0,children:e.jsxs(c,{onClick:w=>{w.stopPropagation(),_s(t)},sx:{bgcolor:"rgba(255,255,255,0.3)",borderRadius:1,py:.75,cursor:"pointer","&:hover":{bgcolor:"rgba(255,255,255,0.45)"},display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(Pe,{sx:{fontSize:16}}),e.jsx(s,{variant:"caption",sx:{fontSize:"0.7rem",fontWeight:600},children:"New Booking"})]})})}),e.jsx(Fe,{title:"More actions",arrow:!0,placement:"top",children:e.jsx(Ns,{size:"small",sx:{position:"absolute",top:8,right:8,color:"inherit",bgcolor:"rgba(0,0,0,0.15)","&:hover":{bgcolor:"rgba(0,0,0,0.25)"}},onClick:w=>{w.stopPropagation(),bs(w,t)},children:e.jsx(Sr,{fontSize:"small"})})})]})})},t.id)})}),e.jsxs(ir,{open:!!Ne,onClose:z,anchorReference:"anchorPosition",anchorPosition:Ne?{top:Ne.top,left:Ne.left}:void 0,PaperProps:{sx:{minWidth:240}},children:[i&&e.jsxs(c,{sx:{px:2,py:1,bgcolor:"grey.100"},children:[e.jsxs(s,{variant:"subtitle2",fontWeight:600,children:["Room ",i.room_number]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[i.room_type," â€¢ Status: ",((Fs=i.status)==null?void 0:Fs.toUpperCase())||"UNKNOWN"]})]}),e.jsx(Be,{}),Zn(i).map(t=>t.label==="-"?e.jsx(Be,{sx:{my:1}},t.id):e.jsxs(me,{onClick:()=>i&&t.onClick(i),children:[e.jsx(or,{sx:{color:t.color||"inherit"},children:t.icon}),e.jsx(ar,{primary:t.label,sx:{color:t.color||"inherit"}})]},t.id))]}),e.jsxs(E,{open:Zs,onClose:vs,maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"primary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(te,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Walk-in Check-in - Room ",(i==null?void 0:i.room_number)||"N/A"]})]})}),e.jsx(V,{sx:{pt:3},children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(ze,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(m,{variant:se?"outlined":"contained",onClick:()=>$e(!1),size:"small",children:"Select Existing Guest"}),e.jsx(m,{variant:se?"contained":"outlined",onClick:()=>$e(!0),size:"small",children:"Register New Guest"})]})}),!se&&e.jsxs(r,{item:!0,xs:12,children:[e.jsx($t,{value:O,onChange:(t,n)=>{Ct(n),(n==null?void 0:n.guest_type)==="member"&&wt(0)},options:ie,getOptionLabel:t=>t.email?`${t.full_name} - ${t.email}`:t.full_name,renderOption:(t,n)=>{const{key:o,...a}=t;return e.jsxs(c,{component:"li",...a,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(c,{sx:{flex:1},children:[e.jsx(s,{variant:"body2",children:n.full_name}),n.email&&e.jsx(s,{variant:"caption",color:"text.secondary",children:n.email})]}),n.guest_type==="member"&&e.jsx(F,{label:"Member",size:"small",color:"success",sx:{fontSize:"0.65rem",height:20}})]},o)},renderInput:t=>e.jsx(p,{...t,label:"Select Guest *",placeholder:"Search by name or email"})}),(O==null?void 0:O.guest_type)==="member"&&e.jsx($,{severity:"success",sx:{mt:1},icon:e.jsx(R,{}),children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:O.full_name})," is a Member â€” Room card deposit is ",e.jsx("strong",{children:"waived"})]})})]}),se&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,label:"First Name",value:g.first_name,onChange:t=>Z({...g,first_name:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,label:"Last Name",value:g.last_name,onChange:t=>Z({...g,last_name:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Email",type:"email",value:g.email,onChange:t=>Z({...g,email:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Phone",value:g.phone,onChange:t=>Z({...g,phone:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"IC/Passport Number",value:g.ic_number,onChange:t=>Z({...g,ic_number:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Nationality",value:g.nationality,onChange:t=>Z({...g,nationality:t.target.value})})})]}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,type:"date",label:"Check-in Date",value:Ae,onChange:t=>{if(Zt(t.target.value),Le){const n=new Date(t.target.value),o=new Date(Le),a=Math.max(1,Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)));St(a)}},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,type:"date",label:"Check-out Date",value:Le,onChange:t=>{if(Jt(t.target.value),Ae){const n=new Date(Ae),o=new Date(t.target.value),a=Math.max(1,Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)));St(a)}},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Booking Summary"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Number of Nights:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",children:kt})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Rate:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",children:[_,(i==null?void 0:i.price_per_night)||0," / night"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Charges:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",children:[_,(()=>{const t=(i==null?void 0:i.price_per_night)||0;return((typeof t=="string"?parseFloat(t):t)*kt).toFixed(2)})()]})})]})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"primary.50",border:1,borderColor:"primary.200"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,sx:{color:"primary.main",fontWeight:600},children:"Deposit Collection"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:12,md:4,children:(()=>{const t=(O==null?void 0:O.guest_type)==="member";return e.jsx(p,{fullWidth:!0,label:"Room Card Deposit",type:"number",value:t?0:_e,onChange:n=>!t&&wt(parseFloat(n.target.value)||0),disabled:t,InputProps:{startAdornment:e.jsx(s,{sx:{mr:.5},children:_}),endAdornment:t?e.jsx(F,{label:"Waived",size:"small",color:"success",sx:{fontSize:"0.65rem",height:20}}):null},helperText:t?"âœ“ Waived for members":"Refundable deposit for room key",sx:t?{"& .MuiInputBase-root":{bgcolor:"success.50"},"& .MuiFormHelperText-root":{color:"success.main",fontWeight:500}}:{}})})()}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(p,{fullWidth:!0,required:!0,label:"Deposit Amount",type:"number",value:Ue,onChange:t=>es(parseFloat(t.target.value)||0),InputProps:{startAdornment:e.jsx(s,{sx:{mr:.5},children:_})},helperText:"Amount collected now"})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(p,{fullWidth:!0,select:!0,label:"Payment Method",value:be,onChange:t=>ts(t.target.value),children:on.map(t=>e.jsx(me,{value:t.value,children:t.label},t.value))})})]})]})}),e.jsx(r,{item:!0,xs:12,children:(()=>{const t=(O==null?void 0:O.guest_type)==="member",n=t?0:_e,o=(i==null?void 0:i.price_per_night)||0,h=(typeof o=="string"?parseFloat(o):o)*kt,D=h+n,x=Math.max(0,D-Ue);return e.jsxs(C,{sx:{p:2,bgcolor:"success.50",border:1,borderColor:"success.200"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,sx:{color:"success.main",fontWeight:600},children:"Payment Summary"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Charges:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",children:[_,h.toFixed(2)]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Card Deposit:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:1},children:t?e.jsxs(e.Fragment,{children:[e.jsxs(s,{variant:"body2",sx:{textDecoration:"line-through",color:"text.disabled"},children:[_,_e.toFixed(2)||"50.00"]}),e.jsx(F,{label:"Waived",size:"small",color:"success",sx:{fontSize:"0.6rem",height:18}})]}):e.jsxs(s,{variant:"body2",children:[_,_e.toFixed(2)]})})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",fontWeight:"bold",children:"Total Due:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",fontWeight:"bold",children:[_,D.toFixed(2)]})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(c,{sx:{borderTop:1,borderColor:"divider",my:1}})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"success.main",fontWeight:"bold",children:"Deposit Collected:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",color:"success.main",fontWeight:"bold",children:[_,Ue.toFixed(2)]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"warning.main",fontWeight:"bold",children:"Balance Due at Check-out:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",color:"warning.main",fontWeight:"bold",children:[_,x.toFixed(2)]})}),t&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(c,{sx:{borderTop:1,borderColor:"divider",my:1}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx($,{severity:"info",sx:{py:.5},icon:e.jsx(R,{sx:{fontSize:18}}),children:e.jsx(s,{variant:"caption",children:"Member benefit: Room card deposit waived and will not appear on invoice"})})})]})]})]})})()})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:vs,disabled:B,children:"Cancel"}),e.jsx(c,{sx:{flex:1}}),e.jsx(m,{variant:"contained",onClick:Fn,disabled:B||!se&&!O||se&&(!g.first_name||!g.last_name),startIcon:B?e.jsx(A,{size:20}):null,size:"large",children:B?"Processing...":"Check In & Collect Deposit"})]})]}),e.jsxs(E,{open:Js,onClose:Cs,maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"primary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Pe,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Online Booking - Room ",(i==null?void 0:i.room_number)||"N/A"]})]})}),e.jsx(V,{sx:{pt:3},children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(ze,{direction:"row",spacing:1,sx:{mb:2},children:[e.jsx(m,{variant:ne?"outlined":"contained",onClick:()=>Se(!1),size:"small",children:"Select Existing Guest"}),e.jsx(m,{variant:ne?"contained":"outlined",onClick:()=>Se(!0),size:"small",children:"Register New Guest"})]})}),!ne&&e.jsx(r,{item:!0,xs:12,children:e.jsx($t,{value:He,onChange:(t,n)=>Ee(n),options:ie,getOptionLabel:t=>t.email?`${t.full_name} - ${t.email}`:t.full_name,renderInput:t=>e.jsx(p,{...t,label:"Select Guest *",placeholder:"Search by name or email"})})}),ne&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,label:"First Name",value:j.first_name,onChange:t=>Y({...j,first_name:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,label:"Last Name",value:j.last_name,onChange:t=>Y({...j,last_name:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Email",type:"email",value:j.email,onChange:t=>Y({...j,email:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Phone",value:j.phone,onChange:t=>Y({...j,phone:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"IC/Passport Number",value:j.ic_number,onChange:t=>Y({...j,ic_number:t.target.value})})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Nationality",value:j.nationality,onChange:t=>Y({...j,nationality:t.target.value})})})]}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsxs(xt,{fullWidth:!0,required:!0,children:[e.jsx(mt,{children:"Booking Channel"}),e.jsx(pt,{value:ve,onChange:t=>qe(t.target.value),label:"Booking Channel",children:wn.map(t=>e.jsx(me,{value:t,children:t},t))})]})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,label:"Booking Reference",value:Dt,onChange:t=>Ve(t.target.value),placeholder:"e.g., OL-123456"})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,type:"date",label:"Check-in Date",value:Ce,onChange:t=>{if(It(t.target.value),ke){const n=new Date(t.target.value),o=new Date(ke),a=Math.max(1,Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)));Ke(a)}},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,type:"date",label:"Check-out Date",value:ke,onChange:t=>{if(Wt(t.target.value),Ce){const n=new Date(Ce),o=new Date(t.target.value),a=Math.max(1,Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)));Ke(a)}},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Booking Summary"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Number of Nights:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",children:ss})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Rate:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",children:[_,(i==null?void 0:i.price_per_night)||0," / night"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Amount:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",fontWeight:"bold",children:[_,(()=>{const t=(i==null?void 0:i.price_per_night)||0;return((typeof t=="string"?parseFloat(t):t)*ss).toFixed(2)})()]})})]})]})})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:Cs,disabled:B,children:"Cancel"}),e.jsx(c,{sx:{flex:1}}),e.jsx(m,{variant:"contained",onClick:zn,disabled:B||!ve||!ne&&!He||ne&&(!j.first_name||!j.last_name),startIcon:B?e.jsx(A,{size:20}):null,size:"large",children:B?"Processing...":"Create Reservation"})]})]}),e.jsxs(E,{open:an,onClose:ks,maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"secondary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Complimentary Booking - Room ",(i==null?void 0:i.room_number)||"N/A"]})]})}),e.jsx(V,{sx:{pt:3},children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsx($,{severity:"info",sx:{mb:2},children:e.jsxs(s,{variant:"body2",children:["This booking uses the guest's ",e.jsx("strong",{children:"Free Room Credits"}),". Only guests with available credits are shown below."]})})}),e.jsx(r,{item:!0,xs:12,children:dn?e.jsxs(c,{sx:{display:"flex",justifyContent:"center",p:2},children:[e.jsx(A,{size:24}),e.jsx(s,{sx:{ml:1},children:"Loading guests with credits..."})]}):e.jsx($t,{value:re,onChange:(t,n)=>Rt(n),options:cn,getOptionLabel:t=>t.email?`${t.full_name} - ${t.email} (${t.total_complimentary_credits} credits)`:`${t.full_name} (${t.total_complimentary_credits} credits)`,renderOption:(t,n)=>{const{key:o,...a}=t;return e.jsx(c,{component:"li",...a,children:e.jsxs(c,{sx:{width:"100%"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{children:[e.jsx(s,{variant:"body1",children:n.full_name}),n.email&&e.jsx(s,{variant:"caption",color:"text.secondary",children:n.email})]}),e.jsx(F,{icon:e.jsx(R,{sx:{fontSize:14}}),label:`${n.total_complimentary_credits} night${n.total_complimentary_credits!==1?"s":""}`,size:"small",color:"secondary"})]}),n.credits_by_room_type.length>0&&e.jsx(c,{sx:{mt:.5,display:"flex",flexWrap:"wrap",gap:.5},children:n.credits_by_room_type.map(h=>e.jsx(F,{label:`${h.room_type_name}: ${h.nights_available}`,size:"small",variant:"outlined",sx:{fontSize:"0.65rem",height:20}},h.room_type_id))})]})},o)},renderInput:t=>e.jsx(p,{...t,label:"Select Guest with Free Room Credits *",placeholder:"Search by name or email"}),noOptionsText:"No guests with free room credits found"})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,type:"date",label:"Check-in Date",value:ae,onChange:t=>{if(Bt(t.target.value),le){const n=new Date(t.target.value),o=new Date(le),a=Math.max(1,Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)));Xe(a)}},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,md:6,children:e.jsx(p,{fullWidth:!0,required:!0,type:"date",label:"Check-out Date",value:le,onChange:t=>{if(Ft(t.target.value),ae){const n=new Date(ae),o=new Date(t.target.value),a=Math.max(1,Math.ceil((o.getTime()-n.getTime())/(1e3*60*60*24)));Xe(a)}},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"secondary.light"},children:[e.jsxs(s,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(R,{})," Booking Summary"]}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Number of Nights:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",children:ln})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Rate:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",sx:{textDecoration:"line-through",color:"text.disabled"},children:[_,(i==null?void 0:i.price_per_night)||0," / night"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Amount:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",fontWeight:"bold",color:"success.main",children:"FREE (Complimentary)"})}),re&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Credits Available:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:re.credits_by_room_type.map(t=>e.jsx(F,{size:"small",label:`${t.room_type_name}: ${t.nights_available}`,color:"secondary",variant:"outlined",sx:{fontSize:"0.7rem"}},t.room_type_id))})})]})]})]})})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:ks,disabled:B,children:"Cancel"}),e.jsx(c,{sx:{flex:1}}),e.jsx(m,{variant:"contained",color:"secondary",onClick:Bn,disabled:B||!re,startIcon:B?e.jsx(A,{size:20}):e.jsx(R,{}),size:"large",children:B?"Processing...":"Create Reservation"})]})]}),e.jsxs(E,{open:nn,onClose:()=>!ye&&Me(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"primary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ht,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Change Room - Current: ",(i==null?void 0:i.room_number)||"N/A"]})]})}),e.jsx(V,{sx:{pt:3},children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"grey.100"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Current Room"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Number:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",fontWeight:"bold",children:i==null?void 0:i.room_number})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room Type:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",children:i==null?void 0:i.room_type})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Rate:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",children:[_,i==null?void 0:i.price_per_night," / night"]})})]})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(xt,{fullWidth:!0,required:!0,children:[e.jsx(mt,{children:"Select New Room"}),e.jsx(pt,{value:(I==null?void 0:I.id)||"",onChange:t=>{const n=P.find(o=>o.id===t.target.value);vt(n||null)},label:"Select New Room",children:P.filter(t=>t.status==="available"&&t.id!==(i==null?void 0:i.id)).map(t=>e.jsxs(me,{value:t.id,children:["Room ",t.room_number," - ",t.room_type," (",_,t.price_per_night,"/night)"]},t.id))})]})}),I&&i&&e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"info.lighter"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Price Difference"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"New Room Rate:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",fontWeight:"bold",children:[_,I.price_per_night," / night"]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Difference per Night:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",fontWeight:"bold",color:(()=>{const t=typeof i.price_per_night=="string"?parseFloat(i.price_per_night):i.price_per_night,o=(typeof I.price_per_night=="string"?parseFloat(I.price_per_night):I.price_per_night)-t;return o>0?"error.main":o<0?"success.main":"text.primary"})(),children:(()=>{const t=typeof i.price_per_night=="string"?parseFloat(i.price_per_night):i.price_per_night,o=(typeof I.price_per_night=="string"?parseFloat(I.price_per_night):I.price_per_night)-t;return o>0?`+${_}${o.toFixed(2)} (Additional Charge)`:o<0?`-${_}${Math.abs(o).toFixed(2)} (Credit)`:`${_}0.00 (No Change)`})()})})]})]})})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:()=>Me(!1),disabled:ye,children:"Cancel"}),e.jsx(c,{sx:{flex:1}}),e.jsx(m,{variant:"contained",onClick:Xn,disabled:!I||ye,startIcon:ye?e.jsx(A,{size:20}):null,size:"large",color:"warning",children:ye?"Changing Room...":"Confirm Room Change"})]})]}),e.jsx(mr,{open:gn,onClose:()=>{Ze(!1),Je(null),et(null)},booking:jn,guest:fn,onCheckInSuccess:Nn}),e.jsx(pr,{open:yn,onClose:()=>{xs(!1),ms(void 0)},room:i,guests:ie,initialBookingType:bn,onSuccess:t=>d(t,"success"),onError:t=>d(t,"error"),onBookingCreated:(t,n)=>{Je(t),et(n),Ze(!0)},onRefreshData:M}),e.jsx(xr,{open:en,onClose:()=>{yt(!1),oe(null)},booking:y,onConfirmCheckout:Tn}),e.jsxs(E,{open:tn,onClose:()=>Te(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"primary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,flexDirection:"column"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Lt,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Room History - ",i==null?void 0:i.room_number]})]}),e.jsxs(s,{variant:"caption",sx:{opacity:.9,ml:5},children:[i==null?void 0:i.room_type," â€¢ Current Status: ",(i==null?void 0:i.status)||"Unknown"]})]}),e.jsx(Ns,{onClick:()=>Te(!1),sx:{color:"white"},children:e.jsx(As,{})})]})}),e.jsx(V,{sx:{p:0},children:hn?e.jsx(c,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(A,{})}):rs.length===0?e.jsx($,{severity:"info",sx:{m:2},children:"No history records found for this room"}):e.jsxs(c,{sx:{p:2},children:[i&&e.jsxs(C,{sx:{p:2,mb:2,bgcolor:"primary.50",borderLeft:4,borderColor:"primary.main"},children:[e.jsx(s,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Current Status"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Status"}),e.jsx(s,{variant:"body2",fontWeight:600,children:((Ps=i.status)==null?void 0:Ps.toUpperCase())||"UNKNOWN"})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Available"}),e.jsx(s,{variant:"body2",fontWeight:600,children:i.available?"Yes":"No"})]}),i.status_notes&&e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Notes"}),e.jsx(s,{variant:"body2",children:i.status_notes})]}),X.get(i.id)&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(Be,{sx:{my:1}})}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Guest"}),e.jsx(s,{variant:"body2",fontWeight:600,children:(Os=X.get(i.id))==null?void 0:Os.guest_name})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Booking Period"}),e.jsxs(s,{variant:"body2",children:[new Date(X.get(i.id).check_in_date).toLocaleDateString()," - ",new Date(X.get(i.id).check_out_date).toLocaleDateString()]})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(m,{size:"small",variant:"outlined",startIcon:e.jsx(xe,{}),onClick:()=>ot(X.get(i.id).guest_id),children:"View Guest Details"})})]})]})]}),e.jsx(s,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,sx:{mt:2,mb:1},children:"History Timeline"}),e.jsx(ze,{spacing:1,children:rs.map(t=>{const n=t.to_status==="occupied"?e.jsx(te,{}):t.to_status==="available"?e.jsx(Ut,{}):t.to_status==="cleaning"?e.jsx(Ls,{}):t.to_status==="maintenance"?e.jsx($s,{}):t.to_status==="reserved"?e.jsx(Pe,{}):e.jsx(Lt,{}),o=t.to_status==="occupied"?"#FFA726":t.to_status==="available"?"#66BB6A":t.to_status==="cleaning"?"#FFEB3B":t.to_status==="maintenance"?"#EF5350":t.to_status==="reserved"?"#42A5F5":"#BDBDBD";return e.jsx(C,{sx:{p:2,borderLeft:4,borderColor:o,cursor:t.guest_id?"pointer":"default","&:hover":t.guest_id?{bgcolor:"grey.50",boxShadow:2}:{}},onClick:()=>t.guest_id&&ot(t.guest_id),children:e.jsxs(r,{container:!0,spacing:1,alignItems:"center",children:[e.jsx(r,{item:!0,children:e.jsx(c,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:o,display:"flex",alignItems:"center",justifyContent:"center",color:t.to_status==="cleaning"?"#333":"white"},children:n})}),e.jsxs(r,{item:!0,xs:!0,children:[e.jsx(s,{variant:"body2",fontWeight:600,children:t.from_status?`${t.from_status.toUpperCase()} â†’ ${t.to_status.toUpperCase()}`:t.to_status.toUpperCase()}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[new Date(t.created_at).toLocaleString(),t.changed_by_name&&` â€¢ By: ${t.changed_by_name}`]}),t.guest_name&&e.jsxs(s,{variant:"caption",display:"block",sx:{mt:.5},children:["Guest: ",t.guest_name,t.start_date&&t.end_date&&e.jsxs(e.Fragment,{children:[" â€¢ ",new Date(t.start_date).toLocaleDateString()," - ",new Date(t.end_date).toLocaleDateString()]})]}),t.notes&&e.jsx(s,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:.5},children:t.notes}),t.guest_id&&e.jsx(F,{label:"Click to view guest details",size:"small",sx:{mt:1},icon:e.jsx(xe,{})})]})]})},t.id)})})]})}),e.jsx(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:e.jsx(m,{onClick:()=>Te(!1),variant:"outlined",children:"Close"})})]}),e.jsxs(E,{open:sn,onClose:()=>bt(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"primary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Ts,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Room Properties - ",i==null?void 0:i.room_number]})]})}),e.jsx(V,{sx:{pt:3},children:i&&e.jsx(c,{sx:{mt:2},children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Room Number"}),e.jsx(s,{variant:"body1",fontWeight:600,children:i.room_number})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Room Type"}),e.jsx(s,{variant:"body1",fontWeight:600,children:i.room_type})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Price per Night"}),e.jsx(s,{variant:"body1",fontWeight:600,children:pe(Number(i.price_per_night))})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Max Occupancy"}),e.jsxs(s,{variant:"body1",fontWeight:600,children:[i.max_occupancy," guests"]})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Status"}),e.jsx(s,{variant:"body1",fontWeight:600,children:i.status})]}),i.description&&e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Description"}),e.jsx(s,{variant:"body2",children:i.description})]})]})})}),e.jsx(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:e.jsx(m,{onClick:()=>bt(!1),variant:"outlined",children:"Close"})})]}),e.jsxs(E,{open:_n,onClose:()=>tt(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"info.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ut,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Upcoming Bookings - Room ",i==null?void 0:i.room_number]})]})}),e.jsx(V,{sx:{pt:3},children:Cn?e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",py:4,children:e.jsx(A,{})}):ps.length===0?e.jsx($,{severity:"info",sx:{mt:2},children:"No upcoming bookings for this room."}):e.jsx(c,{sx:{mt:1},children:ps.map((t,n)=>e.jsx(C,{elevation:1,sx:{p:2,mb:2,borderLeft:4,borderColor:t.status==="checked_in"?"warning.main":"info.main"},children:e.jsxs(r,{container:!0,spacing:2,alignItems:"center",children:[e.jsxs(r,{item:!0,xs:12,sm:6,children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,children:t.guest_name||"Unknown Guest"}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[t.guest_email||""," ",t.guest_phone?`â€¢ ${t.guest_phone}`:""]})]}),e.jsxs(r,{item:!0,xs:12,sm:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Check-in"}),e.jsx(s,{variant:"body2",fontWeight:500,children:new Date(t.check_in_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs(r,{item:!0,xs:12,sm:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:"Check-out"}),e.jsx(s,{variant:"body2",fontWeight:500,children:new Date(t.check_out_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(ze,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,alignItems:"center",children:[(()=>{const o=new Date(t.check_in_date);o.setHours(0,0,0,0);const a=new Date;a.setHours(0,0,0,0);const D=o.getTime()===a.getTime()&&(t.status==="confirmed"||t.status==="pending");return t.status==="checked_in"?e.jsx(F,{label:"Currently Occupied",size:"small",color:"warning"}):D?e.jsx(m,{size:"small",variant:"contained",color:"success",startIcon:e.jsx(te,{}),onClick:()=>{tt(!1);const x=P.find(k=>String(k.id)===String(t.room_id));x&&Gt(x)},sx:{fontWeight:600},children:"Check-In Now"}):e.jsx(F,{label:t.status==="confirmed"?"Confirmed":"Pending",size:"small",color:t.status==="confirmed"?"info":"default"})})(),t.is_complimentary&&e.jsx(F,{icon:e.jsx(R,{}),label:"Free Gift",size:"small",color:"secondary"}),e.jsx(F,{label:pe(Number(t.total_amount||0)),size:"small",variant:"outlined"})]})}),t.special_requests&&e.jsx(r,{item:!0,xs:12,children:e.jsxs(s,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Notes:"})," ",t.special_requests]})})]})},t.id))})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:()=>Hs(`/bookings?room=${i==null?void 0:i.room_number}`),variant:"outlined",color:"primary",children:"View All in Bookings Page"}),e.jsx(m,{onClick:()=>tt(!1),variant:"contained",children:"Close"})]})]}),e.jsxs(E,{open:kn,onClose:()=>{We||(Ie(!1),st(null),Nt(!1),Tt(""))},maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"success.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(te,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Check-In - Room ",u==null?void 0:u.room_number]})]})}),e.jsx(V,{sx:{pt:3},children:u&&e.jsxs(c,{children:[e.jsxs(C,{elevation:0,sx:{p:2,mb:2,bgcolor:"grey.50",borderRadius:2},children:[e.jsxs(s,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:["Booking #",u.booking_number]}),e.jsxs(r,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",fontWeight:600,children:u.guest_name}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[u.guest_email,u.guest_phone&&` â€¢ ${u.guest_phone}`]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Check-in"}),e.jsx(s,{variant:"body2",fontWeight:500,children:new Date(u.check_in_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Check-out"}),e.jsx(s,{variant:"body2",fontWeight:500,children:new Date(u.check_out_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Room Type"}),e.jsx(s,{variant:"body2",fontWeight:500,children:u.room_type})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Total Amount"}),e.jsx(s,{variant:"body2",fontWeight:500,children:pe(Number(u.total_amount||0))})]})]})]}),e.jsxs(C,{elevation:0,sx:{p:2,mb:2,bgcolor:u.payment_status==="paid"||u.guest_type==="member"?"success.light":"error.light",borderRadius:2,border:1,borderColor:u.payment_status==="paid"||u.guest_type==="member"?"success.main":"error.main"},children:[e.jsx(ze,{direction:"row",alignItems:"center",spacing:2,children:u.payment_status==="paid"||u.guest_type==="member"?e.jsxs(e.Fragment,{children:[e.jsx(Ut,{color:"success",sx:{fontSize:32}}),e.jsxs(c,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,color:"success.dark",children:u.guest_type==="member"?"Member - No Deposit Required":"Fully Paid"}),e.jsx(s,{variant:"body2",color:"success.dark",children:"Ready for check-in"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(As,{color:"error",sx:{fontSize:32}}),e.jsxs(c,{sx:{flex:1},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,color:"error.dark",children:"Payment Required"}),e.jsxs(s,{variant:"body2",color:"error.dark",children:["Amount Due: ",pe(Number(u.total_amount||0))]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Status: ",u.payment_status||"unpaid"]})]})]})}),u.payment_status!=="paid"&&u.guest_type!=="member"&&e.jsx(c,{sx:{mt:2},children:e.jsx(m,{variant:"contained",color:"error",fullWidth:!0,startIcon:e.jsx(Oe,{}),onClick:()=>{de(u),ce(!0),Ie(!1)},children:"Collect Deposit Now"})})]}),u.is_complimentary&&e.jsxs($,{severity:"info",icon:e.jsx(R,{}),sx:{mb:2},children:[e.jsx("strong",{children:"Complimentary Stay"}),u.complimentary_reason&&e.jsxs(s,{variant:"body2",children:["Reason: ",u.complimentary_reason]})]}),u.special_requests&&e.jsxs($,{severity:"warning",sx:{mb:2},children:[e.jsx("strong",{children:"Special Requests:"})," ",u.special_requests]})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:()=>{Ie(!1),st(null)},disabled:We,children:"Cancel"}),e.jsx(m,{variant:"contained",color:"success",onClick:()=>Pn(!1),disabled:We||(u==null?void 0:u.payment_status)!=="paid"&&(u==null?void 0:u.guest_type)!=="member",startIcon:We?e.jsx(A,{size:20,color:"inherit"}):e.jsx(te,{}),children:We?"Processing...":"Check-In Now"})]})]}),e.jsxs(E,{open:Sn,onClose:()=>{Re||(ce(!1),de(null),rt(""))},maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"warning.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Oe,{sx:{fontSize:28}}),e.jsxs(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:["Collect Deposit - Room ",T==null?void 0:T.room_number]})]})}),e.jsx(V,{sx:{pt:3},children:T&&e.jsxs(c,{children:[e.jsxs(C,{elevation:0,sx:{p:2,mb:3,bgcolor:"grey.50",borderRadius:2},children:[e.jsxs(s,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:["Booking #",T.booking_number]}),e.jsxs(r,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",fontWeight:600,children:T.guest_name}),e.jsx(s,{variant:"body2",color:"text.secondary",children:T.guest_email})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Check-in"}),e.jsx(s,{variant:"body2",fontWeight:500,children:new Date(T.check_in_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Check-out"}),e.jsx(s,{variant:"body2",fontWeight:500,children:new Date(T.check_out_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})]})]}),e.jsxs(C,{elevation:0,sx:{p:3,mb:3,bgcolor:"warning.light",borderRadius:2,border:1,borderColor:"warning.main",textAlign:"center"},children:[e.jsx(s,{variant:"caption",color:"warning.dark",display:"block",gutterBottom:!0,children:"Room Card Deposit"}),e.jsx(s,{variant:"h4",fontWeight:700,color:"warning.dark",children:pe(gt().room_card_deposit)}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Current Status: ",T.payment_status||"unpaid"]})]}),e.jsxs(xt,{fullWidth:!0,sx:{mb:2},children:[e.jsx(mt,{children:"Payment Method *"}),e.jsx(pt,{value:nt,onChange:t=>rt(t.target.value),label:"Payment Method *",children:Dn.map(t=>e.jsx(me,{value:t,children:t},t))})]}),e.jsx($,{severity:"info",sx:{mt:2},children:"After deposit is collected, the guest can be checked in."})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:()=>{ce(!1),de(null),rt("")},disabled:Re,children:"Cancel"}),e.jsx(m,{variant:"contained",color:"warning",onClick:On,disabled:Re||!nt,startIcon:Re?e.jsx(A,{size:20,color:"inherit"}):e.jsx(Oe,{}),children:Re?"Processing...":"Collect Deposit"})]})]}),e.jsxs(E,{open:xn,onClose:()=>Ye(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"primary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(xe,{sx:{fontSize:28}}),e.jsx(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:(v==null?void 0:v.full_name)||"Guest Details"})]})}),e.jsxs(lr,{value:Pt,onChange:(t,n)=>{as(n),n===1&&$n()},sx:{borderBottom:1,borderColor:"divider",px:3,"& .MuiTab-root":{textTransform:"none",fontSize:"0.95rem",fontWeight:500,minHeight:56,px:3}},children:[e.jsx(Ms,{label:"Guest Info",icon:e.jsx(xe,{}),iconPosition:"start"}),e.jsx(Ms,{label:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{children:"Free Gift Credits"}),Q&&Q.total_nights>0&&e.jsx(F,{label:Q.total_nights,size:"small",color:"secondary"})]}),icon:e.jsx(R,{}),iconPosition:"start"})]}),e.jsxs(V,{sx:{pt:3,pb:3,minHeight:400},children:[Pt===0&&v&&e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Email"}),e.jsx(s,{variant:"body2",children:v.email})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Phone"}),e.jsx(s,{variant:"body2",children:v.phone||"N/A"})]}),v.address_line1&&e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Address"}),e.jsxs(s,{variant:"body2",children:[v.address_line1,v.city&&`, ${v.city}`,v.state_province&&`, ${v.state_province}`,v.postal_code&&` ${v.postal_code}`]})]}),v.country&&e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Country"}),e.jsx(s,{variant:"body2",children:v.country})]}),v.nationality&&e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Nationality"}),e.jsx(s,{variant:"body2",children:v.nationality})]}),v.ic_number&&e.jsxs(r,{item:!0,xs:6,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"IC Number"}),e.jsx(s,{variant:"body2",children:v.ic_number})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(Be,{sx:{my:1}})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Member Since"}),e.jsx(s,{variant:"body2",children:new Date(v.created_at).toLocaleDateString()})]})]}),Pt===1&&e.jsx(c,{children:mn?e.jsx(c,{display:"flex",justifyContent:"center",py:4,children:e.jsx(A,{})}):De?e.jsxs(c,{children:[e.jsxs($,{severity:"success",sx:{mb:3},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,children:"ðŸŽ‰ Booking Created Successfully!"}),e.jsxs(s,{variant:"body2",children:["Booking #",De.booking_number," - ",De.complimentary_nights," night(s) are complimentary"]})]}),e.jsxs(c,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(m,{variant:"contained",color:"primary",size:"large",startIcon:e.jsx(te,{}),onClick:Vn,children:"Check In Now"}),e.jsx(m,{variant:"outlined",onClick:()=>{zt(null),J([])},children:"Book Another Room"})]})]}):e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"secondary.light"},children:[e.jsxs(s,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(R,{})," Available Free Gift Credits"]}),Q&&Q.total_nights>0?e.jsx(c,{children:Q.credits_by_room_type.map(t=>e.jsx(F,{icon:e.jsx(R,{}),label:`${t.room_type_name}: ${t.nights_available} night(s)`,color:"success",sx:{mr:1,mb:1}},t.id))}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"No complimentary credits available"})]})}),Q&&Q.total_nights>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,children:e.jsx(s,{variant:"subtitle1",fontWeight:600,children:"Book a Room with Free Gift Credits"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(p,{label:"Check-in Date",type:"date",fullWidth:!0,value:b.check_in_date,onChange:t=>{we({...b,check_in_date:t.target.value}),J([])},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(p,{label:"Check-out Date",type:"date",fullWidth:!0,value:b.check_out_date,onChange:t=>{we({...b,check_out_date:t.target.value}),J([])},InputLabelProps:{shrink:!0}})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(xt,{fullWidth:!0,children:[e.jsx(mt,{children:"Select Room"}),e.jsx(pt,{value:b.room_id,onChange:t=>{we({...b,room_id:t.target.value}),J([]),us([]),t.target.value&&Un(t.target.value)},label:"Select Room",children:ds.map(t=>e.jsxs(me,{value:t.id.toString(),children:["Room ",t.room_number," - ",t.room_type]},t.id))})]})}),b.room_id&&lt().length>0&&e.jsxs(r,{item:!0,xs:12,children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(s,{variant:"subtitle2",children:["Select Complimentary Dates (Available: ",ct(b.room_id),")"]}),e.jsx(m,{size:"small",onClick:En,children:"Select All Available"})]}),e.jsxs(C,{variant:"outlined",sx:{p:2,maxHeight:180,overflow:"auto"},children:[Qe.length>0&&e.jsxs(c,{sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{sx:{width:12,height:12,backgroundColor:"error.light",borderRadius:.5}}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Reserved (unavailable)"})]}),e.jsx(br,{row:!0,children:lt().map(t=>{const n=L.includes(t),o=at(t),a=!o&&(n||L.length<ct(b.room_id));return o?e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5,backgroundColor:"rgba(211, 47, 47, 0.12)",borderRadius:1,mr:1,mb:1,px:1,py:.5,border:"1px solid rgba(211, 47, 47, 0.4)",cursor:"not-allowed"},children:[e.jsx(yr,{sx:{fontSize:18,color:"error.main"}}),e.jsx(s,{variant:"body2",sx:{textDecoration:"line-through",color:"error.main",fontSize:"0.85rem"},children:new Date(t).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]},t):e.jsx(_r,{control:e.jsx(vr,{checked:n,onChange:()=>Hn(t),disabled:!a&&!n,color:"secondary"}),label:new Date(t).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),sx:{backgroundColor:n?"rgba(156, 39, 176, 0.1)":"transparent",borderRadius:1,mr:1,mb:1,px:1}},t)})})]}),L.length>0&&e.jsxs($,{severity:"success",sx:{mt:1},children:[L.length," night(s) will be complimentary (Free Gift)"]})]}),e.jsx(r,{item:!0,xs:6,children:e.jsx(p,{label:"Adults",type:"number",fullWidth:!0,value:b.adults,onChange:t=>we({...b,adults:parseInt(t.target.value)||1}),inputProps:{min:1,max:10}})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(p,{label:"Children",type:"number",fullWidth:!0,value:b.children,onChange:t=>we({...b,children:parseInt(t.target.value)||0}),inputProps:{min:0,max:10}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(m,{variant:"contained",color:"secondary",fullWidth:!0,size:"large",startIcon:Ot?e.jsx(A,{size:20,color:"inherit"}):e.jsx(R,{}),onClick:qn,disabled:Ot||!b.room_id||L.length===0||lt().length===0,children:Ot?"Creating Booking...":"Book with Free Gift Credits"})})]})]})})]}),e.jsx(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:e.jsx(m,{onClick:()=>Ye(!1),variant:"outlined",children:"Close"})})]}),e.jsxs(E,{open:rn,onClose:()=>!fe&&Ge(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{sx:{bgcolor:"secondary.main",color:"white",py:2,px:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(R,{sx:{fontSize:28}}),e.jsx(s,{variant:"h6",component:"span",sx:{fontWeight:600},children:"Mark Booking as Complimentary"})]})}),e.jsx(V,{sx:{pt:3},children:y&&e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,children:e.jsxs(C,{sx:{p:2,bgcolor:"grey.100"},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Booking Details"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Room:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",fontWeight:"bold",children:[i==null?void 0:i.room_number," - ",i==null?void 0:i.room_type]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Guest:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",fontWeight:"bold",children:y.guest_name})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Check-in Date:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",children:new Date(y.check_in_date).toLocaleDateString()})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Check-out Date:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",children:new Date(y.check_out_date).toLocaleDateString()})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"Original Amount:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",sx:{textDecoration:"line-through",color:"error.main"},children:[_,Number(y.total_amount).toFixed(2)]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"New Amount:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(s,{variant:"body2",fontWeight:"bold",color:"success.main",children:[_,"0.00 (Complimentary)"]})})]})]})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,label:"Reason for Complimentary Stay",placeholder:"e.g., VIP guest, compensation, promotional offer",value:Xt,onChange:t=>_t(t.target.value),multiline:!0,rows:2})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs($,{severity:"info",sx:{mt:1},children:["Marking this booking as complimentary will set the total amount to ",_,"0.00. If the guest cancels or doesn't show up, the complimentary nights will be converted to credits for future use."]})})]})}),e.jsxs(K,{sx:{px:3,py:2,bgcolor:"grey.50",borderTop:1,borderColor:"divider"},children:[e.jsx(m,{onClick:()=>Ge(!1),disabled:fe,children:"Cancel"}),e.jsx(c,{sx:{flex:1}}),e.jsx(m,{variant:"contained",color:"secondary",onClick:Qn,disabled:fe,startIcon:fe?e.jsx(A,{size:20}):e.jsx(R,{}),size:"large",children:fe?"Processing...":"Confirm Complimentary"})]})]}),e.jsx(Cr,{open:ge.open,autoHideDuration:4e3,onClose:()=>jt({...ge,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx($,{onClose:()=>jt({...ge,open:!1}),severity:ge.severity,sx:{width:"100%"},children:ge.message})})]})};export{gi as default};
