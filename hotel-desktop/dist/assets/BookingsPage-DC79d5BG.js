import{l as Ut,j as e,h as $t,r as l,H as W,B as x,C as Kt,T as c,o as g,x as Vt,A as B,f as qt,n as j,F as tt,y as st,S as at,t as n,p as Qt,q as N,G as nt,z as lt,E as Te,J as Jt,K as Xt,I as G}from"./index-DnWmqzJF.js";import{u as Yt}from"./useCurrency-C4JSCWBJ.js";import{C as Zt}from"./CheckoutInvoiceModal-EWeHLpHP.js";import{U as es,E as ts}from"./UnifiedBookingModal-B4ujMiZd.js";import{g as rt}from"./currency-SgYezy9c.js";import{B as it}from"./EventAvailable-CtePsli0.js";import{G as d}from"./Grid-0tqG7FTE.js";import{C as V,a as oe}from"./CardContent-BhQI87uj.js";import{C as ct}from"./CheckCircle-B5gS3fbx.js";import{T as ss}from"./Today-DiPGM8XN.js";import{F as as,C as ns}from"./FilterList-CoQMGMK3.js";import{I as ls}from"./InputAdornment-BrN3aL1-.js";import{S as rs}from"./Search-CErNxQ4Y.js";import{T as is,a as q}from"./ToggleButtonGroup-BQKEPP--.js";import{C as b}from"./Chip-CSuofl6d.js";import{T as cs,a as os,b as ds,c as ot,d as o,e as us}from"./TableRow-B78mTfEk.js";import{T as H}from"./TableSortLabel-zmUvbVTn.js";import{L as hs}from"./Lock-DCccL4KJ.js";import{E as ms}from"./Edit-v4qS8plG.js";import{P as xs}from"./Payment-CMfD5Vf4.js";import{C as ps}from"./Cancel-zFl1_j2m.js";import{D as de,a as ue,b as he,c as me}from"./DialogTitle-DKxRfOzX.js";import{S as js}from"./Snackbar-BmHWVIFe.js";import"./Receipt-BNM73xOv.js";import"./Business-D15Uf3Sq.js";import"./FormControlLabel-Ddfix5uo.js";import"./Checkbox-1RYp8RQ2.js";import"./VisibilityOff-JntHt1L2.js";import"./Visibility-DUc7LFax.js";import"./Autocomplete-CZ6UKh6h.js";import"./PersonAdd-C6oEVzXr.js";import"./format-DjXxzLAN.js";import"./validation-C2QFlzQX.js";import"./Stack-DcjgMJBo.js";import"./Stepper-DWx8UZeC.js";import"./ArrowBack-DoSpaJPE.js";import"./Check-D73JkDWp.js";const _s=Ut(e.jsx("path",{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"ExitToApp"),ta=()=>{var Qe,Je,Xe,Ye,Ze,et;const{hasRole:xe,hasPermission:dt}=$t(),{format:A}=Yt(),Pe=xe("admin")||xe("receptionist")||xe("manager")||dt("bookings:update"),[y,ut]=l.useState([]),[U,ht]=l.useState([]),[Q,mt]=l.useState([]),[pe,je]=l.useState(null),[xt,_e]=l.useState(!1),[pt,J]=l.useState(null),[jt,X]=l.useState(null),[_t,Y]=l.useState(!1),[ft,We]=l.useState(!0),[Re,S]=l.useState(null),[_,Ne]=l.useState("check_in_date"),[C,fe]=l.useState("desc"),[L,ye]=l.useState(""),[M,ge]=l.useState("all"),[w,Ce]=l.useState("all"),[Z,Me]=l.useState(""),[ee,Oe]=l.useState(""),[yt,Fe]=l.useState(!1),[gt,te]=l.useState(!1),[p,Ct]=l.useState(null),[h,v]=l.useState({}),[ze,Ae]=l.useState(!1),[vt,se]=l.useState(!1),[u,Le]=l.useState(null),[Ee,ve]=l.useState(""),[Be,Ge]=l.useState(!1),[kt,ae]=l.useState(!1),[i,He]=l.useState(null),[ke,be]=l.useState(""),[R,Se]=l.useState(""),[O,we]=l.useState(""),[De,Ue]=l.useState(!1),[bt,ne]=l.useState(!1),[f,le]=l.useState(null),[F,$]=l.useState(""),[$e,K]=l.useState(""),[Ke,Ve]=l.useState(!1),[St,D]=l.useState(!1),[wt,z]=l.useState("");l.useEffect(()=>{k()},[]);const k=async()=>{try{We(!0);const[t,a,s]=await Promise.all([W.getBookingsWithDetails(),W.getAllRooms(),W.getAllGuests()]);ut(t),ht(a),mt(s),S(null)}catch(t){console.error("Failed to load bookings data:",t),S(t.message||"Failed to load bookings data. Please check your connection and try again.")}finally{We(!1)}},re=l.useMemo(()=>{let t=[...y];if(L){const s=L.toLowerCase();t=t.filter(r=>{var m,I;return r.guest_name.toLowerCase().includes(s)||r.room_number.toLowerCase().includes(s)||((m=r.booking_number)==null?void 0:m.toLowerCase().includes(s))||((I=r.folio_number)==null?void 0:I.toLowerCase().includes(s))||r.id.toLowerCase().includes(s)})}M==="cancelled"?t=t.filter(s=>s.status==="cancelled"):M!=="all"?t=t.filter(s=>s.status===M):t=t.filter(s=>s.status!=="cancelled");const a=new Date;if(a.setHours(0,0,0,0),w==="today")t=t.filter(s=>{const r=new Date(s.check_in_date);return r.setHours(0,0,0,0),r.getTime()===a.getTime()});else if(w==="week"){const s=new Date(a);s.setDate(s.getDate()+7),t=t.filter(r=>{const m=new Date(r.check_in_date);return m>=a&&m<=s})}else if(w==="month"){const s=new Date(a);s.setMonth(s.getMonth()+1),t=t.filter(r=>{const m=new Date(r.check_in_date);return m>=a&&m<=s})}else if(w==="custom"&&Z&&ee){const s=new Date(Z),r=new Date(ee);t=t.filter(m=>{const I=new Date(m.check_in_date);return I>=s&&I<=r})}return t.sort((s,r)=>{const m=s.status==="cancelled",I=r.status==="cancelled";if(m!==I)return m?1:-1;let T,P;switch(_){case"check_in_date":T=new Date(s.check_in_date).getTime(),P=new Date(r.check_in_date).getTime();break;case"check_out_date":T=new Date(s.check_out_date).getTime(),P=new Date(r.check_out_date).getTime();break;case"guest_name":T=s.guest_name.toLowerCase(),P=r.guest_name.toLowerCase();break;case"room_number":T=s.room_number.toLowerCase(),P=r.room_number.toLowerCase();break;case"status":T=s.status.toLowerCase(),P=r.status.toLowerCase();break;case"folio_number":T=(s.booking_number||s.folio_number||"").toLowerCase(),P=(r.booking_number||r.folio_number||"").toLowerCase();break;default:T=s.check_in_date,P=r.check_in_date}return T<P?C==="asc"?-1:1:T>P?C==="asc"?1:-1:0}),t},[y,L,M,w,Z,ee,_,C]),E=t=>{_===t?fe(C==="asc"?"desc":"asc"):(Ne(t),fe("asc"))},Dt=()=>{ye(""),ge("all"),Ce("all"),Me(""),Oe(""),Ne("check_in_date"),fe("desc")},It=t=>{Ct(t),v({status:t.status,payment_status:t.payment_status||"unpaid",payment_method:t.payment_method||"",source:t.source||"walk_in",check_in_date:t.check_in_date.split("T")[0],check_out_date:t.check_out_date.split("T")[0],post_type:t.post_type||"normal_stay",rate_code:t.rate_code||"RACK",deposit_paid:t.deposit_paid||!1,remarks:t.remarks||""}),te(!0)},Tt=async()=>{if(p)try{Ae(!0),await W.updateBooking(p.id,h),z("Booking updated successfully!"),D(!0),te(!1),await k()}catch(t){S(t.message||"Failed to update booking")}finally{Ae(!1)}},Pt=t=>{Le(t),ve(""),se(!0)},Wt=async()=>{if(u)try{Ge(!0),await W.cancelBooking({booking_id:u.id,reason:Ee||"Cancelled by admin"}),z("Booking cancelled successfully!"),D(!0),se(!1),Le(null),ve(""),await k()}catch(t){S(t.message||"Failed to cancel booking")}finally{Ge(!1)}},Rt=t=>{He(t),be("");const a=t.check_in_date.split("T")[0],s=t.check_out_date.split("T")[0];Se(a),we(s),ae(!0)},Ie=()=>{if(!i)return 0;const t=new Date(i.check_in_date),a=new Date(i.check_out_date);return Math.ceil((a.getTime()-t.getTime())/(1e3*60*60*24))},ie=()=>{if(!R||!O)return 0;const t=new Date(R),a=new Date(O);return Math.ceil((a.getTime()-t.getTime())/(1e3*60*60*24))},qe=()=>Ie()-ie(),Nt=()=>{if(!i)return"0.00";const t=Ie();if(t===0)return"0.00";const a=qe(),s=Number(i.total_amount)/t;return(a*s).toFixed(2)},Mt=async()=>{if(!(!i||!R||!O))try{Ue(!0);const t=await W.markBookingComplimentary(i.id,ke||"Marked as complimentary",R,O),a=t.status==="fully_complimentary"?"fully complimentary":"partially complimentary";z(`Booking marked as ${a}! ${t.complimentary_nights} of ${t.total_nights} nights are complimentary. New total: ${A(Number(t.new_total))}`),D(!0),ae(!1),He(null),be(""),Se(""),we(""),await k()}catch(t){S(t.message||"Failed to mark booking as complimentary")}finally{Ue(!1)}},Ot=t=>{le(t),$(t.payment_status||"unpaid"),K(""),ne(!0)},Ft=async()=>{if(!(!f||!F))try{Ve(!0);const t=rt().room_card_deposit;await W.updateBooking(f.id,{payment_status:F,payment_note:$e.trim()||void 0,deposit_paid:F==="paid",deposit_amount:F==="paid"?t:void 0}),z(`Deposit collected. Status updated to "${Te(F)}"`),D(!0),ne(!1),le(null),$(""),K(""),await k()}catch(t){S(t.message||"Failed to collect deposit")}finally{Ve(!1)}},zt=async t=>{try{const a=y.find(m=>m.id===t);if(!a){S("Booking not found");return}const s=await W.getGuest(a.guest_id),r={...a,room_type:a.room_type||""};J(r),X(s),Y(!0)}catch(a){S(a.message||"Failed to load check-in data")}},At=t=>{je(t),_e(!0)},Lt=async()=>{if(pe)try{await W.updateBooking(pe.id,{status:"checked_out"}),z("Guest checked out successfully!"),D(!0),_e(!1),je(null),await k()}catch(t){throw t}},Et=t=>{const a=t.status,s=new Date;s.setHours(0,0,0,0);const r=new Date(t.check_in_date);return r.setHours(0,0,0,0),(a==="confirmed"||a==="pending")&&s>=r},Bt=t=>t.status==="checked_in",Gt=t=>{const a=t.status;return a==="confirmed"||a==="pending"},Ht=t=>{const a=t.status;return(a==="confirmed"||a==="pending")&&!t.is_complimentary},ce=l.useMemo(()=>{const t=y.filter(r=>r.status==="confirmed"||r.status==="pending").length,a=y.filter(r=>r.status==="checked_in").length,s=y.filter(r=>{const m=new Date(r.check_in_date),I=new Date;return m.toDateString()===I.toDateString()}).length;return{total:y.length,confirmed:t,checkedIn:a,todayCheckIns:s,availableRooms:U.filter(r=>r.available).length,totalGuests:Q.length}},[y,U,Q]);return ft?e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(Kt,{})}):e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(c,{variant:"h4",component:"h1",children:"Booking Management"}),e.jsxs(x,{display:"flex",gap:2,children:[e.jsx(g,{variant:"outlined",startIcon:e.jsx(Vt,{}),onClick:k,children:"Refresh"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(it,{}),onClick:()=>Fe(!0),disabled:U.length===0||Q.length===0,children:"New Booking"})]})]}),Re&&e.jsx(B,{severity:"error",sx:{mb:3},action:e.jsx(g,{color:"inherit",size:"small",onClick:k,children:"Retry"}),children:Re}),e.jsxs(d,{container:!0,spacing:2,mb:3,children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(V,{children:e.jsxs(oe,{children:[e.jsxs(x,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(it,{color:"primary",sx:{mr:1}}),e.jsx(c,{variant:"h6",children:"Total Bookings"})]}),e.jsx(c,{variant:"h4",color:"primary",children:ce.total})]})})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(V,{children:e.jsxs(oe,{children:[e.jsxs(x,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ct,{color:"success",sx:{mr:1}}),e.jsx(c,{variant:"h6",children:"Checked In"})]}),e.jsx(c,{variant:"h4",color:"success.main",children:ce.checkedIn})]})})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(V,{children:e.jsxs(oe,{children:[e.jsxs(x,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(ss,{color:"warning",sx:{mr:1}}),e.jsx(c,{variant:"h6",children:"Today Check-ins"})]}),e.jsx(c,{variant:"h4",color:"warning.main",children:ce.todayCheckIns})]})})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(V,{children:e.jsxs(oe,{children:[e.jsxs(x,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(qt,{color:"info",sx:{mr:1}}),e.jsx(c,{variant:"h6",children:"Available Rooms"})]}),e.jsx(c,{variant:"h4",color:"info.main",children:ce.availableRooms})]})})})]}),e.jsxs(V,{sx:{mb:3,p:2},children:[e.jsxs(x,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(as,{color:"action"}),e.jsx(c,{variant:"h6",children:"Filters & Search"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(j,{fullWidth:!0,size:"small",placeholder:"Search by guest, room, folio...",value:L,onChange:t=>ye(t.target.value),InputProps:{startAdornment:e.jsx(ls,{position:"start",children:e.jsx(rs,{})})}})}),e.jsx(d,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(tt,{fullWidth:!0,size:"small",children:[e.jsx(st,{children:"Status"}),e.jsxs(at,{value:M,label:"Status",onChange:t=>ge(t.target.value),children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"confirmed",children:"Confirmed"}),e.jsx(n,{value:"checked_in",children:"Checked In"}),e.jsx(n,{value:"checked_out",children:"Checked Out"}),e.jsx(n,{value:"cancelled",children:"Cancelled"}),e.jsx(n,{value:"no_show",children:"No Show"}),e.jsx(n,{value:"comp_cancelled",children:"Comp Cancelled"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(is,{value:w,exclusive:!0,onChange:(t,a)=>a&&Ce(a),size:"small",fullWidth:!0,children:[e.jsx(q,{value:"all",children:"All"}),e.jsx(q,{value:"today",children:"Today"}),e.jsx(q,{value:"week",children:"Week"}),e.jsx(q,{value:"month",children:"Month"}),e.jsx(q,{value:"custom",children:"Custom"})]})}),e.jsx(d,{item:!0,xs:12,md:2,children:e.jsx(g,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(ns,{}),onClick:Dt,size:"small",children:"Clear Filters"})}),w==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(j,{fullWidth:!0,size:"small",label:"Start Date",type:"date",value:Z,onChange:t=>Me(t.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(j,{fullWidth:!0,size:"small",label:"End Date",type:"date",value:ee,onChange:t=>Oe(t.target.value),InputLabelProps:{shrink:!0}})})]})]}),e.jsxs(x,{mt:2,display:"flex",gap:1,flexWrap:"wrap",children:[L&&e.jsx(b,{size:"small",label:`Search: ${L}`,onDelete:()=>ye("")}),M!=="all"&&e.jsx(b,{size:"small",label:`Status: ${M}`,onDelete:()=>ge("all")}),w!=="all"&&e.jsx(b,{size:"small",label:`Date: ${w}`,onDelete:()=>Ce("all")}),re.length!==y.length&&e.jsxs(c,{variant:"body2",color:"text.secondary",sx:{ml:"auto",alignSelf:"center"},children:["Showing ",re.length," of ",y.length," bookings"]})]})]}),e.jsx(cs,{component:Qt,children:e.jsxs(os,{children:[e.jsx(ds,{children:e.jsxs(ot,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(o,{children:e.jsx(H,{active:_==="folio_number",direction:_==="folio_number"?C:"asc",onClick:()=>E("folio_number"),children:e.jsx("strong",{children:"Booking #"})})}),e.jsx(o,{children:e.jsx(H,{active:_==="guest_name",direction:_==="guest_name"?C:"asc",onClick:()=>E("guest_name"),children:e.jsx("strong",{children:"Guest Name"})})}),e.jsx(o,{children:e.jsx(H,{active:_==="room_number",direction:_==="room_number"?C:"asc",onClick:()=>E("room_number"),children:e.jsx("strong",{children:"Room"})})}),e.jsx(o,{children:e.jsx(H,{active:_==="check_in_date",direction:_==="check_in_date"?C:"asc",onClick:()=>E("check_in_date"),children:e.jsx("strong",{children:"Check-in"})})}),e.jsx(o,{children:e.jsx(H,{active:_==="check_out_date",direction:_==="check_out_date"?C:"asc",onClick:()=>E("check_out_date"),children:e.jsx("strong",{children:"Check-out"})})}),e.jsx(o,{children:e.jsx("strong",{children:"Post Type"})}),e.jsx(o,{children:e.jsx("strong",{children:"Rate"})}),e.jsx(o,{children:e.jsx("strong",{children:"Complimentary"})}),e.jsx(o,{children:e.jsx("strong",{children:"Channel"})}),e.jsx(o,{children:e.jsx("strong",{children:"Payment Method"})}),e.jsx(o,{children:e.jsx("strong",{children:"Payment Status"})}),e.jsx(o,{children:e.jsx("strong",{children:"Notes"})}),e.jsx(o,{children:e.jsx(H,{active:_==="status",direction:_==="status"?C:"asc",onClick:()=>E("status"),children:e.jsx("strong",{children:"Status"})})}),Pe&&e.jsx(o,{children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(us,{children:re.map(t=>{var a,s;return e.jsxs(ot,{hover:!0,sx:{opacity:t.status==="cancelled"?.6:1,bgcolor:t.status==="cancelled"?"action.hover":"inherit",textDecoration:t.status==="cancelled"?"line-through":"none","& td":{textDecoration:t.status==="cancelled"?"line-through":"none"}},children:[e.jsx(o,{children:t.booking_number||t.folio_number||"-"}),e.jsx(o,{children:t.guest_name}),e.jsx(o,{children:e.jsxs(x,{children:[e.jsx(c,{variant:"body2",children:t.room_type}),e.jsxs(c,{variant:"caption",color:"text.secondary",children:["Room ",t.room_number]})]})}),e.jsx(o,{children:t.formatted_check_in||t.check_in_date.split("T")[0]}),e.jsx(o,{children:t.formatted_check_out||t.check_out_date.split("T")[0]}),e.jsx(o,{children:t.post_type==="same_day"?e.jsx(b,{label:"Same Day",size:"small",color:"warning"}):e.jsx(b,{label:"Normal Stay",size:"small",color:"default"})}),e.jsx(o,{children:t.rate_code||"RACK"}),e.jsx(o,{children:t.is_complimentary?e.jsx(N,{title:e.jsxs(x,{children:[e.jsxs(c,{variant:"caption",display:"block",children:[e.jsx("strong",{children:"Reason:"})," ",t.complimentary_reason||"N/A"]}),t.complimentary_start_date&&t.complimentary_end_date&&e.jsxs(c,{variant:"caption",display:"block",children:[e.jsx("strong",{children:"Dates:"})," ",t.complimentary_start_date.split("T")[0]," to ",t.complimentary_end_date.split("T")[0]]}),t.original_total_amount&&e.jsxs(c,{variant:"caption",display:"block",children:[e.jsx("strong",{children:"Original:"})," ",A(Number(t.original_total_amount))]})]}),children:e.jsx(b,{icon:e.jsx(nt,{}),label:`${t.complimentary_nights||0} nights`,color:"secondary",size:"small"})}):e.jsx(c,{variant:"caption",color:"text.secondary",children:"-"})}),e.jsx(o,{children:e.jsx(c,{variant:"body2",sx:{textTransform:"capitalize"},children:((a=t.source)==null?void 0:a.replace(/_/g," "))||"-"})}),e.jsx(o,{children:e.jsx(c,{variant:"body2",sx:{textTransform:"capitalize"},children:((s=t.payment_method)==null?void 0:s.replace(/_/g," "))||"-"})}),e.jsx(o,{children:e.jsx(b,{label:Te(t.payment_status),color:lt(t.payment_status),size:"small",variant:"outlined"})}),e.jsx(o,{children:e.jsx(c,{variant:"body2",sx:{maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.remarks||"-"})}),e.jsx(o,{children:e.jsxs(x,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[e.jsx(b,{label:Xt(t.status),color:Jt(t.status),size:"small"}),t.is_posted&&e.jsx(N,{title:"Booking is locked - included in night audit",children:e.jsx(b,{icon:e.jsx(hs,{sx:{fontSize:14}}),label:t.posted_date?new Date(t.posted_date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"Posted",size:"small",color:"default",sx:{bgcolor:"grey.200",fontWeight:500}})})]})}),Pe&&e.jsx(o,{children:e.jsxs(x,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[Et(t)&&e.jsx(N,{title:"Check In",children:e.jsx(G,{size:"small",onClick:()=>zt(t.id),color:"success",children:e.jsx(ct,{})})}),Bt(t)&&e.jsx(N,{title:"Check Out",children:e.jsx(G,{size:"small",onClick:()=>At(t),color:"warning",children:e.jsx(_s,{})})}),e.jsx(N,{title:t.is_posted?"Cannot edit - Booking is posted":"Edit Booking",children:e.jsx("span",{children:e.jsx(G,{size:"small",onClick:()=>It(t),color:"primary",disabled:t.is_posted,children:e.jsx(ms,{})})})}),!t.is_complimentary&&e.jsx(N,{title:"Collect Room Payment",children:e.jsx(G,{size:"small",onClick:()=>Ot(t),color:"info",children:e.jsx(xs,{})})}),Gt(t)&&!t.is_posted&&e.jsx(N,{title:"Cancel Booking",children:e.jsx(G,{size:"small",onClick:()=>Pt(t),color:"error",children:e.jsx(ps,{})})}),Ht(t)&&!t.is_posted&&e.jsx(N,{title:"Mark as Complimentary",children:e.jsx(G,{size:"small",onClick:()=>Rt(t),color:"secondary",children:e.jsx(nt,{})})})]})})]},t.id)})})]})}),re.length===0&&e.jsxs(x,{textAlign:"center",py:4,children:[e.jsx(c,{variant:"h6",color:"text.secondary",children:y.length===0?"No bookings yet":"No bookings match your filters"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:1},children:y.length===0?'Create your first booking using the "New Booking" button above':"Try adjusting your search or filter criteria"})]}),e.jsx(es,{open:yt,onClose:()=>Fe(!1),room:null,rooms:U,guests:Q,onSuccess:t=>{z(t),D(!0)},onError:t=>{S(t)},onRefreshData:k,onBookingCreated:(t,a)=>{const s=U.find(m=>m.id===t.room_id),r={id:t.id,booking_number:t.folio_number||"",folio_number:t.folio_number,guest_id:String(a.id),guest_name:a.full_name,guest_email:a.email||"",guest_type:a.guest_type,room_id:t.room_id,room_number:(s==null?void 0:s.room_number)||"",room_type:(s==null?void 0:s.room_type)||t.room_type||"",room_type_code:"",check_in_date:t.check_in_date,check_out_date:t.check_out_date,price_per_night:(s==null?void 0:s.price_per_night)||0,total_amount:t.total_amount,status:t.status,payment_status:"unpaid",payment_method:t.payment_method,source:"walk_in",remarks:"",is_complimentary:!1,deposit_paid:!1,deposit_amount:0,room_card_deposit:0,created_at:t.created_at,is_posted:!1};J(r),X(a),Y(!0)}}),e.jsxs(de,{open:gt,onClose:()=>te(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(ue,{children:["Edit Booking #",(p==null?void 0:p.folio_number)||(p==null?void 0:p.id.toString().substring(0,8))]}),e.jsx(he,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Check-In Date",type:"date",value:h.check_in_date||"",onChange:t=>v({...h,check_in_date:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Check-Out Date",type:"date",value:h.check_out_date||"",onChange:t=>v({...h,check_out_date:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(j,{select:!0,fullWidth:!0,label:"Status",value:h.status||"pending",onChange:t=>v({...h,status:t.target.value}),children:[e.jsx(n,{value:"pending",children:"Pending"}),e.jsx(n,{value:"confirmed",children:"Confirmed"}),e.jsx(n,{value:"checked_in",children:"Checked In"}),e.jsx(n,{value:"auto_checked_in",children:"Auto Checked In"}),e.jsx(n,{value:"checked_out",children:"Checked Out"}),e.jsx(n,{value:"late_checkout",children:"Late Checkout"}),e.jsx(n,{value:"cancelled",children:"Cancelled"}),e.jsx(n,{value:"no_show",children:"No Show"}),e.jsx(n,{value:"comp_cancelled",children:"Comp Cancelled"})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(j,{select:!0,fullWidth:!0,label:"Post Type",value:h.post_type||"normal_stay",onChange:t=>v({...h,post_type:t.target.value}),children:[e.jsx(n,{value:"normal_stay",children:"Normal Stay"}),e.jsx(n,{value:"same_day",children:"Same Day"})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(j,{select:!0,fullWidth:!0,label:"Channel",value:h.source||"walk_in",onChange:t=>v({...h,source:t.target.value}),children:[e.jsx(n,{value:"walk_in",children:"Walk-in"}),e.jsx(n,{value:"phone",children:"Phone Reservation"}),e.jsx(n,{value:"direct",children:"Direct Booking"}),e.jsx(n,{value:"online",children:"Online (OTA)"}),e.jsx(n,{value:"website",children:"Website"}),e.jsx(n,{value:"mobile",children:"Mobile App"}),e.jsx(n,{value:"agent",children:"Travel Agent"}),e.jsx(n,{value:"corporate",children:"Corporate"})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(j,{select:!0,fullWidth:!0,label:"Payment Method",value:h.payment_method||"",onChange:t=>v({...h,payment_method:t.target.value}),children:[e.jsx(n,{value:"",children:"Not Specified"}),e.jsx(n,{value:"cash",children:"Cash"}),e.jsx(n,{value:"credit_card",children:"Credit Card"}),e.jsx(n,{value:"debit_card",children:"Debit Card"}),e.jsx(n,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(n,{value:"company_billing",children:"Company Billing"}),e.jsx(n,{value:"online_payment",children:"Online Payment"}),e.jsx(n,{value:"ewallet",children:"E-Wallet"})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(j,{select:!0,fullWidth:!0,label:"Payment Status",value:h.payment_status||"unpaid",onChange:t=>v({...h,payment_status:t.target.value}),children:[e.jsx(n,{value:"unpaid",children:"Unpaid"}),e.jsx(n,{value:"unpaid_deposit",children:"Unpaid Deposit"}),e.jsx(n,{value:"paid_rate",children:"Paid Rate"}),e.jsx(n,{value:"partial",children:"Partial"}),e.jsx(n,{value:"paid",children:"Paid"}),e.jsx(n,{value:"refunded",children:"Refunded"}),e.jsx(n,{value:"cancelled",children:"Cancelled"})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Rate Code",value:h.rate_code||"RACK",onChange:t=>v({...h,rate_code:t.target.value})})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Notes / Remarks",multiline:!0,rows:3,value:h.remarks||"",onChange:t=>v({...h,remarks:t.target.value}),placeholder:"Enter any notes or remarks for this booking..."})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(B,{severity:"info",children:["Guest: ",e.jsx("strong",{children:p==null?void 0:p.guest_name}),e.jsx("br",{}),"Room: ",e.jsxs("strong",{children:[p==null?void 0:p.room_type," - Room ",p==null?void 0:p.room_number]})]})})]})}),e.jsxs(me,{children:[e.jsx(g,{onClick:()=>te(!1),children:"Cancel"}),e.jsx(g,{onClick:Tt,variant:"contained",disabled:ze,children:ze?"Updating...":"Update Booking"})]})]}),e.jsxs(de,{open:vt,onClose:()=>se(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Cancel Booking"}),e.jsxs(he,{children:[e.jsx(B,{severity:"warning",sx:{mb:2},children:"Are you sure you want to cancel this booking?"}),e.jsxs(x,{sx:{mb:2},children:[e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Guest:"})," ",u==null?void 0:u.guest_name]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Room:"})," ",u==null?void 0:u.room_type," - Room ",u==null?void 0:u.room_number]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Check-in:"})," ",(u==null?void 0:u.formatted_check_in)||(u==null?void 0:u.check_in_date)]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Check-out:"})," ",(u==null?void 0:u.formatted_check_out)||(u==null?void 0:u.check_out_date)]})]}),e.jsx(j,{fullWidth:!0,multiline:!0,rows:3,label:"Cancellation Reason (Optional)",value:Ee,onChange:t=>ve(t.target.value),placeholder:"Enter reason for cancellation..."})]}),e.jsxs(me,{children:[e.jsx(g,{onClick:()=>se(!1),children:"Keep Booking"}),e.jsx(g,{onClick:Wt,variant:"contained",color:"error",disabled:Be,children:Be?"Cancelling...":"Cancel Booking"})]})]}),e.jsxs(de,{open:kt,onClose:()=>ae(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Mark Booking as Complimentary"}),e.jsxs(he,{children:[e.jsx(B,{severity:"info",sx:{mb:2},children:"Specify the date range for complimentary nights. The guest will not be charged for these dates."}),e.jsxs(x,{sx:{mb:2},children:[e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Guest:"})," ",i==null?void 0:i.guest_name]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Room:"})," ",i==null?void 0:i.room_type," - Room ",i==null?void 0:i.room_number]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Booking Period:"})," ",(Qe=i==null?void 0:i.check_in_date)==null?void 0:Qe.split("T")[0]," to ",(Je=i==null?void 0:i.check_out_date)==null?void 0:Je.split("T")[0]]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Original Total:"})," ",A(Number((i==null?void 0:i.total_amount)||0))]})]}),e.jsxs(d,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,label:"Complimentary Start Date",type:"date",value:R,onChange:t=>Se(t.target.value),InputLabelProps:{shrink:!0},inputProps:{min:(Xe=i==null?void 0:i.check_in_date)==null?void 0:Xe.split("T")[0],max:(Ye=i==null?void 0:i.check_out_date)==null?void 0:Ye.split("T")[0]}})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,label:"Complimentary End Date",type:"date",value:O,onChange:t=>we(t.target.value),InputLabelProps:{shrink:!0},inputProps:{min:R||((Ze=i==null?void 0:i.check_in_date)==null?void 0:Ze.split("T")[0]),max:(et=i==null?void 0:i.check_out_date)==null?void 0:et.split("T")[0]}})})]}),R&&O&&i&&ie()>0&&e.jsx(B,{severity:"success",sx:{mb:2},children:e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Preview:"})," ",ie()," of ",Ie()," nights will be complimentary.",qe()>0?e.jsxs(e.Fragment,{children:[" New total will be approximately ",A(Number(Nt())),"."]}):e.jsx(e.Fragment,{children:" This will be fully complimentary (no charge)."})]})}),e.jsx(j,{fullWidth:!0,multiline:!0,rows:3,label:"Reason for Complimentary Stay",value:ke,onChange:t=>be(t.target.value),placeholder:"e.g., VIP guest, service recovery, management approval...",required:!0})]}),e.jsxs(me,{children:[e.jsx(g,{onClick:()=>ae(!1),disabled:De,children:"Cancel"}),e.jsx(g,{onClick:Mt,variant:"contained",color:"primary",disabled:!ke.trim()||!R||!O||ie()<=0||De,children:De?"Processing...":"Mark as Complimentary"})]})]}),e.jsxs(de,{open:bt,onClose:()=>{ne(!1),le(null),$(""),K("")},maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Collect Deposit"}),e.jsx(he,{children:f&&e.jsxs(x,{sx:{mt:1},children:[e.jsxs(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Booking: ",f.booking_number||f.folio_number||`#${f.id}`]}),e.jsxs(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Guest: ",f.guest_name]}),e.jsxs(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Room: ",f.room_number]}),e.jsxs(c,{variant:"body2",color:"text.secondary",sx:{fontWeight:"bold"},gutterBottom:!0,children:["Room Card Deposit: ",A(rt().room_card_deposit)]}),f.deposit_amount&&Number(f.deposit_amount)>0&&e.jsxs(c,{variant:"body2",color:"success.main",gutterBottom:!0,children:["Deposit Already Paid: ",A(Number(f.deposit_amount))]}),e.jsxs(x,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{variant:"body2",color:"text.secondary",children:"Current Status:"}),e.jsx(b,{label:Te(f.payment_status),color:lt(f.payment_status),size:"small"})]}),e.jsxs(tt,{fullWidth:!0,sx:{mb:2},children:[e.jsx(st,{children:"Payment Status"}),e.jsxs(at,{value:F,label:"Payment Status",onChange:t=>$(t.target.value),children:[e.jsx(n,{value:"unpaid",children:"Unpaid"}),e.jsx(n,{value:"partial",children:"Partial Payment"}),e.jsx(n,{value:"paid",children:"Fully Paid"}),e.jsx(n,{value:"refunded",children:"Refunded"})]})]}),e.jsx(j,{fullWidth:!0,multiline:!0,rows:3,label:"Payment Note (Optional)",value:$e,onChange:t=>K(t.target.value),placeholder:"e.g., Paid via cash/card, Receipt #12345, Remaining balance RM100...",helperText:"Add a note about this payment"})]})}),e.jsxs(me,{children:[e.jsx(g,{onClick:()=>{ne(!1),le(null),$(""),K("")},children:"Cancel"}),e.jsx(g,{onClick:Ft,variant:"contained",color:"primary",disabled:!F||Ke,children:Ke?"Processing...":"Collect Deposit"})]})]}),e.jsx(js,{open:St,autoHideDuration:4e3,onClose:()=>D(!1),children:e.jsx(B,{onClose:()=>D(!1),severity:"success",children:wt})}),e.jsx(Zt,{open:xt,onClose:()=>{_e(!1),je(null)},booking:pe,onConfirmCheckout:Lt}),e.jsx(ts,{open:_t,onClose:()=>{Y(!1),J(null),X(null)},booking:pt,guest:jt,onCheckInSuccess:()=>{Y(!1),J(null),X(null),z("Guest checked in successfully!"),D(!0),k()}})]})};export{ta as default};
