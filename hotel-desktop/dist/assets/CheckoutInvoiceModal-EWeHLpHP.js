import{l as de,j as e,r as x,B as i,T as t,A as d,p as C,n as J,D as w,o as h,C as xe}from"./index-DnWmqzJF.js";import{u as he}from"./useCurrency-C4JSCWBJ.js";import{g as K}from"./currency-SgYezy9c.js";import{D as me,a as ue,b as pe,c as je}from"./DialogTitle-DKxRfOzX.js";import{R as ye,P as fe}from"./Receipt-BNM73xOv.js";import{C as ve}from"./Chip-CSuofl6d.js";import{B as D}from"./Business-D15Uf3Sq.js";import{G as r}from"./Grid-0tqG7FTE.js";import{I as ge}from"./InputAdornment-BrN3aL1-.js";import{C as R}from"./CheckCircle-B5gS3fbx.js";const N=de([e.jsx("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),e.jsx("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber"),Ae=({open:T,onClose:f,booking:s,onConfirmCheckout:Q})=>{const{format:a,symbol:X}=he(),[b,P]=x.useState(!1),[A,W]=x.useState(null),[m,p]=x.useState("preview"),[c,S]=x.useState(K()),[u,Z]=x.useState(!1),[v,B]=x.useState(0),[L,I]=x.useState(""),[n,ee]=x.useState({roomCharges:0,roomCardDeposit:50,serviceTax:0,tourismTax:0,extraBedCharge:0,lateCheckoutPenalty:0,subtotal:0,depositRefund:0,grandTotal:0}),te=()=>{if(!s)return!1;const o=new Date,l=o.toISOString().split("T")[0];if((typeof s.check_out_date=="string"?s.check_out_date.split("T")[0]:new Date(s.check_out_date).toISOString().split("T")[0])!==l)return!1;const[g,y]=c.check_out_time.split(":").map(Number),_=new Date;return _.setHours(g,y,0,0),o>_};x.useEffect(()=>{if(T&&s){const o=K();S(o);const l=te();Z(l),B(0),I(""),F(0),p("preview")}},[T,s]),x.useEffect(()=>{const o=l=>{S(l.detail)};return window.addEventListener("hotelSettingsChange",o),()=>{window.removeEventListener("hotelSettingsChange",o)}},[]);const F=(o=v)=>{if(!s)return;const l=new Date(s.check_in_date),E=new Date(s.check_out_date),g=Math.ceil((E.getTime()-l.getTime())/(1e3*60*60*24));let y=typeof s.price_per_night=="string"?parseFloat(s.price_per_night):s.price_per_night||0;const _=1+c.service_tax_rate/100;if(!y||y===0){const le=typeof s.total_amount=="string"?parseFloat(s.total_amount):s.total_amount||0;y=g>0?le/1.1/g:0}const M=y*g,k=M/_,G=M-k,O=k,H=s.room_card_deposit!==void 0&&s.room_card_deposit!==null?typeof s.room_card_deposit=="string"?parseFloat(s.room_card_deposit):s.room_card_deposit:c.room_card_deposit,$=s.tourism_tax_amount?typeof s.tourism_tax_amount=="string"?parseFloat(s.tourism_tax_amount):s.tourism_tax_amount:0,q=s.extra_bed_charge?typeof s.extra_bed_charge=="string"?parseFloat(s.extra_bed_charge):s.extra_bed_charge:0,U=o,V=O+G+$+q+U,Y=H,ce=V-Y;ee({roomCharges:O,roomCardDeposit:H,serviceTax:G,tourismTax:$,extraBedCharge:q,lateCheckoutPenalty:U,subtotal:V,depositRefund:Y,grandTotal:ce})},se=o=>{B(o),F(o)},re=async()=>{try{P(!0),W(null);const o=u&&v>0?{penalty:v,notes:L}:void 0;await Q(o),f()}catch(o){W(o.message||"Failed to process checkout")}finally{P(!1)}},ne=()=>{p(u?"lateCheckout":"confirm")},ie=()=>{p("confirm")},z=()=>{p("preview")},ae=()=>{p("lateCheckout")},oe=()=>{const o=document.getElementById("printable-invoice");if(!o)return;const l=window.open("","_blank");l&&(l.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Invoice - ${(s==null?void 0:s.folio_number)||`#${s==null?void 0:s.id}`}</title>
          <style>
            * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
            }
            body {
              font-family: Arial, sans-serif;
              padding: 20px;
              color: #333;
            }
            .invoice-header {
              text-align: center;
              margin-bottom: 30px;
              border-bottom: 2px solid #1976d2;
              padding-bottom: 20px;
            }
            .invoice-header h1 {
              color: #1976d2;
              font-size: 28px;
              margin-bottom: 5px;
            }
            .invoice-header p {
              color: #666;
              font-size: 14px;
            }
            .invoice-meta {
              display: flex;
              justify-content: space-between;
              margin-bottom: 30px;
            }
            .invoice-meta div {
              flex: 1;
            }
            .invoice-meta h3 {
              font-size: 14px;
              color: #1976d2;
              margin-bottom: 10px;
              text-transform: uppercase;
            }
            .invoice-meta p {
              font-size: 13px;
              margin: 5px 0;
              line-height: 1.6;
            }
            .invoice-meta .label {
              color: #666;
              display: inline-block;
              min-width: 120px;
            }
            .invoice-meta .value {
              font-weight: 600;
              color: #333;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin: 20px 0;
            }
            th {
              background-color: #1976d2;
              color: white;
              padding: 12px;
              text-align: left;
              font-size: 13px;
              text-transform: uppercase;
            }
            td {
              padding: 12px;
              border-bottom: 1px solid #ddd;
              font-size: 13px;
            }
            .amount {
              text-align: right;
              font-weight: 600;
            }
            .subtotal-row td {
              border-top: 2px solid #ddd;
              font-weight: 600;
              padding-top: 15px;
            }
            .refund-row td {
              color: #2e7d32;
            }
            .penalty-row td {
              color: #d32f2f;
            }
            .total-row {
              background-color: #f5f5f5;
            }
            .total-row td {
              border-top: 3px double #1976d2;
              font-size: 16px;
              font-weight: 700;
              padding: 15px 12px;
              color: #1976d2;
            }
            .notes {
              margin-top: 30px;
              padding: 15px;
              background-color: #fff3cd;
              border-left: 4px solid #ffc107;
              font-size: 12px;
              line-height: 1.6;
            }
            .notes strong {
              display: block;
              margin-bottom: 5px;
              color: #856404;
            }
            .success-note {
              background-color: #d4edda;
              border-left-color: #28a745;
            }
            .success-note strong {
              color: #155724;
            }
            .footer {
              margin-top: 40px;
              text-align: center;
              padding-top: 20px;
              border-top: 1px solid #ddd;
              font-size: 12px;
              color: #666;
            }
            .footer strong {
              display: block;
              font-size: 14px;
              color: #1976d2;
              margin-bottom: 5px;
            }
            @media print {
              body {
                padding: 0;
              }
            }
          </style>
        </head>
        <body>
          ${o.innerHTML}
        </body>
      </html>
    `),l.document.close(),l.focus(),setTimeout(()=>{l.print(),l.close()},250))};if(!s)return null;const j=()=>{const o=new Date(s.check_in_date),l=new Date(s.check_out_date);return Math.ceil((l.getTime()-o.getTime())/(1e3*60*60*24))};return e.jsxs(me,{open:T,onClose:f,maxWidth:"md",fullWidth:!0,children:[e.jsx(ue,{children:e.jsxs(i,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(i,{display:"flex",alignItems:"center",children:[m==="lateCheckout"?e.jsx(N,{sx:{mr:1,color:"warning.main"}}):e.jsx(ye,{sx:{mr:1,color:"primary.main"}}),e.jsx(t,{variant:"h6",children:m==="preview"?"Invoice Preview - Review Before Checkout":m==="lateCheckout"?"Late Checkout - Enter Penalty Details":"Confirm Checkout"})]}),e.jsx(ve,{label:s.folio_number||`#${s.id}`,color:m==="lateCheckout"?"warning":"primary",size:"small",variant:"outlined"})]})}),e.jsx(pe,{dividers:!0,children:m==="preview"?e.jsxs(i,{sx:{fontFamily:"Arial, sans-serif",color:"#333"},children:[e.jsxs(d,{severity:"info",sx:{mb:3},children:[e.jsx(t,{variant:"body2",fontWeight:600,children:"Please review the invoice carefully before proceeding with checkout."}),e.jsx(t,{variant:"caption",children:"Verify all charges, taxes, and refunds are correct."})]}),s.company_id&&s.company_name&&e.jsxs(d,{severity:"warning",icon:e.jsx(D,{}),sx:{mb:3},children:[e.jsxs(t,{variant:"body2",fontWeight:600,children:["Company Billing: ",s.company_name]}),e.jsx(t,{variant:"caption",children:"Room charges will be automatically posted to the company ledger upon checkout."})]}),e.jsxs(i,{sx:{textAlign:"center",mb:4,borderBottom:"2px solid #1976d2",pb:2},children:[e.jsx(t,{variant:"h4",sx:{color:"#1976d2",fontWeight:700,mb:.5},children:c.hotel_name}),e.jsx(t,{variant:"body2",color:"text.secondary",children:c.hotel_address}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Phone: ",c.hotel_phone," | Email: ",c.hotel_email]})]}),e.jsxs(r,{container:!0,spacing:3,sx:{mb:3},children:[e.jsxs(r,{item:!0,xs:12,md:4,children:[e.jsx(t,{variant:"subtitle2",sx:{color:"#1976d2",mb:1,textTransform:"uppercase"},children:"Invoice Details"}),e.jsxs(t,{variant:"body2",sx:{mb:.5},children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"120px"},children:"Invoice Number:"}),e.jsx(i,{component:"span",sx:{fontWeight:600},children:(s==null?void 0:s.folio_number)||`#${s==null?void 0:s.id}`})]}),e.jsxs(t,{variant:"body2",sx:{mb:.5},children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"120px"},children:"Date:"}),e.jsx(i,{component:"span",sx:{fontWeight:600},children:new Date().toLocaleDateString()})]}),e.jsxs(t,{variant:"body2",children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"120px"},children:"Status:"}),e.jsx(i,{component:"span",sx:{fontWeight:600},children:"Pending Checkout"})]})]}),e.jsxs(r,{item:!0,xs:12,md:4,children:[e.jsx(t,{variant:"subtitle2",sx:{color:"#1976d2",mb:1,textTransform:"uppercase"},children:"Guest Information"}),e.jsxs(t,{variant:"body2",sx:{mb:.5},children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"80px"},children:"Name:"}),e.jsx(i,{component:"span",sx:{fontWeight:600},children:s==null?void 0:s.guest_name})]}),e.jsxs(t,{variant:"body2",children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"80px"},children:"Room:"}),e.jsxs(i,{component:"span",sx:{fontWeight:600},children:[s==null?void 0:s.room_number," - ",s==null?void 0:s.room_type]})]})]}),e.jsxs(r,{item:!0,xs:12,md:4,children:[e.jsx(t,{variant:"subtitle2",sx:{color:"#1976d2",mb:1,textTransform:"uppercase"},children:"Stay Details"}),e.jsxs(t,{variant:"body2",sx:{mb:.5},children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"80px"},children:"Check-in:"}),e.jsx(i,{component:"span",sx:{fontWeight:600},children:new Date((s==null?void 0:s.check_in_date)||"").toLocaleDateString()})]}),e.jsxs(t,{variant:"body2",sx:{mb:.5},children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"80px"},children:"Check-out:"}),e.jsx(i,{component:"span",sx:{fontWeight:600},children:new Date((s==null?void 0:s.check_out_date)||"").toLocaleDateString()})]}),e.jsxs(t,{variant:"body2",children:[e.jsx(i,{component:"span",sx:{color:"#666",display:"inline-block",minWidth:"80px"},children:"Duration:"}),e.jsxs(i,{component:"span",sx:{fontWeight:600},children:[j()," night(s)"]})]})]})]}),e.jsxs(i,{sx:{border:"1px solid #ddd",borderRadius:1,overflow:"hidden",mb:3},children:[e.jsx(i,{sx:{bgcolor:"#1976d2",color:"white",p:1.5},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{fontWeight:600,textTransform:"uppercase"},children:"Description"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600,textTransform:"uppercase"},children:"Amount"})})]})}),e.jsxs(i,{sx:{p:0},children:[e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsxs(t,{variant:"body2",children:["Room Charges (",j()," nights)"]})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.roomCharges)})})]})}),n.serviceTax>0&&e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsxs(t,{variant:"body2",children:["Service Tax (",c.service_tax_rate,"%)"]})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.serviceTax)})})]})}),n.tourismTax>0&&e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",children:"Tourism Tax"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.tourismTax)})})]})}),n.extraBedCharge>0&&e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",children:"Extra Bed Charge"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.extraBedCharge)})})]})}),n.lateCheckoutPenalty>0&&e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd",bgcolor:"#ffebee"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"#d32f2f"},children:"Late Checkout Penalty"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#d32f2f"},children:a(n.lateCheckoutPenalty)})})]})}),e.jsx(i,{sx:{p:1.5,borderBottom:"2px solid #ddd",borderTop:"2px solid #ddd"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:"Subtotal"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.subtotal)})})]})}),n.depositRefund>0?e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd",bgcolor:"#e8f5e9"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"#2e7d32"},children:"Room Card Deposit Refund"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsxs(t,{variant:"body2",sx:{fontWeight:600,color:"#2e7d32"},children:["-",a(n.depositRefund)]})})]})}):e.jsx(i,{sx:{p:1.5,borderBottom:"1px solid #ddd",bgcolor:"#e3f2fd"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"#1565c0"},children:"Room Card Deposit"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#1565c0"},children:"Waived"})})]})}),e.jsx(i,{sx:{p:2,bgcolor:"#f5f5f5",borderTop:"3px double #1976d2"},children:e.jsxs(r,{container:!0,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"h6",sx:{fontWeight:700},children:n.grandTotal>=0?"Total Amount Due":"Total Refund"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"h5",sx:{fontWeight:700,color:"#1976d2"},children:a(Math.abs(n.grandTotal))})})]})})]})]}),n.lateCheckoutPenalty>0&&e.jsxs(d,{severity:"warning",sx:{mb:2},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:"Late Checkout Notice"}),e.jsxs(t,{variant:"caption",children:["Guest checked out after the standard checkout time. A penalty of ",a(n.lateCheckoutPenalty)," has been applied, and the room card deposit has been forfeited."]})]}),n.depositRefund>0&&e.jsx(d,{severity:"success",sx:{mb:2},children:e.jsxs(t,{variant:"body2",children:["Room card deposit of ",a(n.depositRefund)," will be refunded to the guest."]})})]}):m==="lateCheckout"?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(d,{severity:"warning",icon:e.jsx(N,{}),children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:"Late Checkout Detected"}),e.jsxs(t,{variant:"body2",children:["Current time is past the configured checkout time (",c.check_out_time,"). Please enter the late checkout penalty and any additional notes."]})]}),s.company_id&&s.company_name&&e.jsxs(d,{severity:"info",icon:e.jsx(D,{}),children:[e.jsxs(t,{variant:"body2",fontWeight:600,children:["Company Billing: ",s.company_name]}),e.jsx(t,{variant:"caption",children:"Late checkout penalty will be included in the company ledger posting."})]}),e.jsx(C,{elevation:0,sx:{p:2,bgcolor:"grey.50",borderRadius:2},children:e.jsxs(r,{container:!0,spacing:2,children:[e.jsxs(r,{item:!0,xs:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Guest"}),e.jsx(t,{variant:"body1",fontWeight:600,children:s.guest_name})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Room"}),e.jsxs(t,{variant:"body1",fontWeight:600,children:[s.room_number," - ",s.room_type]})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Check-out Date"}),e.jsx(t,{variant:"body1",fontWeight:600,children:new Date(s.check_out_date).toLocaleDateString()})]}),e.jsxs(r,{item:!0,xs:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"Current Time"}),e.jsxs(t,{variant:"body1",fontWeight:600,color:"warning.main",children:[new Date().toLocaleTimeString()," (Late)"]})]})]})}),e.jsxs(C,{elevation:0,sx:{p:3,bgcolor:"warning.50",borderRadius:2,border:"1px solid",borderColor:"warning.main"},children:[e.jsx(t,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,sx:{color:"warning.dark"},children:"Late Checkout Penalty"}),e.jsx(J,{fullWidth:!0,label:"Penalty Amount",type:"number",value:v,onChange:o=>se(parseFloat(o.target.value)||0),InputProps:{startAdornment:e.jsx(ge,{position:"start",children:X})},helperText:"Enter the late checkout penalty amount (set to 0 if no penalty)",sx:{mb:2}}),e.jsx(J,{fullWidth:!0,label:"Additional Notes (Optional)",multiline:!0,rows:3,value:L,onChange:o=>I(o.target.value),placeholder:"Enter any additional notes about the late checkout (e.g., reason for delay, special circumstances, etc.)",helperText:"These notes will be saved with the booking record"})]}),e.jsxs(C,{elevation:0,sx:{p:2,bgcolor:"primary.50",borderRadius:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Updated Charges Summary"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Room Charges"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",children:a(n.roomCharges)})}),n.serviceTax>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Service Tax"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",children:a(n.serviceTax)})})]}),e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"warning.main",fontWeight:600},children:"Late Checkout Penalty"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{color:"warning.main",fontWeight:600},children:a(v)})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(w,{sx:{my:1}})}),n.roomCardDeposit>0?e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"success.main"},children:"Room Card Deposit Refund"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsxs(t,{variant:"body2",sx:{color:"success.main"},children:["-",a(n.roomCardDeposit)]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"info.main"},children:"Room Card Deposit"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{color:"info.main"},children:"Waived"})})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(w,{sx:{my:1}})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"h6",fontWeight:700,children:"Total Amount Due"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"h6",fontWeight:700,color:"primary",children:a(n.grandTotal)})})]})]}),e.jsx(d,{severity:"info",children:e.jsx(t,{variant:"body2",children:"The late checkout penalty will be added to the final bill. Room card deposit will still be refunded."})})]}):e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3},children:[A&&e.jsx(d,{severity:"error",onClose:()=>W(null),children:A}),s.company_id&&s.company_name&&e.jsxs(d,{severity:"warning",icon:e.jsx(D,{}),children:[e.jsxs(t,{variant:"body2",fontWeight:600,children:["Company Billing: ",s.company_name]}),e.jsx(t,{variant:"caption",children:"Room charges will be automatically posted to the company ledger."})]}),e.jsxs(C,{elevation:0,sx:{p:2,bgcolor:"grey.50",borderRadius:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Guest Information"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Guest Name:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:s.guest_name})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Room:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",sx:{fontWeight:600},children:[s.room_number," - ",s.room_type]})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Check-in:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:new Date(s.check_in_date).toLocaleString()})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Check-out:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:new Date(s.check_out_date).toLocaleString()})}),e.jsx(r,{item:!0,xs:6,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Duration:"})}),e.jsx(r,{item:!0,xs:6,children:e.jsxs(t,{variant:"body2",sx:{fontWeight:600},children:[j()," night(s)"]})})]})]}),e.jsxs(C,{elevation:0,sx:{p:2,bgcolor:"primary.50",borderRadius:2},children:[e.jsx(t,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Charges Breakdown"}),e.jsxs(r,{container:!0,spacing:1,children:[e.jsx(r,{item:!0,xs:8,children:e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Room Charges (",j()," nights)"]})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.roomCharges)})}),n.serviceTax>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Service Tax (",c.service_tax_rate,"%)"]})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",children:a(n.serviceTax)})})]}),n.tourismTax>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Tourism Tax"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",children:a(n.tourismTax)})})]}),n.extraBedCharge>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",color:"text.secondary",children:"Extra Bed Charge"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",children:a(n.extraBedCharge)})})]}),n.lateCheckoutPenalty>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"warning.main"},children:"Late Checkout Penalty"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{color:"warning.main",fontWeight:600},children:a(n.lateCheckoutPenalty)})})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(w,{sx:{my:1}})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:"Subtotal"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:a(n.subtotal)})}),n.depositRefund>0&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"body2",sx:{color:"success.main"},children:"Room Card Deposit Refund"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsxs(t,{variant:"body2",sx:{color:"success.main",fontWeight:600},children:["-",a(n.depositRefund)]})})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(w,{sx:{my:1}})}),e.jsx(r,{item:!0,xs:8,children:e.jsx(t,{variant:"h6",sx:{fontWeight:700},children:n.grandTotal>=0?"Total to Collect":"Total to Refund"})}),e.jsx(r,{item:!0,xs:4,sx:{textAlign:"right"},children:e.jsx(t,{variant:"h5",color:n.grandTotal>=0?"primary":"success",sx:{fontWeight:700},children:a(Math.abs(n.grandTotal))})})]})]}),n.lateCheckoutPenalty>0&&e.jsxs(d,{severity:"warning",children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600},children:"Late Checkout Detected"}),e.jsxs(t,{variant:"caption",children:["Guest checked out after the standard checkout time. A penalty of ",a(n.lateCheckoutPenalty)," has been applied, and the room card deposit will not be refunded."]})]}),n.depositRefund>0&&e.jsx(d,{severity:"success",children:e.jsxs(t,{variant:"body2",children:["Room card deposit of ",a(n.depositRefund)," will be refunded to the guest."]})})]})}),e.jsx(je,{sx:{px:3,py:2},children:m==="preview"?e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:f,children:"Cancel"}),e.jsx(h,{variant:"outlined",onClick:oe,startIcon:e.jsx(fe,{}),children:"Print Preview"}),e.jsx(h,{variant:"contained",onClick:ne,startIcon:u?e.jsx(N,{}):e.jsx(R,{}),color:u?"warning":"primary",children:u?"Proceed (Late Checkout)":"Proceed to Checkout"})]}):m==="lateCheckout"?e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:z,children:"Back to Invoice"}),e.jsx(i,{sx:{flex:1}}),e.jsx(h,{onClick:f,children:"Cancel"}),e.jsx(h,{variant:"contained",color:"warning",onClick:ie,startIcon:e.jsx(R,{}),children:"Continue to Confirmation"})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:u?ae:z,children:u?"Back to Penalty":"Back to Invoice"}),e.jsx(i,{sx:{flex:1}}),e.jsx(h,{onClick:f,disabled:b,children:"Cancel"}),e.jsx(h,{variant:"contained",onClick:re,disabled:b,startIcon:b?e.jsx(xe,{size:20}):e.jsx(R,{}),children:b?"Processing...":"Confirm Checkout"})]})}),e.jsxs(i,{id:"printable-invoice",sx:{display:"none"},children:[e.jsxs("div",{className:"invoice-header",children:[e.jsx("h1",{children:c.hotel_name}),e.jsx("p",{children:c.hotel_address}),e.jsxs("p",{children:["Phone: ",c.hotel_phone," | Email: ",c.hotel_email]})]}),e.jsxs("div",{className:"invoice-meta",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Invoice Details"}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Invoice Number:"}),e.jsx("span",{className:"value",children:(s==null?void 0:s.folio_number)||`#${s==null?void 0:s.id}`})]}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Date:"}),e.jsx("span",{className:"value",children:new Date().toLocaleDateString()})]}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Status:"}),e.jsx("span",{className:"value",children:"Checked Out"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Guest Information"}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Name:"}),e.jsx("span",{className:"value",children:s==null?void 0:s.guest_name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Room:"}),e.jsxs("span",{className:"value",children:[s==null?void 0:s.room_number," - ",s==null?void 0:s.room_type]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Stay Details"}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Check-in:"}),e.jsx("span",{className:"value",children:new Date((s==null?void 0:s.check_in_date)||"").toLocaleDateString()})]}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Check-out:"}),e.jsx("span",{className:"value",children:new Date((s==null?void 0:s.check_out_date)||"").toLocaleDateString()})]}),e.jsxs("p",{children:[e.jsx("span",{className:"label",children:"Duration:"}),e.jsxs("span",{className:"value",children:[j()," night(s)"]})]})]})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{className:"amount",children:"Amount"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{children:["Room Charges (",j()," nights)"]}),e.jsx("td",{className:"amount",children:a(n.roomCharges)})]}),n.serviceTax>0&&e.jsxs("tr",{children:[e.jsxs("td",{children:["Service Tax (",c.service_tax_rate,"%)"]}),e.jsx("td",{className:"amount",children:a(n.serviceTax)})]}),n.tourismTax>0&&e.jsxs("tr",{children:[e.jsx("td",{children:"Tourism Tax"}),e.jsx("td",{className:"amount",children:a(n.tourismTax)})]}),n.extraBedCharge>0&&e.jsxs("tr",{children:[e.jsx("td",{children:"Extra Bed Charge"}),e.jsx("td",{className:"amount",children:a(n.extraBedCharge)})]}),n.lateCheckoutPenalty>0&&e.jsxs("tr",{className:"penalty-row",children:[e.jsx("td",{children:"Late Checkout Penalty"}),e.jsx("td",{className:"amount",children:a(n.lateCheckoutPenalty)})]}),e.jsxs("tr",{className:"subtotal-row",children:[e.jsx("td",{children:"Subtotal"}),e.jsx("td",{className:"amount",children:a(n.subtotal)})]}),n.depositRefund>0?e.jsxs("tr",{className:"refund-row",children:[e.jsx("td",{children:"Room Card Deposit Refund"}),e.jsxs("td",{className:"amount",children:["-",a(n.depositRefund)]})]}):e.jsxs("tr",{style:{color:"#1565c0"},children:[e.jsx("td",{children:"Room Card Deposit"}),e.jsx("td",{className:"amount",children:"Waived"})]}),e.jsxs("tr",{className:"total-row",children:[e.jsx("td",{children:n.grandTotal>=0?"Total Amount Due":"Total Refund"}),e.jsx("td",{className:"amount",children:a(Math.abs(n.grandTotal))})]})]})]}),n.lateCheckoutPenalty>0&&e.jsxs("div",{className:"notes",children:[e.jsx("strong",{children:"Late Checkout Notice"}),"Guest checked out after the standard checkout time. A penalty of ",a(n.lateCheckoutPenalty)," has been applied, and the room card deposit has been forfeited."]}),n.depositRefund>0?e.jsxs("div",{className:"notes success-note",children:[e.jsx("strong",{children:"Deposit Refund"}),"Room card deposit of ",a(n.depositRefund)," will be refunded to the guest."]}):e.jsxs("div",{className:"notes",style:{backgroundColor:"#e3f2fd",borderLeftColor:"#1565c0"},children:[e.jsx("strong",{style:{color:"#1565c0"},children:"Room Card Deposit"}),"Waived (Member benefit)"]}),e.jsxs("div",{className:"footer",children:[e.jsxs("strong",{children:["Thank you for choosing ",c.hotel_name,"!"]}),e.jsx("p",{children:"We hope to see you again soon."}),e.jsx("p",{style:{marginTop:"10px"},children:"This is a computer-generated invoice and does not require a signature."})]})]})]})};export{Ae as C};
