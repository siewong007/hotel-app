import{l as se,j as e,i as ne,r as c,ax as K,p as G,T as r,B as h,A as L,D as oe,o as x,C as le,ay as de,n as f,t as F,M as A}from"./index-DnWmqzJF.js";import{v as V}from"./validation-C2QFlzQX.js";import{C as I}from"./CheckCircle-B5gS3fbx.js";import{S as ce,a as ue,b as xe}from"./Stepper-DWx8UZeC.js";import{B as he}from"./ArrowBack-DoSpaJPE.js";import{C as b,a as g}from"./CardContent-BhQI87uj.js";import{G as i}from"./Grid-0tqG7FTE.js";import{C as j}from"./Chip-CSuofl6d.js";import{D as S}from"./Delete-CC6nSGco.js";import{P as me}from"./CameraAlt-BCbaaeDQ.js";const T=se(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),$=["Personal Information","Document Details","Upload Documents","Verification"],J=[{value:"passport",label:"Passport"},{value:"drivers_license",label:"Driver's License"},{value:"national_id",label:"National ID Card"}],H=["United States","United Kingdom","Canada","Australia","Germany","France","Italy","Spain","Japan","China","India","Brazil","Mexico","Singapore","Malaysia","Thailand","Indonesia","Philippines","South Korea","Vietnam","Other"],ke=()=>{const N=ne(),[y,R]=c.useState(0),[w,E]=c.useState(!1),[O,d]=c.useState(""),[Z,Q]=c.useState(!1),[_,P]=c.useState(""),[W,q]=c.useState(""),[a,v]=c.useState({fullName:"",dateOfBirth:"",nationality:"",phone:"",email:"",currentAddress:""}),[s,C]=c.useState({idType:"passport",idNumber:"",idIssuingCountry:"",idIssueDate:"",idExpiryDate:""}),[l,D]=c.useState({idFront:null,idBack:null,selfie:null,proofOfAddress:null}),U=c.useRef(null),z=c.useRef(null),M=c.useRef(null),Y=c.useRef(null),k=(n,u)=>{if(!n)return;if(!n.type.startsWith("image/")){d("Please upload an image file (JPG, PNG)");return}if(n.size>5*1024*1024){d("File size must be less than 5MB");return}const t=new FileReader;t.onload=o=>{var m;const p=(m=o.target)==null?void 0:m.result;D(ae=>({...ae,[u]:p})),d("")},t.onerror=()=>{d("Failed to read file")},t.readAsDataURL(n)},X=()=>{if(y===0){if(!a.fullName||!a.dateOfBirth||!a.nationality||!a.phone||!a.email||!a.currentAddress){d("Please fill in all required fields");return}const n=V(a.email);if(n){P(n),d(n);return}}else if(y===1){if(!s.idType||!s.idNumber||!s.idIssuingCountry||!s.idExpiryDate){d("Please fill in all required document details");return}if(new Date(s.idExpiryDate)<=new Date){d("ID expiry date must be in the future");return}}else if(y===2){if(!l.idFront||!l.selfie){d("Please upload your ID front and selfie photo");return}if(s.idType!=="passport"&&!l.idBack){d("Please upload the back of your ID");return}}d(""),R(n=>n+1)},ee=()=>{R(n=>n-1),d("")},te=(n,u="image/jpeg")=>{const t=atob(n.split(",")[1]),o=new Array(t.length);for(let m=0;m<t.length;m++)o[m]=t.charCodeAt(m);const p=new Uint8Array(o);return new Blob([p],{type:u})},B=async(n,u)=>{const t=te(n),o=new FormData;o.append("file",t,`${u}.jpg`),o.append("documentType",u);const p=await fetch("http://localhost:3030/ekyc/upload-document",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:o});if(!p.ok)throw new Error(`Failed to upload ${u}`);return(await p.json()).file_path},re=async()=>{E(!0),d("");try{const n=await B(l.idFront,"id_front"),u=l.idBack?await B(l.idBack,"id_back"):null,t=await B(l.selfie,"selfie"),o=l.proofOfAddress?await B(l.proofOfAddress,"proof"):null,p={full_name:a.fullName,date_of_birth:a.dateOfBirth,nationality:a.nationality,phone:a.phone,email:a.email,current_address:a.currentAddress,id_type:s.idType,id_number:s.idNumber,id_issuing_country:s.idIssuingCountry,id_issue_date:s.idIssueDate||null,id_expiry_date:s.idExpiryDate,id_front_image:n,id_back_image:u,selfie_image:t,proof_of_address:o};if(!(await fetch("http://localhost:3030/ekyc/submit",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify(p)})).ok)throw new Error("Failed to submit eKYC verification");Q(!0),setTimeout(()=>{N("/profile?ekycSubmitted=true")},2e3)}catch(n){d(n.message||"Failed to submit eKYC verification")}finally{E(!1)}},ie=n=>{var u;switch(n){case 0:return e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Personal Information"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Please provide your personal details as they appear on your ID document."})]}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Full Name",required:!0,value:a.fullName,onChange:t=>v({...a,fullName:t.target.value}),placeholder:"As shown on ID"})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(A,{label:"Date of Birth",value:a.dateOfBirth,onChange:t=>v({...a,dateOfBirth:t}),maxDate:new Date().toISOString().split("T")[0],required:!0})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,select:!0,label:"Nationality",required:!0,value:a.nationality,onChange:t=>v({...a,nationality:t.target.value}),children:H.map(t=>e.jsx(F,{value:t,children:t},t))})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"Phone Number",required:!0,value:a.phone,onChange:t=>{v({...a,phone:t.target.value}),q("")},onBlur:()=>q(""),error:!!W,helperText:W,placeholder:"+1-234-567-8900"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Email Address",type:"email",required:!0,value:a.email,onChange:t=>{v({...a,email:t.target.value}),P("")},onBlur:()=>P(V(a.email)),error:!!_,helperText:_})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,label:"Current Address",required:!0,multiline:!0,rows:3,value:a.currentAddress,onChange:t=>v({...a,currentAddress:t.target.value}),placeholder:"Street, City, State, ZIP, Country"})})]});case 1:return e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Identity Document Details"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Enter the details from your government-issued ID."})]}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,select:!0,label:"ID Type",required:!0,value:s.idType,onChange:t=>C({...s,idType:t.target.value}),children:J.map(t=>e.jsx(F,{value:t.value,children:t.label},t.value))})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,label:"ID Number",required:!0,value:s.idNumber,onChange:t=>C({...s,idNumber:t.target.value})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(f,{fullWidth:!0,select:!0,label:"Issuing Country",required:!0,value:s.idIssuingCountry,onChange:t=>C({...s,idIssuingCountry:t.target.value}),children:H.map(t=>e.jsx(F,{value:t,children:t},t))})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(A,{label:"Issue Date (Optional)",value:s.idIssueDate,onChange:t=>C({...s,idIssueDate:t}),maxDate:new Date().toISOString().split("T")[0]})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(A,{label:"Expiry Date",value:s.idExpiryDate,onChange:t=>C({...s,idExpiryDate:t}),minDate:new Date().toISOString().split("T")[0],required:!0})})]});case 2:return e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Upload Documents"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Please upload clear photos of your ID and a recent selfie."})]}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(b,{variant:"outlined",children:e.jsxs(g,{children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:["ID Front ",e.jsx(j,{label:"Required",color:"error",size:"small"})]}),e.jsx(h,{sx:{mt:2},children:l.idFront?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l.idFront,alt:"ID Front",style:{width:"100%",borderRadius:8,marginBottom:16}}),e.jsx(x,{fullWidth:!0,variant:"outlined",color:"error",startIcon:e.jsx(S,{}),onClick:()=>D(t=>({...t,idFront:null})),children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:U,type:"file",accept:"image/*",style:{display:"none"},onChange:t=>{var o;return((o=t.target.files)==null?void 0:o[0])&&k(t.target.files[0],"idFront")}}),e.jsx(x,{fullWidth:!0,variant:"contained",startIcon:e.jsx(T,{}),onClick:()=>{var t;return(t=U.current)==null?void 0:t.click()},children:"Upload ID Front"})]})})]})})}),s.idType!=="passport"&&e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(b,{variant:"outlined",children:e.jsxs(g,{children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:["ID Back ",e.jsx(j,{label:"Required",color:"error",size:"small"})]}),e.jsx(h,{sx:{mt:2},children:l.idBack?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l.idBack,alt:"ID Back",style:{width:"100%",borderRadius:8,marginBottom:16}}),e.jsx(x,{fullWidth:!0,variant:"outlined",color:"error",startIcon:e.jsx(S,{}),onClick:()=>D(t=>({...t,idBack:null})),children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:z,type:"file",accept:"image/*",style:{display:"none"},onChange:t=>{var o;return((o=t.target.files)==null?void 0:o[0])&&k(t.target.files[0],"idBack")}}),e.jsx(x,{fullWidth:!0,variant:"contained",startIcon:e.jsx(T,{}),onClick:()=>{var t;return(t=z.current)==null?void 0:t.click()},children:"Upload ID Back"})]})})]})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(b,{variant:"outlined",children:e.jsxs(g,{children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:["Selfie Photo ",e.jsx(j,{label:"Required",color:"error",size:"small"})]}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Take a clear photo of your face for verification"}),e.jsx(h,{sx:{mt:2},children:l.selfie?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l.selfie,alt:"Selfie",style:{width:"100%",borderRadius:8,marginBottom:16}}),e.jsx(x,{fullWidth:!0,variant:"outlined",color:"error",startIcon:e.jsx(S,{}),onClick:()=>D(t=>({...t,selfie:null})),children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:M,type:"file",accept:"image/*",capture:"user",style:{display:"none"},onChange:t=>{var o;return((o=t.target.files)==null?void 0:o[0])&&k(t.target.files[0],"selfie")}}),e.jsx(x,{fullWidth:!0,variant:"contained",startIcon:e.jsx(me,{}),onClick:()=>{var t;return(t=M.current)==null?void 0:t.click()},children:"Take Selfie"})]})})]})})}),e.jsx(i,{item:!0,xs:12,md:6,children:e.jsx(b,{variant:"outlined",children:e.jsxs(g,{children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:["Proof of Address ",e.jsx(j,{label:"Optional",size:"small"})]}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:2},children:"Utility bill, bank statement, etc."}),e.jsx(h,{sx:{mt:2},children:l.proofOfAddress?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l.proofOfAddress,alt:"Proof of Address",style:{width:"100%",borderRadius:8,marginBottom:16}}),e.jsx(x,{fullWidth:!0,variant:"outlined",color:"error",startIcon:e.jsx(S,{}),onClick:()=>D(t=>({...t,proofOfAddress:null})),children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:Y,type:"file",accept:"image/*",style:{display:"none"},onChange:t=>{var o;return((o=t.target.files)==null?void 0:o[0])&&k(t.target.files[0],"proofOfAddress")}}),e.jsx(x,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(T,{}),onClick:()=>{var t;return(t=Y.current)==null?void 0:t.click()},children:"Upload Document"})]})})]})})})]});case 3:return e.jsxs(h,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Review & Submit"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Please review your information before submitting."}),e.jsx(b,{variant:"outlined",sx:{mb:3},children:e.jsxs(g,{children:[e.jsx(r,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Personal Information"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Full Name:"}),e.jsx(r,{variant:"body1",children:a.fullName})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Date of Birth:"}),e.jsx(r,{variant:"body1",children:a.dateOfBirth})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Nationality:"}),e.jsx(r,{variant:"body1",children:a.nationality})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Phone:"}),e.jsx(r,{variant:"body1",children:a.phone})]}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Email:"}),e.jsx(r,{variant:"body1",children:a.email})]})]})]})}),e.jsx(b,{variant:"outlined",sx:{mb:3},children:e.jsxs(g,{children:[e.jsx(r,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Document Information"}),e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"ID Type:"}),e.jsx(r,{variant:"body1",children:(u=J.find(t=>t.value===s.idType))==null?void 0:u.label})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"ID Number:"}),e.jsx(r,{variant:"body1",children:s.idNumber})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Issuing Country:"}),e.jsx(r,{variant:"body1",children:s.idIssuingCountry})]}),e.jsxs(i,{item:!0,xs:6,children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Expiry Date:"}),e.jsx(r,{variant:"body1",children:s.idExpiryDate})]})]})]})}),e.jsx(b,{variant:"outlined",children:e.jsxs(g,{children:[e.jsx(r,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Uploaded Documents"}),e.jsxs(h,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[l.idFront&&e.jsx(j,{icon:e.jsx(I,{}),label:"ID Front",color:"success"}),l.idBack&&e.jsx(j,{icon:e.jsx(I,{}),label:"ID Back",color:"success"}),l.selfie&&e.jsx(j,{icon:e.jsx(I,{}),label:"Selfie",color:"success"}),l.proofOfAddress&&e.jsx(j,{icon:e.jsx(I,{}),label:"Proof of Address",color:"success"})]})]})}),e.jsx(L,{severity:"info",sx:{mt:3},children:e.jsx(r,{variant:"body2",children:"Your information will be securely processed and verified. You will be notified once your verification is complete. Once approved, you'll be able to use self-check-in for your bookings."})})]});default:return null}};return Z?e.jsx(K,{maxWidth:"md",sx:{mt:4,mb:4},children:e.jsxs(G,{sx:{p:4,textAlign:"center"},children:[e.jsx(I,{sx:{fontSize:80,color:"success.main",mb:2}}),e.jsx(r,{variant:"h4",gutterBottom:!0,children:"eKYC Submitted Successfully!"}),e.jsx(r,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Your identity verification has been submitted and is under review. You will receive an email notification once your verification is approved."}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Redirecting to your profile..."})]})}):e.jsx(K,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsxs(G,{sx:{p:4},children:[e.jsxs(h,{sx:{mb:4},children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"eKYC Registration"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Complete your identity verification to enable self-check-in"})]}),e.jsx(ce,{activeStep:y,sx:{mb:4},children:$.map(n=>e.jsx(ue,{children:e.jsx(xe,{children:n})},n))}),O&&e.jsx(L,{severity:"error",sx:{mb:3},onClose:()=>d(""),children:O}),e.jsx(h,{sx:{mb:4},children:ie(y)}),e.jsx(oe,{sx:{my:3}}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(x,{disabled:y===0,onClick:ee,startIcon:e.jsx(he,{}),children:"Back"}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"outlined",onClick:()=>N("/profile"),children:"Cancel"}),y===$.length-1?e.jsx(x,{variant:"contained",onClick:re,disabled:w,endIcon:w?e.jsx(le,{size:20}):e.jsx(I,{}),children:w?"Submitting...":"Submit for Verification"}):e.jsx(x,{variant:"contained",onClick:X,endIcon:e.jsx(de,{}),children:"Next"})]})]})]})})};export{ke as default};
