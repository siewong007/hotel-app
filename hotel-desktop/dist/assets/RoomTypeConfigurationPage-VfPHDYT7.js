import{l as je,j as e,h as ge,r as c,H as g,B as m,A as N,C as W,T as s,f as fe,o as f,p as ye,q as K,I as O,n as d,t as ve}from"./index-DnWmqzJF.js";import{u as Ce}from"./useCurrency-C4JSCWBJ.js";import{t as x}from"./currency-SgYezy9c.js";import{A as we}from"./Add-C7DSqfba.js";import{G as r}from"./Grid-0tqG7FTE.js";import{C as z,a as F}from"./CardContent-BhQI87uj.js";import{T as ke,a as Se,b as Ae,c as M,d as n,e as De}from"./TableRow-B78mTfEk.js";import{C as B}from"./Chip-CSuofl6d.js";import{C as Re}from"./CheckCircle-B5gS3fbx.js";import{C as Be}from"./Cancel-zFl1_j2m.js";import{E as Ee}from"./Edit-v4qS8plG.js";import{D as Ie}from"./Delete-CC6nSGco.js";import{D as V,a as Y,b as G,c as X}from"./DialogTitle-DKxRfOzX.js";import{M as Pe}from"./AttachMoney-oNl3swnH.js";import{I as E}from"./InputAdornment-BrN3aL1-.js";import{F as J}from"./FormControlLabel-Ddfix5uo.js";import{S as Z}from"./Switch-CZyKJHRo.js";import{S as Ne}from"./Snackbar-BmHWVIFe.js";const $=je(e.jsx("path",{d:"M20 10V7c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v3c-1.1 0-2 .9-2 2v5h1.33L4 19h1l.67-2h12.67l.66 2h1l.67-2H22v-5c0-1.1-.9-2-2-2m-9 0H6V7h5zm7 0h-5V7h5z"}),"KingBed"),We=["Single","Twin","Double","Queen","King","Super King","Bunk"],T={name:"",code:"",description:"",base_price:"",weekday_rate:"",weekend_rate:"",max_occupancy:2,bed_type:"Queen",bed_count:1,allows_extra_bed:!1,max_extra_beds:0,extra_bed_charge:"",sort_order:0,is_active:!0},et=()=>{const{hasRole:y,hasPermission:v}=ge(),{format:C,symbol:w}=Ce(),I=y("admin")||y("manager")||v("rooms:read")||v("rooms:manage"),u=y("admin")||y("manager")||v("rooms:write")||v("rooms:manage"),[_,ee]=c.useState([]),[te,H]=c.useState(!0),[L,U]=c.useState(null),[ae,k]=c.useState(!1),[p,S]=c.useState(!1),[re,A]=c.useState(!1),[a,i]=c.useState(T),[q,D]=c.useState(null),[b,Q]=c.useState(null),[R,h]=c.useState(!1),[se,P]=c.useState(!1),[ne,ie]=c.useState(""),[le,oe]=c.useState("success");c.useEffect(()=>{I&&j()},[I]);const j=async()=>{try{H(!0),U(null);const t=await g.getAllRoomTypes();ee(t)}catch(t){U(t instanceof Error?t.message:"Failed to load room types")}finally{H(!1)}},o=(t,l="success")=>{ie(t),oe(l),P(!0)},ce=()=>{i(T),k(!0)},de=t=>{D(t),i({name:t.name,code:t.code,description:t.description||"",base_price:x(t.base_price),weekday_rate:t.weekday_rate?x(t.weekday_rate):"",weekend_rate:t.weekend_rate?x(t.weekend_rate):"",max_occupancy:t.max_occupancy,bed_type:t.bed_type||"Queen",bed_count:t.bed_count||1,allows_extra_bed:t.allows_extra_bed,max_extra_beds:t.max_extra_beds,extra_bed_charge:x(t.extra_bed_charge),sort_order:t.sort_order,is_active:t.is_active}),S(!0)},xe=t=>{Q(t),A(!0)},ue=async()=>{try{h(!0);const t={name:a.name,code:a.code.toUpperCase(),description:a.description||void 0,base_price:Number(a.base_price),weekday_rate:a.weekday_rate?Number(a.weekday_rate):void 0,weekend_rate:a.weekend_rate?Number(a.weekend_rate):void 0,max_occupancy:a.max_occupancy,bed_type:a.bed_type,bed_count:a.bed_count,allows_extra_bed:a.allows_extra_bed,max_extra_beds:a.allows_extra_bed?a.max_extra_beds:0,extra_bed_charge:a.allows_extra_bed&&a.extra_bed_charge?Number(a.extra_bed_charge):0,sort_order:a.sort_order};await g.createRoomType(t),k(!1),o("Room type created successfully"),j()}catch(t){const l=t instanceof Error?t.message:String(t);l.includes("duplicate key")||l.includes("unique constraint")?l.includes("room_types_name_key")?o(`A room type with the name "${a.name}" already exists. Please use a different name.`,"error"):l.includes("room_types_code_key")?o(`A room type with the code "${a.code.toUpperCase()}" already exists. Please use a different code.`,"error"):o("A room type with this name or code already exists. Please use different values.","error"):o(l||"Failed to create room type","error")}finally{h(!1)}},he=async()=>{if(q)try{h(!0);const t={name:a.name,code:a.code.toUpperCase(),description:a.description||void 0,base_price:Number(a.base_price),weekday_rate:a.weekday_rate?Number(a.weekday_rate):void 0,weekend_rate:a.weekend_rate?Number(a.weekend_rate):void 0,max_occupancy:a.max_occupancy,bed_type:a.bed_type,bed_count:a.bed_count,allows_extra_bed:a.allows_extra_bed,max_extra_beds:a.allows_extra_bed?a.max_extra_beds:0,extra_bed_charge:a.allows_extra_bed&&a.extra_bed_charge?Number(a.extra_bed_charge):0,is_active:a.is_active,sort_order:a.sort_order};await g.updateRoomType(q.id,t),S(!1),D(null),o("Room type updated successfully"),j()}catch(t){const l=t instanceof Error?t.message:String(t);l.includes("duplicate key")||l.includes("unique constraint")?l.includes("room_types_name_key")?o(`A room type with the name "${a.name}" already exists. Please use a different name.`,"error"):l.includes("room_types_code_key")?o(`A room type with the code "${a.code.toUpperCase()}" already exists. Please use a different code.`,"error"):o("A room type with this name or code already exists. Please use different values.","error"):o(l||"Failed to update room type","error")}finally{h(!1)}},me=async()=>{if(b)try{h(!0),await g.deleteRoomType(b.id),A(!1),Q(null),o("Room type deleted successfully"),j()}catch(t){o(t instanceof Error?t.message:"Failed to delete room type","error")}finally{h(!1)}},_e=async t=>{try{await g.updateRoomType(t.id,{is_active:!t.is_active}),o(`Room type ${t.is_active?"deactivated":"activated"} successfully`),j()}catch(l){o(l instanceof Error?l.message:"Failed to update room type","error")}};if(!I)return e.jsx(m,{sx:{p:3},children:e.jsx(N,{severity:"error",children:"You do not have permission to access this page."})});if(te)return e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsx(W,{})});if(L)return e.jsx(m,{sx:{p:3},children:e.jsx(N,{severity:"error",children:L})});const pe=_.filter(t=>t.is_active).length,be=_.filter(t=>t.allows_extra_bed).length;return e.jsxs(m,{sx:{p:3},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h4",component:"h1",children:[e.jsx(fe,{sx:{mr:1,verticalAlign:"middle"}}),"Room Type Configuration"]}),u&&e.jsx(f,{variant:"contained",startIcon:e.jsx(we,{}),onClick:ce,children:"Add Room Type"})]}),e.jsxs(r,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(z,{children:e.jsxs(F,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,children:"Total Room Types"}),e.jsx(s,{variant:"h4",children:_.length})]})})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(z,{children:e.jsxs(F,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,children:"Active Types"}),e.jsx(s,{variant:"h4",color:"success.main",children:pe})]})})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(z,{children:e.jsxs(F,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,children:"With Extra Bed Option"}),e.jsx(s,{variant:"h4",color:"info.main",children:be})]})})})]}),e.jsx(ke,{component:ye,children:e.jsxs(Se,{children:[e.jsx(Ae,{children:e.jsxs(M,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Code"}),e.jsx(n,{align:"right",children:"Base Price"}),e.jsx(n,{align:"center",children:"Max Occupancy"}),e.jsx(n,{align:"center",children:"Bed Config"}),e.jsx(n,{align:"center",children:"Extra Bed"}),e.jsx(n,{align:"center",children:"Status"}),u&&e.jsx(n,{align:"center",children:"Actions"})]})}),e.jsxs(De,{children:[_.map(t=>e.jsxs(M,{sx:{opacity:t.is_active?1:.6},children:[e.jsxs(n,{children:[e.jsx(s,{fontWeight:"medium",children:t.name}),t.description&&e.jsx(s,{variant:"caption",color:"text.secondary",display:"block",children:t.description})]}),e.jsx(n,{children:e.jsx(B,{label:t.code,size:"small",variant:"outlined"})}),e.jsxs(n,{align:"right",children:[e.jsx(s,{fontWeight:"medium",children:C(x(t.base_price))}),(t.weekday_rate||t.weekend_rate)&&e.jsxs(s,{variant:"caption",color:"text.secondary",display:"block",children:[t.weekday_rate&&`Weekday: ${C(x(t.weekday_rate))}`,t.weekday_rate&&t.weekend_rate&&" | ",t.weekend_rate&&`Weekend: ${C(x(t.weekend_rate))}`]})]}),e.jsx(n,{align:"center",children:e.jsx(B,{label:t.max_occupancy,size:"small",color:"primary"})}),e.jsx(n,{align:"center",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx($,{fontSize:"small"}),e.jsxs(s,{variant:"body2",children:[t.bed_count||1,"x ",t.bed_type||"Queen"]})]})}),e.jsx(n,{align:"center",children:t.allows_extra_bed?e.jsx(K,{title:`Max ${t.max_extra_beds} extra bed(s) @ ${C(x(t.extra_bed_charge))}/night`,children:e.jsx(B,{label:`Yes (${t.max_extra_beds})`,size:"small",color:"success",icon:e.jsx($,{})})}):e.jsx(B,{label:"No",size:"small",color:"default"})}),e.jsx(n,{align:"center",children:e.jsx(K,{title:t.is_active?"Active":"Inactive",children:e.jsx(O,{size:"small",onClick:()=>u&&_e(t),disabled:!u,children:t.is_active?e.jsx(Re,{color:"success"}):e.jsx(Be,{color:"error"})})})}),u&&e.jsxs(n,{align:"center",children:[e.jsx(O,{size:"small",onClick:()=>de(t),children:e.jsx(Ee,{})}),e.jsx(O,{size:"small",onClick:()=>xe(t),color:"error",children:e.jsx(Ie,{})})]})]},t.id)),_.length===0&&e.jsx(M,{children:e.jsx(n,{colSpan:u?8:7,align:"center",children:e.jsx(s,{color:"text.secondary",sx:{py:3},children:'No room types configured. Click "Add Room Type" to create one.'})})})]})]})}),e.jsxs(V,{open:ae||p,onClose:()=>{k(!1),S(!1),D(null)},maxWidth:"md",fullWidth:!0,children:[e.jsx(Y,{children:p?"Edit Room Type":"Create Room Type"}),e.jsx(G,{children:e.jsxs(r,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"Name",value:a.name,onChange:t=>i({...a,name:t.target.value}),required:!0,placeholder:"e.g., Deluxe Room"})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"Code",value:a.code,onChange:t=>i({...a,code:t.target.value.toUpperCase()}),required:!0,placeholder:"e.g., DLX",inputProps:{maxLength:10},helperText:"Short code for the room type"})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(d,{fullWidth:!0,label:"Description",value:a.description,onChange:t=>i({...a,description:t.target.value}),multiline:!0,rows:2,placeholder:"Brief description of the room type"})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:[e.jsx(Pe,{sx:{fontSize:16,verticalAlign:"middle",mr:.5}}),"Pricing"]})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(d,{fullWidth:!0,label:"Base Price",type:"number",value:a.base_price,onChange:t=>i({...a,base_price:t.target.value?Number(t.target.value):""}),required:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:w})}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(d,{fullWidth:!0,label:"Weekday Rate",type:"number",value:a.weekday_rate,onChange:t=>i({...a,weekday_rate:t.target.value?Number(t.target.value):""}),InputProps:{startAdornment:e.jsx(E,{position:"start",children:w})},helperText:"Optional"})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(d,{fullWidth:!0,label:"Weekend Rate",type:"number",value:a.weekend_rate,onChange:t=>i({...a,weekend_rate:t.target.value?Number(t.target.value):""}),InputProps:{startAdornment:e.jsx(E,{position:"start",children:w})},helperText:"Optional"})}),e.jsx(r,{item:!0,xs:12,children:e.jsxs(s,{variant:"subtitle2",color:"text.secondary",sx:{mb:1,mt:1},children:[e.jsx($,{sx:{fontSize:16,verticalAlign:"middle",mr:.5}}),"Room Configuration"]})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(d,{fullWidth:!0,label:"Max Occupancy",type:"number",value:a.max_occupancy,onChange:t=>i({...a,max_occupancy:Number(t.target.value)||1}),inputProps:{min:1,max:10}})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(d,{fullWidth:!0,select:!0,label:"Bed Type",value:a.bed_type,onChange:t=>i({...a,bed_type:t.target.value}),children:We.map(t=>e.jsx(ve,{value:t,children:t},t))})}),e.jsx(r,{item:!0,xs:12,sm:4,children:e.jsx(d,{fullWidth:!0,label:"Bed Count",type:"number",value:a.bed_count,onChange:t=>i({...a,bed_count:Number(t.target.value)||1}),inputProps:{min:1,max:5}})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(s,{variant:"subtitle2",color:"text.secondary",sx:{mb:1,mt:1},children:"Extra Bed Configuration"})}),e.jsx(r,{item:!0,xs:12,children:e.jsx(J,{control:e.jsx(Z,{checked:a.allows_extra_bed,onChange:t=>i({...a,allows_extra_bed:t.target.checked,max_extra_beds:t.target.checked?a.max_extra_beds||1:0})}),label:"Allow Extra Bed"})}),a.allows_extra_bed&&e.jsxs(e.Fragment,{children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"Max Extra Beds",type:"number",value:a.max_extra_beds,onChange:t=>i({...a,max_extra_beds:Number(t.target.value)||0}),inputProps:{min:1,max:5}})}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"Extra Bed Charge (per night)",type:"number",value:a.extra_bed_charge,onChange:t=>i({...a,extra_bed_charge:t.target.value?Number(t.target.value):""}),InputProps:{startAdornment:e.jsx(E,{position:"start",children:w})}})})]}),e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(d,{fullWidth:!0,label:"Sort Order",type:"number",value:a.sort_order,onChange:t=>i({...a,sort_order:Number(t.target.value)||0}),helperText:"Lower numbers appear first"})}),p&&e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsx(J,{control:e.jsx(Z,{checked:a.is_active,onChange:t=>i({...a,is_active:t.target.checked})}),label:"Active"})})]})}),e.jsxs(X,{children:[e.jsx(f,{onClick:()=>{k(!1),S(!1),D(null)},children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:p?he:ue,disabled:R||!a.name||!a.code||!a.base_price,children:R?e.jsx(W,{size:24}):p?"Update":"Create"})]})]}),e.jsxs(V,{open:re,onClose:()=>A(!1),children:[e.jsx(Y,{children:"Delete Room Type"}),e.jsxs(G,{children:[e.jsxs(s,{children:["Are you sure you want to delete ",e.jsx("strong",{children:b==null?void 0:b.name}),"?"]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This action cannot be undone. If rooms are using this type, you should deactivate it instead."})]}),e.jsxs(X,{children:[e.jsx(f,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(f,{variant:"contained",color:"error",onClick:me,disabled:R,children:R?e.jsx(W,{size:24}):"Delete"})]})]}),e.jsx(Ne,{open:se,autoHideDuration:4e3,onClose:()=>P(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(N,{severity:le,onClose:()=>P(!1),children:ne})})]})};export{et as default};
