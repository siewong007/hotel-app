const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-Bm_vtoqk.js","assets/index-DnWmqzJF.js","assets/index-9DzPy6IV.css"])))=>i.map(i=>d[i]);
import{bg as C,bh as T,l as G,j as e,bi as V,r as j,B as i,T as s,I as ae,x as le,A as S,a0 as Pe,a1 as ce,n as de,o as w,C as R,p as W,bk as $e,P as Ie,D as Ne}from"./index-DnWmqzJF.js";import{f as v}from"./currency-SgYezy9c.js";import{C as _,a as y}from"./CardContent-BhQI87uj.js";import{G as a}from"./Grid-0tqG7FTE.js";import{C as f}from"./Chip-CSuofl6d.js";import{C as M}from"./CheckCircle-B5gS3fbx.js";import{P as xe}from"./PictureAsPdf-D3q8hJGQ.js";import{T as ze,a as Fe,b as Be,c as U,d as u,e as Le}from"./TableRow-B78mTfEk.js";import{T as Ee}from"./AccessTime-l9--GsKj.js";import{C as Oe}from"./Collapse-B4NV5VtR.js";import{D as We,a as Me,b as Ue,c as He}from"./DialogTitle-DKxRfOzX.js";import{W as Ve}from"./Warning-Cw-oqR0p.js";class P{static async getPreview(l){return await C(()=>T.get(`night-audit/preview?date=${l}`).json(),{maxAttempts:3,initialDelay:1e3})}static async runNightAudit(l){return await C(()=>T.post("night-audit/run",{json:l}).json(),{maxAttempts:2,initialDelay:1e3})}static async listNightAudits(l=1,h=30){return await C(()=>T.get(`night-audit?page=${l}&page_size=${h}`).json(),{maxAttempts:3,initialDelay:1e3})}static async getNightAudit(l){return await C(()=>T.get(`night-audit/${l}`).json(),{maxAttempts:3,initialDelay:1e3})}static async isBookingPosted(l){return await C(()=>T.get(`bookings/${l}/posted`).json(),{maxAttempts:3,initialDelay:1e3})}static async getAuditDetails(l){return await C(()=>T.get(`night-audit/${l}/details`).json(),{maxAttempts:3,initialDelay:1e3})}}const Ge=G(e.jsx("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp"),he=G(e.jsx("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),ue=G(e.jsx("path",{d:"M10 10.02h5V21h-5zM17 21h3c1.1 0 2-.9 2-2v-9h-5zm3-18H5c-1.1 0-2 .9-2 2v3h19V5c0-1.1-.9-2-2-2M3 19c0 1.1.9 2 2 2h3V10H3z"}),"TableChart"),H=typeof window<"u"&&"__TAURI__"in window;async function Ye(x){if(x instanceof Blob){const l=await x.arrayBuffer();return Array.from(new Uint8Array(l))}else{const l=new TextEncoder;return Array.from(l.encode(x))}}async function me({filename:x,content:l,mimeType:h}){if(console.log("saveFile called:",{filename:x,mimeType:h,isTauri:H}),alert(`saveFile called - isTauri: ${H}, filename: ${x}`),H)try{console.log("Using Tauri save_file_direct command..."),alert("Attempting Tauri save...");const{invoke:p}=await V(async()=>{const{invoke:D}=await import("./core-DV6XEvTN.js");return{invoke:D}},[]);console.log("Tauri invoke imported successfully");const o=await Ye(l);console.log("Content bytes length:",o.length),alert(`Content prepared: ${o.length} bytes`);const b=await p("save_file_direct",{filename:x,content:o});return console.log("File saved to:",b),alert(`File saved successfully to:
${b}`),!0}catch(p){return console.error("Tauri save error:",p),alert(`Tauri save error: ${JSON.stringify(p)}`),ge({filename:x,content:l,mimeType:h})}else return console.log("Not in Tauri, using browser download"),ge({filename:x,content:l,mimeType:h})}function ge({filename:x,content:l,mimeType:h}){try{console.log("Browser download:",x);const p=l instanceof Blob?l:new Blob([l],{type:h||"text/plain"}),o=window.URL.createObjectURL(p),b=document.createElement("a");return b.href=o,b.download=x,b.style.display="none",document.body.appendChild(b),b.click(),setTimeout(()=>{document.body.removeChild(b),window.URL.revokeObjectURL(o)},100),console.log("Browser download initiated"),!0}catch(p){return console.error("Browser download error:",p),alert(`Download failed: ${p instanceof Error?p.message:"Unknown error"}`),!1}}function je(x){const{children:l,value:h,index:p,...o}=x;return e.jsx("div",{hidden:h!==p,...o,children:h===p&&e.jsx(i,{sx:{pt:2},children:l})})}const it=()=>{const[x,l]=j.useState(0),[h,p]=j.useState(()=>new Date().toISOString().split("T")[0]),[o,b]=j.useState(null),[D,pe]=j.useState([]),[B,Y]=j.useState(!1),[ye,K]=j.useState(!0),[$,J]=j.useState(!1),[q,A]=j.useState(null),[Q,X]=j.useState(null),[be,I]=j.useState(!1),[Z,ee]=j.useState(""),[te,ve]=j.useState(new Set),_e=t=>{ve(r=>{const m=new Set(r);return m.has(t)?m.delete(t):m.add(t),m})},se=async t=>{try{const m=(await P.getAuditDetails(t.id)).posted_bookings,d=[];d.push("NIGHT AUDIT REPORT"),d.push(`Audit Date,${new Date(t.audit_date+"T00:00:00").toLocaleDateString()}`),d.push(`Run At,${new Date(t.run_at).toLocaleString()}`),d.push(`Run By,${t.run_by_username||"System"}`),d.push(`Status,${t.status}`),d.push(""),d.push("SUMMARY STATISTICS"),d.push(`Bookings Posted,${t.total_bookings_posted}`),d.push(`Check-ins,${t.total_checkins}`),d.push(`Check-outs,${t.total_checkouts}`),d.push(`Total Revenue,${v(t.total_revenue)}`),d.push(`Occupancy Rate,${Number(t.occupancy_rate).toFixed(1)}%`),t.notes&&d.push(`Notes,"${t.notes.replace(/"/g,'""')}"`),d.push(""),d.push("POSTED BOOKINGS"),d.push("Booking #,Guest Name,Room,Room Type,Check-in,Check-out,Nights,Status,Amount,Payment Method,Payment Status,Channel"),m.forEach(g=>{d.push([g.booking_number,`"${g.guest_name.replace(/"/g,'""')}"`,g.room_number,g.room_type,new Date(g.check_in_date+"T00:00:00").toLocaleDateString(),new Date(g.check_out_date+"T00:00:00").toLocaleDateString(),g.nights,g.status,v(g.total_amount),g.payment_method||"N/A",g.payment_status||"N/A",g.source||"N/A"].join(","))}),d.push(""),d.push(`Total Bookings,${m.length}`),d.push(`Total Revenue,${v(m.reduce((g,n)=>g+Number(n.total_amount),0))}`);const L=d.join(`
`),re=`night_audit_${t.audit_date}.csv`;await me({filename:re,content:L,mimeType:"text/csv"})}catch(r){console.error("Failed to export audit to CSV:",r),A("Failed to export audit. Please try again.")}},ne=async t=>{try{const m=(await P.getAuditDetails(t.id)).posted_bookings,d=await V(()=>import("./jspdf.es.min-Bm_vtoqk.js").then(c=>c.j),__vite__mapDeps([0,1,2])),L=d.jsPDF||d.default,g=(await V(()=>import("./jspdf.plugin.autotable-CiWB1QeR.js"),[])).default,n=new L({orientation:"landscape"}),E=n.internal.pageSize.getWidth(),oe=n.internal.pageSize.getHeight();n.setFontSize(20),n.setTextColor(25,118,210),n.text("Night Audit Report",14,18),n.setFontSize(10),n.setTextColor(100,100,100);const Se=new Date(t.audit_date+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});n.text(`Audit Date: ${Se}`,14,26),n.text(`Status: ${t.status.toUpperCase()}`,14,32),n.text(`Run At: ${new Date(t.run_at).toLocaleString()}`,E/2,26),n.text(`Run By: ${t.run_by_username||"System"}`,E/2,32),n.setFontSize(12),n.setTextColor(0,0,0),n.text("Summary Statistics",14,44),n.setFontSize(10);const Ce=[`Bookings Posted: ${t.total_bookings_posted}`,`Check-ins: ${t.total_checkins}`,`Check-outs: ${t.total_checkouts}`,`Total Revenue: ${v(t.total_revenue)}`,`Occupancy Rate: ${Number(t.occupancy_rate).toFixed(1)}%`];n.text(Ce.join("    |    "),14,52),n.setFontSize(12),n.text("Room Status Snapshot",14,64),n.setFontSize(10);const Te=[`Available: ${t.rooms_available}`,`Occupied: ${t.rooms_occupied}`,`Reserved: ${t.rooms_reserved}`,`Maintenance: ${t.rooms_maintenance}`,`Dirty: ${t.rooms_dirty}`];n.text(Te.join("    |    "),14,72),n.setFontSize(12),n.text(`Posted Bookings (${m.length})`,14,84);const O=m.map(c=>{var F;return[c.booking_number,c.guest_name,c.room_number,c.room_type,new Date(c.check_in_date+"T00:00:00").toLocaleDateString(),new Date(c.check_out_date+"T00:00:00").toLocaleDateString(),c.nights.toString(),c.status.replace(/_/g," "),v(c.total_amount),((F=c.payment_method)==null?void 0:F.replace(/_/g," "))||"-",c.payment_status||"-",c.source||"-"]}),De=m.reduce((c,F)=>c+Number(F.total_amount),0);O.push(["","","","","","","","TOTAL:",v(De),"","",""]),g(n,{startY:88,head:[["Booking #","Guest","Room","Type","Check-in","Check-out","Nights","Status","Amount","Payment","Pay Status","Channel"]],body:O,styles:{fontSize:7,cellPadding:2},headStyles:{fillColor:[66,66,66],textColor:[255,255,255]},didParseCell:c=>{c.row.index===O.length-1&&(c.cell.styles.fontStyle="bold",c.cell.styles.fillColor=[240,240,240])}});let z=n.lastAutoTable.finalY+10;if(t.notes){z>oe-40&&(n.addPage(),z=20),n.setFontSize(12),n.setTextColor(0,0,0),n.text("Notes",14,z),n.setFontSize(9),n.setTextColor(80,80,80);const c=n.splitTextToSize(t.notes,E-28);n.text(c,14,z+6)}const ie=n.getNumberOfPages();for(let c=1;c<=ie;c++)n.setPage(c),n.setFontSize(8),n.setTextColor(150,150,150),n.text(`Audit ID: #${t.id} | Generated: ${new Date().toLocaleString()} | Page ${c} of ${ie}`,14,oe-10);const ke=n.output("blob"),Re=`night_audit_${t.audit_date}.pdf`;await me({filename:Re,content:ke,mimeType:"application/pdf"})}catch(r){console.error("Failed to export audit to PDF:",r),A(`Failed to export audit: ${r.message||"Unknown error"}`)}},k=j.useCallback(async()=>{try{Y(!0),A(null);const t=await P.getPreview(h);b(t)}catch(t){A(t.message||"Failed to fetch preview"),b(null)}finally{Y(!1)}},[h]),N=j.useCallback(async()=>{try{K(!0);const t=await P.listNightAudits(1,50);pe(t)}catch(t){console.error("Failed to fetch audit history:",t)}finally{K(!1)}},[]);j.useEffect(()=>{k()},[k]),j.useEffect(()=>{N()},[N]);const fe=async()=>{try{J(!0),A(null),I(!1);const t=await P.runNightAudit({audit_date:h,notes:Z||void 0});X(t.message),ee(""),await Promise.all([k(),N()])}catch(t){A(t.message||"Failed to run night audit")}finally{J(!1)}},we=t=>{switch(t){case"completed":return e.jsx(f,{label:"Completed",color:"success",size:"small",icon:e.jsx(M,{})});case"failed":return e.jsx(f,{label:"Failed",color:"error",size:"small",icon:e.jsx(Ve,{})});case"in_progress":return e.jsx(f,{label:"In Progress",color:"warning",size:"small"});default:return e.jsx(f,{label:t,size:"small"})}},Ae=t=>{const r={checked_in:"success",checked_out:"info",reserved:"warning",confirmed:"info"};return e.jsx(f,{label:t.replace(/_/g," "),color:r[t]||"default",size:"small",sx:{textTransform:"capitalize"}})};return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:"Night Audit"}),e.jsx(ae,{onClick:()=>{k(),N()},children:e.jsx(le,{})})]}),q&&e.jsx(S,{severity:"error",sx:{mb:2},onClose:()=>A(null),children:q}),Q&&e.jsx(S,{severity:"success",sx:{mb:2},onClose:()=>X(null),children:Q}),e.jsxs(Pe,{value:x,onChange:(t,r)=>l(r),sx:{mb:2},children:[e.jsx(ce,{label:"Run Audit"}),e.jsx(ce,{label:"Audit History"})]}),e.jsxs(je,{value:x,index:0,children:[e.jsx(_,{sx:{mb:3},children:e.jsx(y,{children:e.jsxs(a,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(de,{label:"Audit Date",type:"date",value:h,onChange:t=>p(t.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(w,{variant:"outlined",onClick:k,disabled:B,startIcon:B?e.jsx(R,{size:16}):e.jsx(le,{}),children:"Load Preview"})}),e.jsxs(a,{item:!0,xs:12,md:4,children:[o&&!o.already_run&&e.jsx(w,{variant:"contained",color:"primary",onClick:()=>I(!0),disabled:$||o.total_unposted===0,startIcon:$?e.jsx(R,{size:16,color:"inherit"}):e.jsx(he,{}),children:"Run Night Audit"}),(o==null?void 0:o.already_run)&&e.jsx(f,{label:"Audit Already Completed",color:"success",icon:e.jsx(M,{})})]})]})})}),B?e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(R,{})}):o?e.jsx(e.Fragment,{children:e.jsxs(W,{sx:{p:3,mb:3},children:[e.jsx(s,{variant:"h5",sx:{mb:1,fontWeight:"bold"},children:"Night Audit Report Preview"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:new Date(h+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),o.already_run?(()=>{const t=m=>m.split("T")[0],r=D.find(m=>t(m.audit_date)===t(h));return r?e.jsxs(e.Fragment,{children:[e.jsxs(S,{severity:"success",sx:{mb:3},icon:e.jsx(M,{}),children:["Audit completed at ",new Date(r.run_at).toLocaleString()," by ",r.run_by_username||"System"]}),e.jsxs(a,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"primary.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:r.total_bookings_posted}),e.jsx(s,{variant:"body2",children:"Bookings Posted"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"success.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:v(r.total_revenue)}),e.jsx(s,{variant:"body2",children:"Total Revenue"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"info.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:r.total_checkins}),e.jsx(s,{variant:"body2",children:"Check-ins"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"warning.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:r.total_checkouts}),e.jsx(s,{variant:"body2",children:"Check-outs"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"grey.200",borderRadius:1},children:[e.jsxs(s,{variant:"h4",fontWeight:"bold",children:[Number(r.occupancy_rate).toFixed(0),"%"]}),e.jsx(s,{variant:"body2",children:"Occupancy"})]})})]}),e.jsx(s,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Room Status at Audit Time"}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[e.jsx(f,{label:`${r.rooms_available} Available`,color:"success",variant:"outlined"}),e.jsx(f,{label:`${r.rooms_occupied} Occupied`,color:"error",variant:"outlined"}),e.jsx(f,{label:`${r.rooms_reserved} Reserved`,color:"info",variant:"outlined"}),e.jsx(f,{label:`${r.rooms_maintenance} Maintenance`,color:"warning",variant:"outlined"}),e.jsx(f,{label:`${r.rooms_dirty} Dirty`,variant:"outlined"})]}),e.jsxs(i,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(w,{size:"small",variant:"outlined",startIcon:e.jsx(xe,{}),onClick:()=>ne(r),children:"Export PDF"}),e.jsx(w,{size:"small",variant:"outlined",startIcon:e.jsx(ue,{}),onClick:()=>se(r),children:"Export CSV"})]})]}):e.jsx(S,{severity:"success",children:"Night audit completed. Check History tab for details."})})():e.jsxs(e.Fragment,{children:[e.jsxs(a,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"primary.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:o.total_unposted}),e.jsx(s,{variant:"body2",children:"Bookings to Post"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"success.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:v(o.estimated_revenue)}),e.jsx(s,{variant:"body2",children:"Estimated Revenue"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"info.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:o.room_snapshot.occupied}),e.jsx(s,{variant:"body2",children:"Occupied Rooms"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"warning.light",borderRadius:1},children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:o.room_snapshot.available}),e.jsx(s,{variant:"body2",children:"Available Rooms"})]})}),e.jsx(a,{item:!0,xs:6,sm:2.4,children:e.jsxs(i,{sx:{textAlign:"center",p:2,bgcolor:"grey.200",borderRadius:1},children:[e.jsxs(s,{variant:"h4",fontWeight:"bold",children:[o.room_snapshot.total>0?Math.round(o.room_snapshot.occupied/o.room_snapshot.total*100):0,"%"]}),e.jsx(s,{variant:"body2",children:"Occupancy"})]})})]}),e.jsxs(s,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:["Bookings to be Posted (",o.unposted_bookings.length,")"]}),o.unposted_bookings.length>0?e.jsx(ze,{component:W,variant:"outlined",children:e.jsxs(Fe,{size:"small",children:[e.jsx(Be,{children:e.jsxs(U,{sx:{bgcolor:"grey.100"},children:[e.jsx(u,{children:e.jsx("strong",{children:"Booking #"})}),e.jsx(u,{children:e.jsx("strong",{children:"Guest"})}),e.jsx(u,{children:e.jsx("strong",{children:"Room"})}),e.jsx(u,{children:e.jsx("strong",{children:"Check-in"})}),e.jsx(u,{children:e.jsx("strong",{children:"Check-out"})}),e.jsx(u,{children:e.jsx("strong",{children:"Status"})}),e.jsx(u,{children:e.jsx("strong",{children:"Channel"})}),e.jsx(u,{align:"right",children:e.jsx("strong",{children:"Amount"})})]})}),e.jsxs(Le,{children:[o.unposted_bookings.map(t=>{var r;return e.jsxs(U,{hover:!0,children:[e.jsx(u,{children:t.booking_number}),e.jsx(u,{children:t.guest_name}),e.jsx(u,{children:t.room_number}),e.jsx(u,{children:new Date(t.check_in_date).toLocaleDateString()}),e.jsx(u,{children:new Date(t.check_out_date).toLocaleDateString()}),e.jsx(u,{children:Ae(t.status)}),e.jsx(u,{sx:{textTransform:"capitalize"},children:((r=t.source)==null?void 0:r.replace(/_/g," "))||"-"}),e.jsx(u,{align:"right",children:v(t.total_amount)})]},t.booking_id)}),e.jsxs(U,{sx:{bgcolor:"grey.50"},children:[e.jsx(u,{colSpan:7,align:"right",children:e.jsx("strong",{children:"Total Revenue:"})}),e.jsx(u,{align:"right",children:e.jsx("strong",{children:v(o.estimated_revenue)})})]})]})]})}):e.jsx(S,{severity:"info",children:"No bookings to post for this date."})]})]})}):null]}),e.jsx(je,{value:x,index:1,children:ye?e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(R,{})}):D.length>0?e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:D.map(t=>e.jsxs(_,{variant:"outlined",children:[e.jsxs(y,{sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"},display:"flex",alignItems:"center",justifyContent:"space-between",py:1.5},onClick:()=>_e(t.id),children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ae,{size:"small",children:te.has(t.id)?e.jsx(Ge,{}):e.jsx($e,{})}),e.jsxs(i,{children:[e.jsx(s,{variant:"h6",component:"span",children:new Date(t.audit_date+"T00:00:00").toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ee,{fontSize:"small"}),new Date(t.run_at).toLocaleString()]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ie,{fontSize:"small"}),t.run_by_username||"System"]}),we(t.status)]})]})]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:3,mr:2},children:[e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(s,{variant:"h5",color:"primary",children:t.total_bookings_posted}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Bookings"})]}),e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsx(s,{variant:"h5",color:"success.main",children:v(t.total_revenue)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Revenue"})]}),e.jsxs(i,{sx:{textAlign:"center"},children:[e.jsxs(s,{variant:"h5",color:"info.main",children:[Number(t.occupancy_rate).toFixed(0),"%"]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Occupancy"})]})]})]}),e.jsxs(Oe,{in:te.has(t.id),children:[e.jsx(Ne,{}),e.jsxs(y,{sx:{bgcolor:"grey.50"},children:[e.jsxs(s,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold"},children:["Night Audit Report - ",new Date(t.audit_date+"T00:00:00").toLocaleDateString()]}),e.jsx(s,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Booking Statistics"}),e.jsxs(a,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:6,sm:3,children:e.jsx(_,{variant:"outlined",children:e.jsxs(y,{sx:{textAlign:"center",py:1.5},children:[e.jsx(s,{variant:"h4",color:"primary",children:t.total_bookings_posted}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Bookings Posted"})]})})}),e.jsx(a,{item:!0,xs:6,sm:3,children:e.jsx(_,{variant:"outlined",children:e.jsxs(y,{sx:{textAlign:"center",py:1.5},children:[e.jsx(s,{variant:"h4",color:"success.main",children:t.total_checkins}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Check-ins"})]})})}),e.jsx(a,{item:!0,xs:6,sm:3,children:e.jsx(_,{variant:"outlined",children:e.jsxs(y,{sx:{textAlign:"center",py:1.5},children:[e.jsx(s,{variant:"h4",color:"warning.main",children:t.total_checkouts}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Check-outs"})]})})}),e.jsx(a,{item:!0,xs:6,sm:3,children:e.jsx(_,{variant:"outlined",children:e.jsxs(y,{sx:{textAlign:"center",py:1.5},children:[e.jsx(s,{variant:"h4",color:"info.main",children:v(t.total_revenue)}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Total Revenue"})]})})})]}),e.jsx(s,{variant:"subtitle2",sx:{mb:1,color:"text.secondary"},children:"Room Snapshot at Audit Time"}),e.jsxs(a,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(a,{item:!0,xs:4,sm:2,children:e.jsx(_,{sx:{bgcolor:"success.light"},children:e.jsxs(y,{sx:{textAlign:"center",py:1},children:[e.jsx(s,{variant:"h5",children:t.rooms_available}),e.jsx(s,{variant:"caption",children:"Available"})]})})}),e.jsx(a,{item:!0,xs:4,sm:2,children:e.jsx(_,{sx:{bgcolor:"error.light"},children:e.jsxs(y,{sx:{textAlign:"center",py:1},children:[e.jsx(s,{variant:"h5",children:t.rooms_occupied}),e.jsx(s,{variant:"caption",children:"Occupied"})]})})}),e.jsx(a,{item:!0,xs:4,sm:2,children:e.jsx(_,{sx:{bgcolor:"info.light"},children:e.jsxs(y,{sx:{textAlign:"center",py:1},children:[e.jsx(s,{variant:"h5",children:t.rooms_reserved}),e.jsx(s,{variant:"caption",children:"Reserved"})]})})}),e.jsx(a,{item:!0,xs:4,sm:2,children:e.jsx(_,{sx:{bgcolor:"warning.light"},children:e.jsxs(y,{sx:{textAlign:"center",py:1},children:[e.jsx(s,{variant:"h5",children:t.rooms_maintenance}),e.jsx(s,{variant:"caption",children:"Maintenance"})]})})}),e.jsx(a,{item:!0,xs:4,sm:2,children:e.jsx(_,{sx:{bgcolor:"grey.300"},children:e.jsxs(y,{sx:{textAlign:"center",py:1},children:[e.jsx(s,{variant:"h5",children:t.rooms_dirty}),e.jsx(s,{variant:"caption",children:"Dirty"})]})})}),e.jsx(a,{item:!0,xs:4,sm:2,children:e.jsx(_,{variant:"outlined",children:e.jsxs(y,{sx:{textAlign:"center",py:1},children:[e.jsxs(s,{variant:"h5",color:"primary",children:[Number(t.occupancy_rate).toFixed(1),"%"]}),e.jsx(s,{variant:"caption",children:"Occupancy"})]})})})]}),t.notes&&e.jsxs(i,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle2",sx:{mb:.5,color:"text.secondary"},children:"Notes"}),e.jsx(W,{variant:"outlined",sx:{p:1.5,bgcolor:"background.paper"},children:e.jsx(s,{variant:"body2",children:t.notes})})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:3,color:"text.secondary",fontSize:"0.875rem"},children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Audit ID:"})," #",t.id]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Created:"})," ",new Date(t.created_at).toLocaleString()]})]}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(w,{size:"small",variant:"outlined",startIcon:e.jsx(xe,{}),onClick:r=>{r.stopPropagation(),ne(t)},children:"Export PDF"}),e.jsx(w,{size:"small",variant:"outlined",startIcon:e.jsx(ue,{}),onClick:r=>{r.stopPropagation(),se(t)},children:"Export CSV"})]})]})]})]})]},t.id))}):e.jsx(S,{severity:"info",children:"No audit history available."})}),e.jsxs(We,{open:be,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Me,{children:"Confirm Night Audit"}),e.jsxs(Ue,{children:[e.jsxs(s,{sx:{mb:2},children:["You are about to run the night audit for ",e.jsx("strong",{children:new Date(h).toLocaleDateString()}),"."]}),e.jsxs(S,{severity:"warning",sx:{mb:2},children:["This action will:",e.jsxs("ul",{children:[e.jsxs("li",{children:["Mark ",(o==null?void 0:o.total_unposted)||0," bookings as posted"]}),e.jsx("li",{children:"Lock these bookings from further editing"}),e.jsx("li",{children:"Record room status snapshot for reporting"})]}),"This action cannot be undone."]}),e.jsx(de,{label:"Notes (Optional)",multiline:!0,rows:3,value:Z,onChange:t=>ee(t.target.value),fullWidth:!0,placeholder:"Add any notes about this audit run..."})]}),e.jsxs(He,{children:[e.jsx(w,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(w,{variant:"contained",color:"primary",onClick:fe,disabled:$,startIcon:$?e.jsx(R,{size:16,color:"inherit"}):e.jsx(he,{}),children:"Run Audit"})]})]})]})};export{it as default};
