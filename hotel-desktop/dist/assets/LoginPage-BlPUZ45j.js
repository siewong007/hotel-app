import{r as s,h as Q,i as Z,j as e,B as t,ax as T,aD as p,p as M,T as r,n as w,A as U,o as h,a5 as A,I as _,P as E,al as ee}from"./index-DnWmqzJF.js";import te from"./FirstLoginPasskeyPrompt-BR3BY9wB.js";import{P as re,A as ne}from"./VpnKey-Bov3f6WK.js";import{B as se}from"./ArrowBack-DoSpaJPE.js";import{C as oe}from"./Collapse-B4NV5VtR.js";import{C as O,a as Y}from"./CardContent-BhQI87uj.js";import{F as ae}from"./Fingerprint-BskTfpZx.js";import{L as ie}from"./Lock-DCccL4KJ.js";import"./DialogTitle-DKxRfOzX.js";const ve=()=>{const[d,v]=s.useState(null),[le,de]=s.useState(null),[o,D]=s.useState(""),[P,k]=s.useState(""),[m,a]=s.useState(""),[f,b]=s.useState(!1),[R,F]=s.useState(!1),[H,W]=s.useState(!1),[g,I]=s.useState(""),[ce,u]=s.useState(!1),[N,C]=s.useState(!1),[i,j]=s.useState(!1),[S,B]=s.useState(!1),{login:q,loginWithPasskey:G,registerPasskey:ue}=Q(),y=Z(),L=async n=>{n.preventDefault(),a(""),b(!0);try{await q(o,P,g||void 0)?(F(!0),b(!1)):y("/")}catch(c){const x=c.message||"Login failed";if(x.includes("2FA required")||x.includes("TOTP code")){W(!0),a(""),b(!1);return}a(x),b(!1)}},K=async n=>{if(n.preventDefault(),!g||g.length!==6){a("Please enter a valid 6-digit code");return}await L(n)},V=()=>{v(null),a(""),D(""),k(""),u(!1),C(!1),j(!1),B(!1)},X=async n=>{if(n.preventDefault(),!o||o.length<3){a("Please enter a valid username");return}B(!0),a(""),await $()},$=async()=>{var n,c,x,z;if(!(!o||i)){j(!0),u(!1),a("");try{if(!window.PublicKeyCredential){console.log("WebAuthn not supported, showing password field"),C(!0),u(!0),j(!1);return}console.log("Attempting passkey authentication for:",o);const l=await G(o);u(!0),l?F(!0):y("/")}catch(l){console.log("Passkey authentication failed:",l.message),u(!0),C(!0),((n=l.message)==null?void 0:n.toLowerCase().includes("no credentials"))||((c=l.message)==null?void 0:c.toLowerCase().includes("not found"))||((x=l.message)==null?void 0:x.toLowerCase().includes("not allowed"))||((z=l.message)==null?void 0:z.toLowerCase().includes("cancelled"))||console.error("Unexpected passkey error:",l)}finally{j(!1)}}},J=()=>{B(!1),C(!1),u(!1),k(""),a("")};return R?e.jsx(te,{open:!0,username:o,onClose:()=>y("/")}):H?e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #26C6DA 0%, #66BB6A 100%)"},children:e.jsx(T,{maxWidth:"sm",children:e.jsx(p,{in:!0,timeout:800,children:e.jsxs(M,{elevation:24,sx:{p:5,borderRadius:3},children:[e.jsxs(t,{sx:{textAlign:"center",mb:4},children:[e.jsx(re,{sx:{fontSize:60,color:"#00ACC1",mb:2}}),e.jsx(r,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:"Two-Factor Authentication"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Enter the 6-digit code from your authenticator app"})]}),e.jsxs("form",{onSubmit:K,children:[e.jsx(w,{fullWidth:!0,label:"6-Digit Code",value:g,onChange:n=>{const c=n.target.value.replace(/\D/g,"").slice(0,6);I(c)},placeholder:"000000",inputProps:{maxLength:6,style:{textAlign:"center",fontSize:"24px",letterSpacing:"8px"}},sx:{mb:3},autoFocus:!0}),m&&e.jsx(U,{severity:"error",sx:{mb:2},children:m}),e.jsx(h,{fullWidth:!0,type:"submit",variant:"contained",size:"large",disabled:f||g.length!==6,sx:{mb:2,background:"linear-gradient(135deg, #00BCD4 0%, #26C6DA 100%)","&:hover":{background:"linear-gradient(135deg, #00ACC1 0%, #00BCD4 100%)"}},children:f?e.jsx(A,{size:24}):"Verify"}),e.jsx(h,{fullWidth:!0,variant:"outlined",onClick:()=>{W(!1),I(""),a("")},sx:{borderColor:"#00BCD4",color:"#00BCD4","&:hover":{borderColor:"#00ACC1",backgroundColor:"rgba(0, 188, 212, 0.1)"}},children:"Cancel"})]})]})})})}):e.jsx(t,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #E0F2F1 0%, #B2DFDB 50%, #80CBC4 100%)",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:"-50%",left:"-50%",width:"200%",height:"200%",background:"radial-gradient(circle at 50% 50%, rgba(0, 188, 212, 0.15) 0%, transparent 50%)",animation:"rotate 20s linear infinite"},"@keyframes rotate":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}},children:e.jsx(T,{maxWidth:"sm",sx:{position:"relative",zIndex:1},children:e.jsx(p,{in:!0,timeout:800,children:e.jsxs(M,{elevation:12,sx:{p:{xs:4,sm:6},width:"100%",borderRadius:4,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",border:"2px solid rgba(0, 188, 212, 0.2)",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 188, 212, 0.3)"},children:[e.jsxs(t,{sx:{textAlign:"left",mb:5},children:[e.jsx(r,{variant:"h1",sx:{fontSize:{xs:"3rem",sm:"4rem",md:"5rem"},fontWeight:900,letterSpacing:"-0.02em",lineHeight:.9,mb:1,textTransform:"uppercase",background:"linear-gradient(135deg, #00BCD4 0%, #81C784 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"HOTEL"}),e.jsx(t,{sx:{width:"60px",height:"4px",background:"linear-gradient(90deg, #00BCD4 0%, #66BB6A 100%)",mb:2}}),e.jsx(r,{variant:"h5",sx:{fontWeight:600,letterSpacing:"0.1em",color:"#00897B",textTransform:"uppercase",fontSize:"0.9rem",mb:1},children:"Salim Inn"}),e.jsxs(r,{variant:"body2",sx:{color:"rgba(0, 137, 123, 0.7)",fontSize:"0.875rem",letterSpacing:"0.02em"},children:[!d&&"Select your account type",d&&`Sign in as ${d==="guest"?"Guest":"Admin"}`]})]}),d&&e.jsx(p,{in:!0,children:e.jsx(t,{sx:{mb:2},children:e.jsx(_,{onClick:V,sx:{color:"#00BCD4",transition:"all 0.3s","&:hover":{transform:"translateX(-4px)",backgroundColor:"rgba(0, 188, 212, 0.1)"}},children:e.jsx(se,{})})})}),e.jsx(oe,{in:!!m,children:e.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>a(""),children:m})}),!d&&e.jsx(p,{in:!0,timeout:600,children:e.jsxs(t,{children:[e.jsx(O,{onClick:()=>v("guest"),sx:{mb:3,cursor:"pointer",transition:"all 0.3s",border:"2px solid transparent","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 32px rgba(0, 188, 212, 0.3)",border:"2px solid #00BCD4"}},children:e.jsx(Y,{sx:{p:3},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(t,{sx:{p:2,borderRadius:2,background:"linear-gradient(135deg, #00BCD4 0%, #26C6DA 100%)"},children:e.jsx(E,{sx:{fontSize:40,color:"white"}})}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:700,gutterBottom:!0,color:"#00897B",children:"Guest"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Book rooms, manage reservations, and enjoy rewards"})]})]})})}),e.jsx(O,{onClick:()=>v("admin"),sx:{cursor:"pointer",transition:"all 0.3s",border:"2px solid transparent","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 32px rgba(102, 187, 106, 0.3)",border:"2px solid #66BB6A"}},children:e.jsx(Y,{sx:{p:3},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(t,{sx:{p:2,borderRadius:2,background:"linear-gradient(135deg, #66BB6A 0%, #81C784 100%)"},children:e.jsx(ne,{sx:{fontSize:40,color:"white"}})}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:700,gutterBottom:!0,color:"#00897B",children:"Admin"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage hotel operations, guests, and analytics"})]})]})})}),e.jsx(t,{sx:{mt:3,textAlign:"center"},children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Don't have an account?"," ",e.jsx(h,{variant:"text",sx:{p:0,minWidth:"auto",fontSize:"inherit",textTransform:"none",fontWeight:600,color:"#00BCD4","&:hover":{background:"transparent",textDecoration:"underline"}},onClick:()=>y("/register"),children:"Sign up"})]})})]})}),d&&e.jsx(ee,{direction:"left",in:!0,timeout:400,children:e.jsxs(t,{children:[e.jsxs(t,{sx:{mb:3,textAlign:"center"},children:[e.jsx(t,{sx:{display:"inline-flex",p:2,borderRadius:"50%",background:i?"linear-gradient(135deg, #00BCD4 0%, #26C6DA 100%)":"linear-gradient(135deg, #00BCD4 0%, #81C784 100%)",mb:2,animation:i?"pulse 1.5s ease-in-out infinite":"none","@keyframes pulse":{"0%, 100%":{transform:"scale(1)",opacity:1},"50%":{transform:"scale(1.05)",opacity:.8}}},children:i?e.jsx(ae,{sx:{fontSize:32,color:"white"}}):S?e.jsx(E,{sx:{fontSize:32,color:"white"}}):e.jsx(ie,{sx:{fontSize:32,color:"white"}})}),e.jsx(r,{variant:"h6",fontWeight:600,color:"#00897B",children:i?"Authenticating...":"Sign In"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:i?"Checking for passkey":d==="guest"?"Guest Account":"Admin Account"})]}),!S&&!i&&e.jsxs("form",{onSubmit:X,children:[e.jsx(w,{fullWidth:!0,label:"Username or Email",value:o,onChange:n=>D(n.target.value),margin:"normal",required:!0,autoFocus:!0,sx:{"& .MuiOutlinedInput-root":{transition:"all 0.3s","&:hover":{transform:"translateY(-2px)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#00BCD4",borderWidth:"2px"}},"& .MuiInputLabel-root.Mui-focused":{color:"#00BCD4"}}}),e.jsx(h,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5,background:"linear-gradient(135deg, #00BCD4 0%, #26C6DA 100%)",fontWeight:600,fontSize:"1rem",transition:"all 0.3s","&:hover":{background:"linear-gradient(135deg, #00ACC1 0%, #00BCD4 100%)",transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0, 188, 212, 0.4)"},"&:active":{transform:"translateY(0)"}},disabled:!o||o.length<3,children:"Next"})]}),(S||i)&&e.jsxs(t,{children:[e.jsxs(t,{sx:{mb:3,display:"flex",alignItems:"center",gap:2},children:[e.jsxs(t,{sx:{flex:1,p:2,borderRadius:2,background:"rgba(0, 188, 212, 0.1)",border:"1px solid rgba(0, 188, 212, 0.3)"},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.75rem"},children:"Username"}),e.jsx(r,{variant:"body1",fontWeight:600,color:"#00897B",children:o})]}),!i&&e.jsx(h,{variant:"outlined",size:"small",onClick:J,sx:{minWidth:"auto",px:2,borderColor:"#00BCD4",color:"#00BCD4","&:hover":{borderColor:"#00ACC1",backgroundColor:"rgba(0, 188, 212, 0.1)"}},children:"Edit"})]}),i&&e.jsxs(t,{sx:{textAlign:"center",py:4},children:[e.jsx(A,{size:40}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Checking for passkey..."}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"Please respond to your browser's authentication prompt"})]}),!i&&N&&e.jsx(p,{in:!0,children:e.jsxs("form",{onSubmit:L,children:[e.jsx(w,{fullWidth:!0,label:"Password",type:"password",value:P,onChange:n=>k(n.target.value),margin:"normal",required:!0,autoFocus:!0,sx:{"& .MuiOutlinedInput-root":{transition:"all 0.3s","&:hover":{transform:"translateY(-2px)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#00BCD4",borderWidth:"2px"}},"& .MuiInputLabel-root.Mui-focused":{color:"#00BCD4"}}}),e.jsx(h,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5,background:"linear-gradient(135deg, #00BCD4 0%, #26C6DA 100%)",fontWeight:600,fontSize:"1rem",transition:"all 0.3s","&:hover":{background:"linear-gradient(135deg, #00ACC1 0%, #00BCD4 100%)",transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0, 188, 212, 0.4)"},"&:active":{transform:"translateY(0)"}},disabled:f,children:f?e.jsx(A,{size:24,color:"inherit"}):"Sign In"}),e.jsx(t,{sx:{textAlign:"center"},children:e.jsx(r,{variant:"caption",color:"text.secondary",children:"Passkey not available. Using password instead."})})]})})]})]})})]})})})})};export{ve as default};
